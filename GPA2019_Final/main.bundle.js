!function(g){function r(r){for(var I,e,l=r[0],A=r[1],t=r[2],d=0,b=[];d<l.length;d++)e=l[d],Object.prototype.hasOwnProperty.call(C,e)&&C[e]&&b.push(C[e][0]),C[e]=0;for(I in A)Object.prototype.hasOwnProperty.call(A,I)&&(g[I]=A[I]);for(B&&B(r);b.length;)b.shift()();return c.push.apply(c,t||[]),n()}function n(){for(var g,r=0;r<c.length;r++){for(var n=c[r],I=!0,l=1;l<n.length;l++){var A=n[l];0!==C[A]&&(I=!1)}I&&(c.splice(r--,1),g=e(e.s=n[0]))}return g}var I={},C={0:0},c=[];function e(r){if(I[r])return I[r].exports;var n=I[r]={i:r,l:!1,exports:{}};return g[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}e.m=g,e.c=I,e.d=function(g,r,n){e.o(g,r)||Object.defineProperty(g,r,{enumerable:!0,get:n})},e.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},e.t=function(g,r){if(1&r&&(g=e(g)),8&r)return g;if(4&r&&"object"==typeof g&&g&&g.__esModule)return g;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:g}),2&r&&"string"!=typeof g)for(var I in g)e.d(n,I,function(r){return g[r]}.bind(null,I));return n},e.n=function(g){var r=g&&g.__esModule?function(){return g.default}:function(){return g};return e.d(r,"a",r),r},e.o=function(g,r){return Object.prototype.hasOwnProperty.call(g,r)},e.p="";var l=window.webpackJsonp=window.webpackJsonp||[],A=l.push.bind(l);l.push=r,l=l.slice();for(var t=0;t<l.length;t++)r(l[t]);var B=A;c.push([4,1]),n()}([,,,function(module,exports){eval("module.exports = ImprovedNoise\r\n\r\n// http://mrl.nyu.edu/~perlin/noise/\r\n\r\nfunction ImprovedNoise() {\r\n\r\n\tvar p = [151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,\r\n\t\t 23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,\r\n\t\t 174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,\r\n\t\t 133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,\r\n\t\t 89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,\r\n\t\t 202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,\r\n\t\t 248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,\r\n\t\t 178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,\r\n\t\t 14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,\r\n\t\t 93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n\r\n\tfor (var i=0; i < 256 ; i++) {\r\n\r\n\t\tp[256+i] = p[i];\r\n\r\n\t}\r\n\r\n\tfunction fade(t) {\r\n\r\n\t\treturn t * t * t * (t * (t * 6 - 15) + 10);\r\n\r\n\t}\r\n\r\n\tfunction lerp(t, a, b) {\r\n\r\n\t\treturn a + t * (b - a);\r\n\r\n\t}\r\n\r\n\tfunction grad(hash, x, y, z) {\r\n\r\n\t\tvar h = hash & 15;\r\n\t\tvar u = h < 8 ? x : y, v = h < 4 ? y : h == 12 || h == 14 ? x : z;\r\n\t\treturn ((h&1) == 0 ? u : -u) + ((h&2) == 0 ? v : -v);\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tnoise: function (x, y, z) {\r\n\r\n\t\t\tvar floorX = Math.floor(x), floorY = Math.floor(y), floorZ = Math.floor(z);\r\n\r\n\t\t\tvar X = floorX & 255, Y = floorY & 255, Z = floorZ & 255;\r\n\r\n\t\t\tx -= floorX;\r\n\t\t\ty -= floorY;\r\n\t\t\tz -= floorZ;\r\n\r\n\t\t\tvar xMinus1 = x -1, yMinus1 = y - 1, zMinus1 = z - 1;\r\n\r\n\t\t\tvar u = fade(x), v = fade(y), w = fade(z);\r\n\r\n\t\t\tvar A = p[X]+Y, AA = p[A]+Z, AB = p[A+1]+Z, B = p[X+1]+Y, BA = p[B]+Z, BB = p[B+1]+Z;\r\n\r\n\t\t\treturn lerp(w, lerp(v, lerp(u, grad(p[AA], x, y, z), \r\n\t\t\t\t\t\t\tgrad(p[BA], xMinus1, y, z)),\r\n\t\t\t\t\t\tlerp(u, grad(p[AB], x, yMinus1, z),\r\n\t\t\t\t\t\t\tgrad(p[BB], xMinus1, yMinus1, z))),\r\n\t\t\t\t\tlerp(v, lerp(u, grad(p[AA+1], x, y, zMinus1),\r\n\t\t\t\t\t\t\tgrad(p[BA+1], xMinus1, y, z-1)),\r\n\t\t\t\t\t\tlerp(u, grad(p[AB+1], x, yMinus1, zMinus1),\r\n\t\t\t\t\t\t\tgrad(p[BB+1], xMinus1, yMinus1, zMinus1))));\r\n\r\n\t\t}\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2ltcHJvdmVkLW5vaXNlLmpzPzIzYzEiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBJbXByb3ZlZE5vaXNlXHJcblxyXG4vLyBodHRwOi8vbXJsLm55dS5lZHUvfnBlcmxpbi9ub2lzZS9cclxuXHJcbmZ1bmN0aW9uIEltcHJvdmVkTm9pc2UoKSB7XHJcblxyXG5cdHZhciBwID0gWzE1MSwxNjAsMTM3LDkxLDkwLDE1LDEzMSwxMywyMDEsOTUsOTYsNTMsMTk0LDIzMyw3LDIyNSwxNDAsMzYsMTAzLDMwLDY5LDE0Miw4LDk5LDM3LDI0MCwyMSwxMCxcclxuXHRcdCAyMywxOTAsNiwxNDgsMjQ3LDEyMCwyMzQsNzUsMCwyNiwxOTcsNjIsOTQsMjUyLDIxOSwyMDMsMTE3LDM1LDExLDMyLDU3LDE3NywzMyw4OCwyMzcsMTQ5LDU2LDg3LFxyXG5cdFx0IDE3NCwyMCwxMjUsMTM2LDE3MSwxNjgsNjgsMTc1LDc0LDE2NSw3MSwxMzQsMTM5LDQ4LDI3LDE2Niw3NywxNDYsMTU4LDIzMSw4MywxMTEsMjI5LDEyMiw2MCwyMTEsXHJcblx0XHQgMTMzLDIzMCwyMjAsMTA1LDkyLDQxLDU1LDQ2LDI0NSw0MCwyNDQsMTAyLDE0Myw1NCw2NSwyNSw2MywxNjEsMSwyMTYsODAsNzMsMjA5LDc2LDEzMiwxODcsMjA4LFxyXG5cdFx0IDg5LDE4LDE2OSwyMDAsMTk2LDEzNSwxMzAsMTE2LDE4OCwxNTksODYsMTY0LDEwMCwxMDksMTk4LDE3MywxODYsMyw2NCw1MiwyMTcsMjI2LDI1MCwxMjQsMTIzLDUsXHJcblx0XHQgMjAyLDM4LDE0NywxMTgsMTI2LDI1NSw4Miw4NSwyMTIsMjA3LDIwNiw1OSwyMjcsNDcsMTYsNTgsMTcsMTgyLDE4OSwyOCw0MiwyMjMsMTgzLDE3MCwyMTMsMTE5LFxyXG5cdFx0IDI0OCwxNTIsMiw0NCwxNTQsMTYzLDcwLDIyMSwxNTMsMTAxLDE1NSwxNjcsNDMsMTcyLDksMTI5LDIyLDM5LDI1MywxOSw5OCwxMDgsMTEwLDc5LDExMywyMjQsMjMyLFxyXG5cdFx0IDE3OCwxODUsMTEyLDEwNCwyMTgsMjQ2LDk3LDIyOCwyNTEsMzQsMjQyLDE5MywyMzgsMjEwLDE0NCwxMiwxOTEsMTc5LDE2MiwyNDEsODEsNTEsMTQ1LDIzNSwyNDksXHJcblx0XHQgMTQsMjM5LDEwNyw0OSwxOTIsMjE0LDMxLDE4MSwxOTksMTA2LDE1NywxODQsODQsMjA0LDE3NiwxMTUsMTIxLDUwLDQ1LDEyNyw0LDE1MCwyNTQsMTM4LDIzNiwyMDUsXHJcblx0XHQgOTMsMjIyLDExNCw2NywyOSwyNCw3MiwyNDMsMTQxLDEyOCwxOTUsNzgsNjYsMjE1LDYxLDE1NiwxODBdO1xyXG5cclxuXHRmb3IgKHZhciBpPTA7IGkgPCAyNTYgOyBpKyspIHtcclxuXHJcblx0XHRwWzI1NitpXSA9IHBbaV07XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZmFkZSh0KSB7XHJcblxyXG5cdFx0cmV0dXJuIHQgKiB0ICogdCAqICh0ICogKHQgKiA2IC0gMTUpICsgMTApO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGxlcnAodCwgYSwgYikge1xyXG5cclxuXHRcdHJldHVybiBhICsgdCAqIChiIC0gYSk7XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZ3JhZChoYXNoLCB4LCB5LCB6KSB7XHJcblxyXG5cdFx0dmFyIGggPSBoYXNoICYgMTU7XHJcblx0XHR2YXIgdSA9IGggPCA4ID8geCA6IHksIHYgPSBoIDwgNCA/IHkgOiBoID09IDEyIHx8IGggPT0gMTQgPyB4IDogejtcclxuXHRcdHJldHVybiAoKGgmMSkgPT0gMCA/IHUgOiAtdSkgKyAoKGgmMikgPT0gMCA/IHYgOiAtdik7XHJcblxyXG5cdH1cclxuXHJcblx0cmV0dXJuIHtcclxuXHJcblx0XHRub2lzZTogZnVuY3Rpb24gKHgsIHksIHopIHtcclxuXHJcblx0XHRcdHZhciBmbG9vclggPSBNYXRoLmZsb29yKHgpLCBmbG9vclkgPSBNYXRoLmZsb29yKHkpLCBmbG9vclogPSBNYXRoLmZsb29yKHopO1xyXG5cclxuXHRcdFx0dmFyIFggPSBmbG9vclggJiAyNTUsIFkgPSBmbG9vclkgJiAyNTUsIFogPSBmbG9vclogJiAyNTU7XHJcblxyXG5cdFx0XHR4IC09IGZsb29yWDtcclxuXHRcdFx0eSAtPSBmbG9vclk7XHJcblx0XHRcdHogLT0gZmxvb3JaO1xyXG5cclxuXHRcdFx0dmFyIHhNaW51czEgPSB4IC0xLCB5TWludXMxID0geSAtIDEsIHpNaW51czEgPSB6IC0gMTtcclxuXHJcblx0XHRcdHZhciB1ID0gZmFkZSh4KSwgdiA9IGZhZGUoeSksIHcgPSBmYWRlKHopO1xyXG5cclxuXHRcdFx0dmFyIEEgPSBwW1hdK1ksIEFBID0gcFtBXStaLCBBQiA9IHBbQSsxXStaLCBCID0gcFtYKzFdK1ksIEJBID0gcFtCXStaLCBCQiA9IHBbQisxXStaO1xyXG5cclxuXHRcdFx0cmV0dXJuIGxlcnAodywgbGVycCh2LCBsZXJwKHUsIGdyYWQocFtBQV0sIHgsIHksIHopLCBcclxuXHRcdFx0XHRcdFx0XHRncmFkKHBbQkFdLCB4TWludXMxLCB5LCB6KSksXHJcblx0XHRcdFx0XHRcdGxlcnAodSwgZ3JhZChwW0FCXSwgeCwgeU1pbnVzMSwgeiksXHJcblx0XHRcdFx0XHRcdFx0Z3JhZChwW0JCXSwgeE1pbnVzMSwgeU1pbnVzMSwgeikpKSxcclxuXHRcdFx0XHRcdGxlcnAodiwgbGVycCh1LCBncmFkKHBbQUErMV0sIHgsIHksIHpNaW51czEpLFxyXG5cdFx0XHRcdFx0XHRcdGdyYWQocFtCQSsxXSwgeE1pbnVzMSwgeSwgei0xKSksXHJcblx0XHRcdFx0XHRcdGxlcnAodSwgZ3JhZChwW0FCKzFdLCB4LCB5TWludXMxLCB6TWludXMxKSxcclxuXHRcdFx0XHRcdFx0XHRncmFkKHBbQkIrMV0sIHhNaW51czEsIHlNaW51czEsIHpNaW51czEpKSkpO1xyXG5cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///3\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ../node_modules/gl-matrix/esm/index.js + 10 modules\nvar esm = __webpack_require__(0);\n\n// EXTERNAL MODULE: ../node_modules/stats-js/build/stats.min.js\nvar stats_min = __webpack_require__(1);\n\n// EXTERNAL MODULE: ../node_modules/dat.gui/build/dat.gui.module.js\nvar dat_gui_module = __webpack_require__(2);\n\n// EXTERNAL MODULE: ./improved-noise.js\nvar improved_noise = __webpack_require__(3);\n\n// CONCATENATED MODULE: ./terrain.js\n\r\n\r\nconst { vec3 } = __webpack_require__(0);\r\n\r\nvar minY = 0;\r\nvar worldWidth = 200, worldDepth = 200;\r\nvar terrain_data = generateHeight( worldWidth, worldDepth );\r\nvar light = 1.0;\r\nvar shadow = 0.7;\r\nvar shadow2 = 0.8;\r\n\r\nvar terrainObj = {\r\n    v: null,\r\n    vn: null,\r\n    vt: null,\r\n    idx: null,\r\n    vc: null,\r\n    mesh: null,\r\n    width: null,\r\n    depth: null,\r\n}\r\nvar waterObj = {\r\n    v: null,\r\n    vn: null,\r\n    vt: null,\r\n    idx: null,\r\n}\r\n\r\nfunction generateHeight( width, height ) {\r\n    var data = [], perlin = new improved_noise(),\r\n        size = width * height, quality = 2, z = Math.random() * 100;\r\n    for ( var j = 0; j < 4; j ++ ) {\r\n        if ( j == 0 ) for ( var i = 0; i < size; i ++ ) data[ i ] = 0;\r\n        for ( var i = 0; i < size; i ++ ) {\r\n            var x = i % width, y = ( i / width ) | 0;\r\n            data[ i ] += perlin.noise( x / quality, y / quality, z ) * quality;\r\n        }\r\n        quality *= 4;\r\n    }\r\n    minY = Math.min(...data) * 0.2 | 0;\r\n    console.log(minY);\r\n    return data;\r\n}\r\n\r\nfunction getY( x, z ) {\r\n    return ( terrain_data[ x * worldDepth + z ] * 0.2 ) | 0;\r\n}\r\n\r\nfunction generateTerrain() {\r\n    let pyv = [\r\n        0.0, 16.0, 16.0,\r\n        16.0, 16.0, 16.0,\r\n        16.0, 16.0, 0.0,\r\n        0.0, 16.0, 16.0,\r\n        16.0, 16.0, 0.0,\r\n        0.0, 16.0, 0.0,\r\n    ];\r\n    let pyv2 = [\r\n        0.0, 15.0, 16.0,\r\n        16.0, 15.0, 16.0,\r\n        16.0, 15.0, 0.0,\r\n        0.0, 15.0, 16.0,\r\n        16.0, 15.0, 0.0,\r\n        0.0, 15.0, 0.0,\r\n    ];\r\n    let pxv = [\r\n        16.0, 0.0, 16.0,\r\n        16.0, 0.0, 0.0,\r\n        16.0, 16.0, 0.0,\r\n        16.0, 0.0, 16.0,\r\n        16.0, 16.0, 0.0,\r\n        16.0, 16.0, 16.0,\r\n    ];\r\n    let pzv = [\r\n        0.0, 0.0, 16.0,\r\n        16.0, 0.0, 16.0,\r\n        16.0, 16.0, 16.0,\r\n        0.0, 0.0, 16.0,\r\n        16.0, 16.0, 16.0,\r\n        0.0, 16.0, 16.0,\r\n    ];\r\n    let nxv = [\r\n        0.0, 0.0, 0.0,\r\n        0.0, 0.0, 16.0,\r\n        0.0, 16.0, 16.0,\r\n        0.0, 0.0, 0.0,\r\n        0.0, 16.0, 16.0,\r\n        0.0, 16.0, 0.0,\r\n    ];\r\n    let nzv = [\r\n        16.0, 0.0, 0.0,\r\n        0.0, 0.0, 0.0,\r\n        0.0, 16.0, 0.0,\r\n        16.0, 0.0, 0.0,\r\n        0.0, 16.0, 0.0,\r\n        16.0, 16.0, 0.0,\r\n    ];\r\n\r\n\r\n    let pyvn = [\r\n        0.0, 1.0, 0.0,\r\n        0.0, 1.0, 0.0,\r\n        0.0, 1.0, 0.0,\r\n        0.0, 1.0, 0.0,\r\n        0.0, 1.0, 0.0,\r\n        0.0, 1.0, 0.0,\r\n    ];\r\n    let pxvn = [\r\n        1.0, 0.0, 0.0,\r\n        1.0, 0.0, 0.0,\r\n        1.0, 0.0, 0.0,\r\n        1.0, 0.0, 0.0,\r\n        1.0, 0.0, 0.0,\r\n        1.0, 0.0, 0.0,\r\n    ];\r\n    let pzvn = [\r\n        0.0, 0.0, 1.0,\r\n        0.0, 0.0, 1.0,\r\n        0.0, 0.0, 1.0,\r\n        0.0, 0.0, 1.0,\r\n        0.0, 0.0, 1.0,\r\n        0.0, 0.0, 1.0,\r\n    ];\r\n    let nxvn = [\r\n        -1.0, 0.0, 0.0,\r\n        -1.0, 0.0, 0.0,\r\n        -1.0, 0.0, 0.0,\r\n        -1.0, 0.0, 0.0,\r\n        -1.0, 0.0, 0.0,\r\n        -1.0, 0.0, 0.0,\r\n    ];\r\n    let nzvn = [\r\n        0.0, 0.0, -1.0,\r\n        0.0, 0.0, -1.0,\r\n        0.0, 0.0, -1.0,\r\n        0.0, 0.0, -1.0,\r\n        0.0, 0.0, -1.0,\r\n        0.0, 0.0, -1.0,\r\n    ];\r\n\r\n    let pyvt = [\r\n        0.0, 0.125,\r\n        1.0, 0.125,\r\n        1.0, 0.0,\r\n        0.0, 0.125,\r\n        1.0, 0.0,\r\n        0.0, 0.0,\r\n    ];\r\n    let pyvt2 = [\r\n        0.0, 1.0 / 32.0,\r\n        1.0, 1.0 / 32.0,\r\n        1.0, 0.0,\r\n        0.0, 1.0 / 32.0,\r\n        1.0, 0.0,\r\n        0.0, 0.0,\r\n    ];\r\n    let pxvt = [\r\n        0.0, 0.25,\r\n        1.0, 0.25,\r\n        1.0, 0.125,\r\n        0.0, 0.25,\r\n        1.0, 0.125,\r\n        0.0, 0.125,\r\n    ];\r\n    let sandvt = [\r\n        0.0, 0.625,\r\n        1.0, 0.625,\r\n        1.0, 0.5,\r\n        0.0, 0.625,\r\n        1.0, 0.5,\r\n        0.0, 0.5,\r\n    ];\r\n    let stonevt = [\r\n        0.0, 1.0,\r\n        1.0, 1.0,\r\n        1.0, 0.875,\r\n        0.0, 1.0,\r\n        1.0, 0.875,\r\n        0.0, 0.875,\r\n    ];\r\n    let idx = [\r\n        0, 1, 2,\r\n        3, 4, 5,\r\n    ];\r\n\r\n    let sidevc = [\r\n        shadow, shadow, light,\r\n        shadow, light, light,\r\n    ]\r\n\r\n    terrainObj.v = [];\r\n    terrainObj.vn = [];\r\n    terrainObj.vt = [];\r\n    terrainObj.idx = [];\r\n    terrainObj.vc = [];\r\n    terrainObj.mesh = [];\r\n    terrainObj.width = worldWidth;\r\n    terrainObj.depth = worldDepth;\r\n\r\n    waterObj.v = [];\r\n    waterObj.vn = [];\r\n    waterObj.vt = [];\r\n    waterObj.idx = [];\r\n\r\n    let index = 0;\r\n    let index2 = 0;\r\n    let level1 = 0;\r\n    let level0 = -10;\r\n\r\n    let vertices = [];\r\n\r\n    for(var x = 0; x < worldWidth; x++){\r\n        for(var z = 0; z < worldDepth; z++){\r\n            var h = getY(x, z);\r\n            var px = getY( x + 1, z );\r\n            var nx = getY( x - 1, z );\r\n            var pz = getY( x, z + 1 );\r\n            var nz = getY( x, z - 1 );\r\n            var pxpz = getY( x + 1, z + 1 );\r\n            var nxpz = getY( x - 1, z + 1 );\r\n            var pxnz = getY( x + 1, z - 1 );\r\n            var nxnz = getY( x - 1, z - 1 );\r\n            var a = nx > h || nz > h || nxnz > h ? shadow2 : light;\r\n            var b = nx > h || pz > h || nxpz > h ? shadow2 : light;\r\n            var c = px > h || pz > h || pxpz > h ? shadow2 : light;\r\n            var d = px > h || nz > h || pxnz > h ? shadow2 : light;\r\n\r\n            let topvc = [\r\n                b, c, d,\r\n                b, d, a,\r\n            ]\r\n\r\n            for(var i = 0; i < 6; i++){\r\n                let vx = pyv[i*3] + x * 16.0;\r\n                let vy = pyv[i*3+1] + h * 16.0;\r\n                let vz = pyv[i*3+2] + z * 16.0;\r\n                terrainObj.v.push(vx);\r\n                terrainObj.v.push(vy);\r\n                terrainObj.v.push(vz);\r\n\r\n                vertices.push(vec3.fromValues(vx, vy, vz));\r\n\r\n                terrainObj.vn.push(pyvn[i*3]);\r\n                terrainObj.vn.push(pyvn[i*3+1]);\r\n                terrainObj.vn.push(pyvn[i*3+2]);\r\n                \r\n                if(h > level1){\r\n                    terrainObj.vt.push(pyvt[i*2]);\r\n                    terrainObj.vt.push(pyvt[i*2+1]);\r\n                }else if(h > level0){\r\n                    terrainObj.vt.push(sandvt[i*2]);\r\n                    terrainObj.vt.push(sandvt[i*2+1]);\r\n                }else{\r\n                    terrainObj.vt.push(stonevt[i*2]);\r\n                    terrainObj.vt.push(stonevt[i*2+1]);\r\n                }\r\n\r\n                terrainObj.idx.push(i + index*6);\r\n\r\n                terrainObj.vc.push(topvc[i]);\r\n            }\r\n            index++;\r\n            \r\n            if(h < level1 - 2){\r\n                for(var i = 0; i < 6; i++){\r\n                    waterObj.v.push(pyv2[i*3] + x * 16.0);\r\n                    waterObj.v.push(pyv2[i*3+1] + (level1 - 2) * 16.0);\r\n                    waterObj.v.push(pyv2[i*3+2] + z * 16.0);\r\n    \r\n                    waterObj.vn.push(pyvn[i*3]);\r\n                    waterObj.vn.push(pyvn[i*3+1]);\r\n                    waterObj.vn.push(pyvn[i*3+2]);\r\n\r\n                    waterObj.vt.push(pyvt2[i*2]);\r\n                    waterObj.vt.push(pyvt2[i*2+1]);\r\n    \r\n                    waterObj.idx.push(i + index2*6);\r\n                }\r\n                index2++;\r\n            }\r\n\r\n            if(px < h){\r\n                sidevc[2] = pxnz == h ? shadow2 : light;\r\n                sidevc[4] = pxnz == h ? shadow2 : light;\r\n                sidevc[5] = pxpz == h ? shadow2 : light;\r\n                for(var i = 0; i < 6; i++){\r\n                    terrainObj.v.push(pxv[i*3] + x * 16.0);\r\n                    terrainObj.v.push(pxv[i*3+1] + h * 16.0);\r\n                    terrainObj.v.push(pxv[i*3+2] + z * 16.0);\r\n    \r\n                    terrainObj.vn.push(pxvn[i*3]);\r\n                    terrainObj.vn.push(pxvn[i*3+1]);\r\n                    terrainObj.vn.push(pxvn[i*3+2]);\r\n                    \r\n                    if(h > level1){\r\n                        terrainObj.vt.push(pxvt[i*2]);\r\n                        terrainObj.vt.push(pxvt[i*2+1]);\r\n                    }else if(h > level0){\r\n                        terrainObj.vt.push(sandvt[i*2]);\r\n                        terrainObj.vt.push(sandvt[i*2+1]);\r\n                    }else{\r\n                        terrainObj.vt.push(stonevt[i*2]);\r\n                        terrainObj.vt.push(stonevt[i*2+1]);\r\n                    }\r\n    \r\n                    terrainObj.idx.push(i + index*6);\r\n                    \r\n                    terrainObj.vc.push(sidevc[i]);\r\n                }\r\n                index++;\r\n            }\r\n            if(pz < h){\r\n                sidevc[2] = pxpz == h ? shadow2 : light;\r\n                sidevc[4] = pxpz == h ? shadow2 : light;\r\n                sidevc[5] = nxpz == h ? shadow2 : light;\r\n                for(var i = 0; i < 6; i++){\r\n                    terrainObj.v.push(pzv[i*3] + x * 16.0);\r\n                    terrainObj.v.push(pzv[i*3+1] + h * 16.0);\r\n                    terrainObj.v.push(pzv[i*3+2] + z * 16.0);\r\n    \r\n                    terrainObj.vn.push(pzvn[i*3]);\r\n                    terrainObj.vn.push(pzvn[i*3+1]);\r\n                    terrainObj.vn.push(pzvn[i*3+2]);\r\n    \r\n                    if(h > level1){\r\n                        terrainObj.vt.push(pxvt[i*2]);\r\n                        terrainObj.vt.push(pxvt[i*2+1]);\r\n                    }else if(h > level0){\r\n                        terrainObj.vt.push(sandvt[i*2]);\r\n                        terrainObj.vt.push(sandvt[i*2+1]);\r\n                    }else{\r\n                        terrainObj.vt.push(stonevt[i*2]);\r\n                        terrainObj.vt.push(stonevt[i*2+1]);\r\n                    }\r\n    \r\n                    terrainObj.idx.push(i + index*6);\r\n                    \r\n                    terrainObj.vc.push(sidevc[i]);\r\n                }\r\n                index++;\r\n            }\r\n            if(nx < h){\r\n                sidevc[2] = nxpz == h ? shadow2 : light;\r\n                sidevc[4] = nxpz == h ? shadow2 : light;\r\n                sidevc[5] = nxnz == h ? shadow2 : light;\r\n                for(var i = 0; i < 6; i++){\r\n                    terrainObj.v.push(nxv[i*3] + x * 16.0);\r\n                    terrainObj.v.push(nxv[i*3+1] + h * 16.0);\r\n                    terrainObj.v.push(nxv[i*3+2] + z * 16.0);\r\n    \r\n                    terrainObj.vn.push(nxvn[i*3]);\r\n                    terrainObj.vn.push(nxvn[i*3+1]);\r\n                    terrainObj.vn.push(nxvn[i*3+2]);\r\n    \r\n                    if(h > level1){\r\n                        terrainObj.vt.push(pxvt[i*2]);\r\n                        terrainObj.vt.push(pxvt[i*2+1]);\r\n                    }else if(h > level0){\r\n                        terrainObj.vt.push(sandvt[i*2]);\r\n                        terrainObj.vt.push(sandvt[i*2+1]);\r\n                    }else{\r\n                        terrainObj.vt.push(stonevt[i*2]);\r\n                        terrainObj.vt.push(stonevt[i*2+1]);\r\n                    }\r\n    \r\n                    terrainObj.idx.push(i + index*6);\r\n                    \r\n                    terrainObj.vc.push(sidevc[i]);\r\n                }\r\n                index++;\r\n            }\r\n            if(nz < h){\r\n                sidevc[2] = nxnz == h ? shadow2 : light;\r\n                sidevc[4] = nxnz == h ? shadow2 : light;\r\n                sidevc[5] = pxnz == h ? shadow2 : light;\r\n                for(var i = 0; i < 6; i++){\r\n                    terrainObj.v.push(nzv[i*3] + x * 16.0);\r\n                    terrainObj.v.push(nzv[i*3+1] + h * 16.0);\r\n                    terrainObj.v.push(nzv[i*3+2] + z * 16.0);\r\n    \r\n                    terrainObj.vn.push(nzvn[i*3]);\r\n                    terrainObj.vn.push(nzvn[i*3+1]);\r\n                    terrainObj.vn.push(nzvn[i*3+2]);\r\n    \r\n                    if(h > level1){\r\n                        terrainObj.vt.push(pxvt[i*2]);\r\n                        terrainObj.vt.push(pxvt[i*2+1]);\r\n                    }else if(h > level0){\r\n                        terrainObj.vt.push(sandvt[i*2]);\r\n                        terrainObj.vt.push(sandvt[i*2+1]);\r\n                    }else{\r\n                        terrainObj.vt.push(stonevt[i*2]);\r\n                        terrainObj.vt.push(stonevt[i*2+1]);\r\n                    }\r\n    \r\n                    terrainObj.idx.push(i + index*6);\r\n                    \r\n                    terrainObj.vc.push(sidevc[i]);\r\n                }\r\n                index++;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // add bound mesh\r\n    let worldWidthSize = worldWidth * 16.0;\r\n    let worldDepthSize = worldDepth * 16.0;\r\n\r\n    console.log(terrainObj.v);\r\n\r\n    terrainObj.v.push(           0.0, minY * 16.0,            0.0);\r\n    terrainObj.v.push(worldWidthSize, minY * 16.0,            0.0);\r\n    terrainObj.v.push(worldWidthSize,       -17.0,            0.0);\r\n    terrainObj.v.push(           0.0, minY * 16.0,            0.0);\r\n    terrainObj.v.push(worldWidthSize,       -17.0,            0.0);\r\n    terrainObj.v.push(           0.0,       -17.0,            0.0);\r\n\r\n    for(let i=0; i<6; i++){\r\n        terrainObj.vn.push(pzvn[i*3]);\r\n        terrainObj.vn.push(pzvn[i*3+1])\r\n        terrainObj.vn.push(pzvn[i*3+2]);\r\n\r\n        terrainObj.vt.push(0.0, 0.0);\r\n        \r\n        terrainObj.idx.push(i + index*6);\r\n    }\r\n    index++;\r\n\r\n    terrainObj.v.push(worldWidthSize, minY * 16.0, worldDepthSize);\r\n    terrainObj.v.push(           0.0, minY * 16.0, worldDepthSize);\r\n    terrainObj.v.push(           0.0,       -17.0, worldDepthSize);\r\n    terrainObj.v.push(worldWidthSize, minY * 16.0, worldDepthSize);\r\n    terrainObj.v.push(           0.0,       -17.0, worldDepthSize);\r\n    terrainObj.v.push(worldWidthSize,       -17.0, worldDepthSize);\r\n\r\n    for(let i=0; i<6; i++){\r\n        terrainObj.vn.push(nzvn[i*3]);\r\n        terrainObj.vn.push(nzvn[i*3+1])\r\n        terrainObj.vn.push(nzvn[i*3+2]);\r\n\r\n        terrainObj.vt.push(0.0, 0.0);\r\n        \r\n        terrainObj.idx.push(i + index*6);\r\n    }\r\n    index++;\r\n\r\n    terrainObj.v.push(           0.0, minY * 16.0, worldDepthSize);\r\n    terrainObj.v.push(           0.0, minY * 16.0,            0.0);\r\n    terrainObj.v.push(           0.0,       -17.0,            0.0);\r\n    terrainObj.v.push(           0.0, minY * 16.0, worldDepthSize);\r\n    terrainObj.v.push(           0.0,       -17.0,            0.0);\r\n    terrainObj.v.push(           0.0,       -17.0, worldDepthSize);\r\n\r\n    for(let i=0; i<6; i++){\r\n        terrainObj.vn.push(pxvn[i*3]);\r\n        terrainObj.vn.push(pxvn[i*3+1])\r\n        terrainObj.vn.push(pxvn[i*3+2]);\r\n\r\n        terrainObj.vt.push(0.0, 0.0);\r\n        \r\n        terrainObj.idx.push(i + index*6);\r\n    }\r\n    index++;\r\n\r\n    terrainObj.v.push(worldWidthSize, minY * 16.0,            0.0);\r\n    terrainObj.v.push(worldWidthSize, minY * 16.0, worldDepthSize);\r\n    terrainObj.v.push(worldWidthSize,       -17.0, worldDepthSize);\r\n    terrainObj.v.push(worldWidthSize, minY * 16.0,            0.0);\r\n    terrainObj.v.push(worldWidthSize,       -17.0, worldDepthSize);\r\n    terrainObj.v.push(worldWidthSize,       -17.0,            0.0);\r\n\r\n    for(let i=0; i<6; i++){\r\n        terrainObj.vn.push(nxvn[i*3]);\r\n        terrainObj.vn.push(nxvn[i*3+1])\r\n        terrainObj.vn.push(nxvn[i*3+2]);\r\n\r\n        terrainObj.vt.push(0.0, 0.0);\r\n        \r\n        terrainObj.idx.push(i + index*6);\r\n    }\r\n    index++;\r\n\r\n    console.log(terrainObj.v);\r\n\r\n    // triangle for raycast\r\n    for(let i = 0; i < vertices.length / 3.0; i++){\r\n        let triangle = [];\r\n        triangle.push(vertices[i*3+0]);\r\n        triangle.push(vertices[i*3+1]);\r\n        triangle.push(vertices[i*3+2]);\r\n        terrainObj.mesh.push(triangle);\r\n    }\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./raycast.js\n\r\n\r\n/**\r\n * Ray triangle intersection algorithm \r\n * \r\n * @param rayOrigin ray origin point\r\n * @param rayVector ray direction\r\n * @param triangle three points of triangle, should be ccw order\r\n * @param out the intersection point\r\n * @return intersects or not\r\n * \r\n * Uses Möller–Trumbore intersection algorithm\r\n */\r\n\r\n// raycast\r\nfunction checkGround (origin, direction, length, obj) {\r\n    let x = Math.floor(origin[0] / 16.0);\r\n    let z = Math.floor(origin[2] / 16.0);\r\n    let idx0 = x * obj.depth * 2 + z * 2;\r\n    let idx1 = x * obj.depth * 2 + z * 2 + 1;\r\n    \r\n    if(obj.mesh[idx0] == undefined || obj.mesh[idx1] == undefined) return false;\r\n    \r\n    let ground = \r\n        checkIntersect(origin, direction, length, obj.mesh[idx0][0], obj.mesh[idx0][1], obj.mesh[idx0][2]) ||\r\n        checkIntersect(origin, direction, length, obj.mesh[idx1][0], obj.mesh[idx1][1], obj.mesh[idx1][2]);\r\n    if(ground == true) return true;\r\n    \r\n    return false;\r\n}\r\n\r\nfunction checkIntersect (origin, direction, length, v0, v1, v2) {\r\n    const eps = 0.0000001;\r\n    const edge1 = esm["vec3"].create();\r\n    const edge2 = esm["vec3"].create();\r\n    const h = esm["vec3"].create();\r\n\r\n    esm["vec3"].sub(edge1, v1, v0);\r\n    esm["vec3"].sub(edge2, v2, v0);\r\n    esm["vec3"].cross(h, direction, edge2);\r\n    const a = esm["vec3"].dot(edge1, h);\r\n\r\n    if(a > -eps && a < eps) {\r\n        return false;\r\n    }\r\n\r\n    const s = esm["vec3"].create();\r\n    esm["vec3"].sub(s, origin, v0);\r\n    const u = esm["vec3"].dot(s, h);\r\n\r\n\r\n    if (u < 0 || u > a) {\r\n        return false;\r\n    }\r\n\r\n    const q = esm["vec3"].create();\r\n    esm["vec3"].cross(q, s, edge1);\r\n    const v = esm["vec3"].dot(direction, q);\r\n\r\n    if (v < 0 || u + v > a) {\r\n        return false;\r\n    }\r\n\r\n    const t = esm["vec3"].dot(edge2, q) / a;\r\n    // console.log(t);\r\n    if (t > eps && t <= length) {\r\n        // if (out) {\r\n        //     vec3.add(out, origin, [direction[0] * t, direction[1] * t, direction[2] * t]);\r\n        //     // console.log(out);\r\n        // }\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n// unused\r\n// function projectTo3D (screencoord, viewport, invProjection, invView) {\r\n//     const [left, top, width, height] = viewport;\r\n//     const [x, y] = screenCoord;\r\n\r\n//     const out = vec4.fromValues(\r\n//         (2 * x) / width - 1 - left,\r\n//         (2 * (height - y - 1)) / height - 1,\r\n//         1,\r\n//         1,\r\n//     );\r\n\r\n//     vec4.transformMat4(out, out, invProjection);\r\n//     out[3] = 0;\r\n//     vec4.transformMat4(out, out, invView);\r\n//     return vec3.normalize(vec3.create(), out);\r\n// }\n// CONCATENATED MODULE: ./skybox.js\n\r\nvar skybox = {\r\n    view_Location: null,\r\n    project_Location: null,\r\n\r\n    tex_cubemap: null,\r\n\r\n    tex_cubemap_path: null,\r\n    tex_cubemap_width: null,\r\n    tex_cubemap_height: null,\r\n}\r\n\r\n\r\nfunction skyboxInit(gl) {\r\n    skybox.tex_cubemap_path = [];\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/StarSkybox0412.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/StarSkybox0422.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/StarSkybox0432.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/StarSkybox0442.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/StarSkybox0452.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/StarSkybox0462.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/px.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/nx.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/py.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/ny.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/pz.png\');\r\n    // skybox.tex_cubemap_path.push(\'./asset/skybox/nz.png\');\r\n\r\n    skybox.tex_cubemap_path.push(\'./asset/skybox/px.png\');\r\n    skybox.tex_cubemap_path.push(\'./asset/skybox/nx.png\');\r\n    skybox.tex_cubemap_path.push(\'./asset/skybox/nz.png\');\r\n    skybox.tex_cubemap_path.push(\'./asset/skybox/pz.png\');\r\n    skybox.tex_cubemap_path.push(\'./asset/skybox/py.png\');\r\n    skybox.tex_cubemap_path.push(\'./asset/skybox/ny.png\');\r\n\r\n    skybox.tex_cubemap_width = 2048;\r\n    skybox.tex_cubemap_height = 2048;\r\n}\r\n\r\n\r\nfunction createSkyboxTexture(gl, tex) {\r\n\r\n    skybox.tex_cubemap = gl.createTexture();\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, skybox.tex_cubemap);\r\n\r\n\r\n    for (let i = 0; i < 6; ++i) {\r\n        gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, gl.RGB, skybox.tex_cubemap_width, skybox.tex_cubemap_height, 0, gl.RGB, gl.UNSIGNED_BYTE, tex[i]);\r\n    }\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\r\n}\n// CONCATENATED MODULE: ./skylight.js\n\r\n\r\n\r\n\r\n\r\nvar skylight = {\r\n    eye: null,      // position\r\n    eyeToCamera: null,\r\n    base_eyeToCamera: null,\r\n    rot_mat: null,\r\n\r\n    pointLookat: null,\r\n    up: null,\r\n    near: null,\r\n    far: null,\r\n\r\n    range: null,\r\n\r\n    time: null,\r\n    // program time 0.1 seconds = 1 Unit = game time 0.1 minute\r\n    timeUnit: null,\r\n\r\n    //for cloud move\r\n    iTime: null,\r\n\r\n    bias: null,\r\n\r\n    color: null,\r\n\r\n    atmVao: null,\r\n    atmProgram: null,\r\n    uSunPosLocation: null,\r\n    view_Location: null,\r\n    project_Location: null,\r\n\r\n    tex_noise: null,\r\n\r\n\r\n    clouds: true,\r\n    light_scattering: true,\r\n    cloud_density: 0.03,\r\n    cloud_height: 1600.0,\r\n    cloud_thickness: 500.0,\r\n    time_pause: false,\r\n\r\n    usePreCalSunColor: true,\r\n\r\n    gamma_correction: 1.6,\r\n};\r\n\r\n\r\n\r\n\r\n////  x:E  z:N\r\n\r\nfunction skylightInit(gl, gui, global) {\r\n//-1496000000000\r\n    skylight.base_eyeToCamera = esm["vec3"].fromValues(0, -6000, 0);\r\n    skylight.rot_mat = esm["mat4"].create();\r\n    esm["mat4"].rotateX(skylight.rot_mat, skylight.rot_mat, Math.PI * 23.5 / 180.0);\r\n\r\n\r\n    skylight.time = 12.0;\r\n    skylight.timeUnit = 0.1 / 60.0;\r\n    skylight.iTime = 0.0;\r\n\r\n    skylight.eyeToCamera = esm["vec3"].create();\r\n\r\n    calculatePosition();\r\n\r\n\r\n    skylight.eye = esm["vec3"].create();\r\n    esm["vec3"].add(skylight.eye, camera.eye, skylight.eyeToCamera);\r\n    skylight.pointLookat = camera.eye;\r\n    skylight.up = esm["vec3"].fromValues(0, 1, 0);\r\n\r\n\r\n    skylight.range = 3000;\r\n    skylight.near = 0.1;\r\n    skylight.far = 12000;\r\n\r\n\r\n    // skylight.bias = 1.0004;\r\n    skylight.bias = 1.0001499999999983;\r\n\r\n\r\n\r\n    let skFolder = gui.addFolder(\'Skylight\');\r\n\r\n    let ui = skFolder.add(skylight, \'time\', 0.00, 23.99).listen();\r\n    ui.onChange((val) => {\r\n        setSkylightTime(val);\r\n    });\r\n    \r\n    skFolder.add(skylight, "time_pause");\r\n    skFolder.add(skylight, "clouds").onChange((val) => {\r\n        gl.useProgram(skylight.atmProgram);\r\n        gl.uniform1i(gl.getUniformLocation(skylight.atmProgram, "isCloud"), val);\r\n\r\n    });\r\n    skFolder.add(skylight, "cloud_density", 0.00, 0.04).onChange((val) => {\r\n        gl.useProgram(skylight.atmProgram);\r\n        gl.uniform1f(gl.getUniformLocation(skylight.atmProgram, "cloudDensity"), val);\r\n    });\r\n    skFolder.add(skylight, "cloud_height", 1000.00, 5000.0).onChange((val) => {\r\n        gl.useProgram(skylight.atmProgram);\r\n        gl.uniform1f(gl.getUniformLocation(skylight.atmProgram, "cloudHeight"), val);\r\n    });\r\n    skFolder.add(skylight, "cloud_thickness", 0.00, 1500.0).onChange((val) => {\r\n        gl.useProgram(skylight.atmProgram);\r\n        gl.uniform1f(gl.getUniformLocation(skylight.atmProgram, "cloudThickness"), val);\r\n    });\r\n\r\n    skFolder.add(skylight, "light_scattering").onChange((val) => {\r\n        gl.useProgram(skylight.atmProgram);\r\n        gl.uniform1i(gl.getUniformLocation(skylight.atmProgram, "isLightScattering"), val);\r\n    });\r\n    skFolder.add(skylight, "usePreCalSunColor").onChange((val) => {\r\n        gl.useProgram(global.program);\r\n        gl.uniform1i(gl.getUniformLocation(global.program, "usePreCalSunColor"), val);\r\n    });\r\n    skFolder.add(skylight, "gamma_correction", 1.0, 2.5).onChange((val) => {\r\n        gl.useProgram(skylight.atmProgram);\r\n        gl.uniform1f(gl.getUniformLocation(skylight.atmProgram, "gammaCor"), val);\r\n    });\r\n    skFolder.open();\r\n\r\n    \r\n    \r\n\r\n    createAtmosphere(gl, global);\r\n}\r\n\r\nfunction setSkylightTime(time) {\r\n\r\n    skylight.time = (time >= 24.0) ? time - 24.0 : time;\r\n    skylight.iTime = time;\r\n    skylightMove();\r\n}\r\n\r\nfunction addSkylightTime(addtime) {\r\n\r\n    let tmp = addtime * skylight.timeUnit;\r\n    skylight.time = (skylight.time + tmp >= 24.0) ? skylight.time + tmp - 24.0 : skylight.time + tmp;\r\n\r\n    skylight.iTime += tmp;\r\n    skylightMove();\r\n}\r\n\r\nfunction skylightMove() {\r\n\r\n    calculatePosition();\r\n\r\n    esm["vec3"].add(skylight.eye, camera.eye, skylight.eyeToCamera);\r\n\r\n    csm();\r\n}\r\n\r\nfunction calculatePosition() {\r\n\r\n    setLightColor();\r\n\r\n    //  0 12 24\r\n    // +0 +12- -0\r\n    let rotTime = skylight.time;\r\n    if(skylight.time>=12.0){\r\n        rotTime = skylight.time-24.0;\r\n    }\r\n\r\n    let tmprot = esm["mat4"].create();\r\n    esm["mat4"].rotateZ(tmprot, tmprot, Math.PI * (rotTime / 24.0) * 360 / 180.0);\r\n    let a = esm["mat4"].create();\r\n    esm["mat4"].multiply(a, tmprot, skylight.rot_mat);\r\n    esm["mat4"].rotateY(tmprot, esm["mat4"].create(), Math.PI * (rotTime / 24.0) / 180.0);\r\n    esm["mat4"].multiply(a, tmprot, a);\r\n\r\n\r\n    let b = skylight.base_eyeToCamera[0] * a[0] + skylight.base_eyeToCamera[1] * a[1] + skylight.base_eyeToCamera[2] * a[2] + 1.0 * a[3];\r\n    let c = skylight.base_eyeToCamera[0] * a[4] + skylight.base_eyeToCamera[1] * a[5] + skylight.base_eyeToCamera[2] * a[6] + 1.0 * a[7];\r\n    let d = skylight.base_eyeToCamera[0] * a[8] + skylight.base_eyeToCamera[1] * a[9] + skylight.base_eyeToCamera[2] * a[10] + 1.0 * a[11];\r\n    skylight.eyeToCamera = esm["vec3"].fromValues(b, c, d);\r\n}\r\n\r\nfunction setLightColor() {    \r\n    if (skylight.time >= 6.5 && skylight.time <= 12) {\r\n        let temp = (3200 - 10000) * (skylight.time - 12) / (6.5 - 12) + 10000;\r\n        skylight.color = tempToColor(temp);\r\n    } else if (skylight.time >= 12 && skylight.time <= 17.5) {\r\n        let temp = (3200 - 10000) * (skylight.time - 12) / (17.5 - 12) + 10000;\r\n        skylight.color = tempToColor(temp);\r\n    } else if (skylight.time >= 17.5 && skylight.time <= 18) {\r\n        let tmpcolor = tempToColor(3200);\r\n        esm["vec3"].lerp(skylight.color, [0, 0, 0], tmpcolor, (18 - skylight.time) / (18 - 17.5));\r\n    } else if (skylight.time >= 6 && skylight.time <= 6.5) {\r\n        let tmpcolor = tempToColor(3200);\r\n        esm["vec3"].lerp(skylight.color, tmpcolor, [0, 0, 0], (skylight.time - 6.5) / (6 - 6.5));\r\n    } else {\r\n        skylight.color = esm["vec3"].fromValues(0, 0, 0);\r\n    }\r\n}\r\n\r\n// calculate color by temperature(K)\r\nfunction tempToColor(Temperature) {\r\n\r\n    // sunrise sunset 3200 K\r\n    // noon 10000 K\r\n\r\n    let r;\r\n    let g;\r\n    let b;\r\n\r\n    Temperature = Temperature / 100;\r\n\r\n    // Calculate Red:\r\n    if (Temperature <= 66) {\r\n        r = 255;\r\n    } else {\r\n        r = Temperature - 60;\r\n        r = 329.698727446 * Math.pow(r, -0.1332047592);\r\n        if (r < 0) r = 0;\r\n        if (r > 255) r = 255;\r\n    }\r\n\r\n    // Calculate Green:\r\n    if (Temperature <= 66) {\r\n        g = Temperature;\r\n        g = 99.4708025861 * Math.log(g) - 161.1195681661;\r\n        if (g < 0) g = 0;\r\n        if (g > 255) g = 255;\r\n    } else {\r\n        g = Temperature - 60;\r\n        g = 288.1221695283 * Math.pow(g, -0.0755148492);\r\n        if (g < 0) g = 0;\r\n        if (g > 255) g = 255;\r\n    }\r\n\r\n    // Calculate Blue:\r\n    if (Temperature >= 66) {\r\n        b = 255;\r\n    } else {\r\n        if (Temperature <= 19) {\r\n            b = 0;\r\n        } else {\r\n            b = Temperature - 10;\r\n            b = 138.5177312231 * Math.log(b) - 305.0447927307;\r\n            if (b < 0) b = 0;\r\n            if (b > 255) b = 255;\r\n        }\r\n    }\r\n\r\n    return esm["vec3"].fromValues(r / 255, b / 255, g / 255);\r\n}\r\n\r\n\r\n\r\nfunction createAtmosphere(gl, global) {\r\n\r\n    skylight.atmProgram = shaderIdToProgram(\'atm_vs\', \'atm_fs\');\r\n\r\n\r\n    skylight.uSunPosLocation = gl.getUniformLocation(skylight.atmProgram, "uSunPos");\r\n    skylight.view_Location = gl.getUniformLocation(skylight.atmProgram, "view");\r\n    skylight.project_Location = gl.getUniformLocation(skylight.atmProgram, "projection");\r\n\r\n    gl.useProgram(skylight.atmProgram);\r\n    gl.uniform1i(gl.getUniformLocation(skylight.atmProgram, "isCloud"), skylight.clouds);\r\n    gl.uniform1f(gl.getUniformLocation(skylight.atmProgram, "cloudDensity"), skylight.cloud_density);\r\n    gl.uniform1f(gl.getUniformLocation(skylight.atmProgram, "cloudHeight"), skylight.cloud_height);\r\n    gl.uniform1f(gl.getUniformLocation(skylight.atmProgram, "cloudThickness"), skylight.cloud_thickness);\r\n    gl.uniform1i(gl.getUniformLocation(skylight.atmProgram, "isLightScattering"), skylight.light_scattering);\r\n    gl.uniform1f(gl.getUniformLocation(skylight.atmProgram, "gammaCor"), skylight.gamma_correction);\r\n\r\n    gl.useProgram(global.program);\r\n    gl.uniform1i(gl.getUniformLocation(global.program, "isCloud"), skylight.clouds);\r\n    gl.uniform1f(gl.getUniformLocation(global.program, "cloudDensity"), skylight.cloud_density);\r\n    gl.uniform1f(gl.getUniformLocation(global.program, "cloudHeight"), skylight.cloud_height);\r\n    gl.uniform1f(gl.getUniformLocation(global.program, "cloudThickness"), skylight.cloud_thickness);\r\n\r\n    let v = [\r\n        -1.0, 1.0, -1.0,\r\n        -1.0, -1.0, -1.0,\r\n        1.0, -1.0, -1.0,\r\n        1.0, -1.0, -1.0,\r\n        1.0, 1.0, -1.0,\r\n        -1.0, 1.0, -1.0,\r\n\r\n        -1.0, -1.0, 1.0,\r\n        -1.0, -1.0, -1.0,\r\n        -1.0, 1.0, -1.0,\r\n        -1.0, 1.0, -1.0,\r\n        -1.0, 1.0, 1.0,\r\n        -1.0, -1.0, 1.0,\r\n\r\n        1.0, -1.0, -1.0,\r\n        1.0, -1.0, 1.0,\r\n        1.0, 1.0, 1.0,\r\n        1.0, 1.0, 1.0,\r\n        1.0, 1.0, -1.0,\r\n        1.0, -1.0, -1.0,\r\n\r\n        -1.0, -1.0, 1.0,\r\n        -1.0, 1.0, 1.0,\r\n        1.0, 1.0, 1.0,\r\n        1.0, 1.0, 1.0,\r\n        1.0, -1.0, 1.0,\r\n        -1.0, -1.0, 1.0,\r\n\r\n        -1.0, 1.0, -1.0,\r\n        1.0, 1.0, -1.0,\r\n        1.0, 1.0, 1.0,\r\n        1.0, 1.0, 1.0,\r\n        -1.0, 1.0, 1.0,\r\n        -1.0, 1.0, -1.0,\r\n\r\n        -1.0, -1.0, -1.0,\r\n        -1.0, -1.0, 1.0,\r\n        1.0, -1.0, -1.0,\r\n        1.0, -1.0, -1.0,\r\n        -1.0, -1.0, 1.0,\r\n        1.0, -1.0, 1.0\r\n    ];\r\n    let atmVertices = new Float32Array(v);\r\n\r\n    skylight.atmVao = gl.createVertexArray();\r\n\r\n    let vbo = gl.createBuffer();\r\n\r\n    gl.bindVertexArray(skylight.atmVao);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\r\n    gl.bufferData(gl.ARRAY_BUFFER, atmVertices.byteLength, gl.STATIC_DRAW);\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, atmVertices);\r\n\r\n\r\n    // Position attribute\r\n    gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);\r\n    gl.enableVertexAttribArray(0);\r\n\r\n\r\n    gl.bindVertexArray(null);\r\n}\r\n\r\n\r\nfunction drawAtmosphere(gl, matrix, prev_program) {\r\n    // gl.disable(gl.DEPTH_TEST);\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ZERO, gl.ONE);\r\n\r\n    gl.useProgram(skylight.atmProgram);\r\n    gl.depthFunc(gl.LEQUAL);\r\n\r\n    gl.uniform3fv(skylight.uSunPosLocation, skylight.eyeToCamera);\r\n    gl.uniformMatrix4fv(skylight.view_Location, false, matrix.v);\r\n    gl.uniformMatrix4fv(skylight.project_Location, false, matrix.p);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, skybox.tex_cubemap);\r\n    gl.uniform1i(gl.getUniformLocation(skylight.atmProgram, "skybox"), 0);\r\n\r\n    gl.activeTexture(gl.TEXTURE1);\r\n    gl.bindTexture(gl.TEXTURE_2D, skylight.tex_noise);\r\n    gl.uniform1i(gl.getUniformLocation(skylight.atmProgram, "tex_noise"), 1);\r\n\r\n    gl.uniform1f(gl.getUniformLocation(skylight.atmProgram, "iTime"), skylight.iTime*100);\r\n    \r\n\r\n    // skybox rotation\r\n    //  0 12 24\r\n    // +0 +12- -0\r\n    let rotTime = skylight.time;\r\n    if(skylight.time>=12.0){\r\n        rotTime = skylight.time-24.0;\r\n    }\r\n\r\n    let rot = esm["mat4"].create();\r\n    esm["mat4"].rotateX(rot, rot, Math.PI * 23.5 / 180.0);\r\n    let b = esm["mat4"].create();\r\n    esm["mat4"].rotateZ(b, b, Math.PI * (rotTime / 24.0) * 360 / 180.0);\r\n    esm["mat4"].multiply(rot, b, rot);\r\n    esm["mat4"].rotateY(b, esm["mat4"].create(), Math.PI * (rotTime / 24.0) / 180.0);\r\n    esm["mat4"].multiply(rot, b, rot);\r\n    gl.uniformMatrix4fv(gl.getUniformLocation(skylight.atmProgram, "rot"), false, rot);\r\n\r\n    gl.bindVertexArray(skylight.atmVao);\r\n    gl.drawArrays(gl.TRIANGLES, 0, 36);\r\n    gl.bindVertexArray(null);\r\n\r\n    // gl.enable(gl.DEPTH_TEST);\r\n    gl.depthFunc(gl.LESS);\r\n    gl.useProgram(prev_program);\r\n\r\n    gl.disable(gl.BLEND);\r\n}\n// CONCATENATED MODULE: ./camera.js\n\r\n\r\n\r\n\r\n\r\n\r\nvar camera = {\r\n    eye: null,      // position\r\n    front: null,\r\n    up: null,\r\n    near: null,\r\n    far: null,\r\n\r\n    FOV: null,\r\n\r\n    yaw: null,\r\n    pitch: null,\r\n\r\n    rot_sensitivity: null,\r\n\r\n    keydown_a: null,\r\n    keydown_w: null,\r\n    keydown_d: null,\r\n    keydown_s: null,\r\n    keydown_z: null,\r\n    keydown_x: null,\r\n    keydown_shift: null,\r\n    keydown_space: null,\r\n\r\n    speed: null,\r\n    speedFast: null,\r\n\r\n    velocity_y: null,\r\n    velocity_y_min: null,\r\n\r\n    fly: false,\r\n}\r\n\r\nvar ray_direction = esm["vec3"].fromValues(0, -1, 0);\r\nvar camera_v0 = esm["vec3"].fromValues(-1, -1, 0);\r\nvar camera_v1 = esm["vec3"].fromValues(1, 1, 0);\r\nvar camera_v2 = esm["vec3"].fromValues(-1, 1, 0);\r\nvar ray_length = 16.0 * 1.7;\r\nvar camera_ground = false;\r\nvar canJump = false;\r\nvar jumpForce = 2.0;\r\nvar seaLevel = -32.0;\r\nvar waterDrag = 0.5;\r\nvar gravity = 0.0;\r\n// var out = glm.vec3.fromValues(0, 0, 0);\r\n\r\n\r\nfunction cameraInit(view_matrix, fov) {\r\n    camera.eye = esm["vec3"].fromValues(1600, 200, 2000);\r\n    camera.front = esm["vec3"].fromValues(1, 0, 0);\r\n    camera.up = esm["vec3"].fromValues(0, 1, 0);\r\n    camera.near = 0.1;\r\n    camera.far = 3200.0;\r\n\r\n    camera.FOV = fov;\r\n\r\n    camera.yaw = 0.0;\r\n    camera.pitch = 0.0;\r\n\r\n    camera.rot_sensitivity = 0.08;\r\n\r\n    camera.keydown_a = false;\r\n    camera.keydown_w = false;\r\n    camera.keydown_d = false;\r\n    camera.keydown_s = false;\r\n    camera.keydown_z = false;\r\n    camera.keydown_x = false;\r\n    camera.keydown_shift = false;\r\n    camera.keydown_space = false;\r\n\r\n    camera.speed = 1.0;\r\n    camera.speedFast = 2.0;\r\n\r\n    camera.velocity_y = 0.0;\r\n    camera.velocity_y_min = -16.0;\r\n\r\n    recalculateViewMatrix(view_matrix);\r\n}\r\n\r\nfunction cameraMove() {\r\n\r\n    //rotate\r\n    camera.front[0] = Math.cos(camera.pitch * (Math.PI / 180)) * Math.cos(camera.yaw * (Math.PI / 180));\r\n    camera.front[1] = Math.sin(camera.pitch * (Math.PI / 180));\r\n    camera.front[2] = Math.cos(camera.pitch * (Math.PI / 180)) * Math.sin(camera.yaw * (Math.PI / 180));\r\n\r\n    esm["vec3"].normalize(camera.front, camera.front);\r\n\r\n\r\n    //move\r\n    let dir_tmp = esm["vec3"].fromValues(0, 0, 0);\r\n    let move_tmp = esm["vec3"].fromValues(0, 0, 0);\r\n    let speed_tmp = (camera.keydown_shift) ? camera.speedFast : camera.speed;\r\n    let underwater = false;\r\n    if(camera.fly){\r\n        speed_tmp *= 5.0;\r\n    }else{\r\n        //underwater detection\r\n        if (camera.eye[1] < seaLevel + 16.0 * 1.7 - 2){\r\n            underwater = true;\r\n            speed_tmp *= waterDrag;\r\n        }\r\n    }\r\n\r\n\r\n\r\n    //Left\r\n    if (camera.keydown_a) {\r\n        esm["vec3"].cross(dir_tmp, camera.front, camera.up);\r\n        esm["vec3"].normalize(dir_tmp, dir_tmp);\r\n        esm["vec3"].scale(dir_tmp, dir_tmp, -speed_tmp);\r\n        esm["vec3"].add(move_tmp, move_tmp, dir_tmp);\r\n    }\r\n\r\n    //Front\r\n    if (camera.keydown_w) {\r\n        if(camera.fly){\r\n            esm["vec3"].copy(dir_tmp, camera.front);\r\n        }else{\r\n            esm["vec3"].cross(dir_tmp, camera.front, camera.up);\r\n            esm["vec3"].cross(dir_tmp, camera.up, dir_tmp);\r\n        }\r\n        esm["vec3"].normalize(dir_tmp, dir_tmp);\r\n        esm["vec3"].scale(dir_tmp, dir_tmp, speed_tmp);\r\n        esm["vec3"].add(move_tmp, move_tmp, dir_tmp);\r\n    }\r\n\r\n    //Right\r\n    if (camera.keydown_d) {\r\n        esm["vec3"].cross(dir_tmp, camera.front, camera.up);\r\n        esm["vec3"].normalize(dir_tmp, dir_tmp);\r\n        esm["vec3"].scale(dir_tmp, dir_tmp, speed_tmp);\r\n        esm["vec3"].add(move_tmp, move_tmp, dir_tmp);\r\n    }\r\n\r\n    //Back\r\n    if (camera.keydown_s) {\r\n        if(camera.fly){\r\n            esm["vec3"].copy(dir_tmp, camera.front);\r\n        }else{\r\n            esm["vec3"].cross(dir_tmp, camera.front, camera.up);\r\n            esm["vec3"].cross(dir_tmp, camera.up, dir_tmp);\r\n        }\r\n        esm["vec3"].normalize(dir_tmp, dir_tmp);\r\n        esm["vec3"].scale(dir_tmp, dir_tmp, -speed_tmp);\r\n        esm["vec3"].add(move_tmp, move_tmp, dir_tmp);\r\n    }\r\n\r\n    //Up\r\n    if (camera.keydown_z) {\r\n        esm["vec3"].copy(dir_tmp, camera.up);\r\n        esm["vec3"].scale(dir_tmp, dir_tmp, speed_tmp);\r\n        esm["vec3"].add(camera.eye, camera.eye, dir_tmp);\r\n    }\r\n\r\n    //Down\r\n    if (camera.keydown_x) {\r\n        esm["vec3"].copy(dir_tmp, camera.up);\r\n        esm["vec3"].scale(dir_tmp, dir_tmp, -speed_tmp);\r\n        esm["vec3"].add(camera.eye, camera.eye, dir_tmp);\r\n    }\r\n\r\n    // detect ground (raycast)\r\n    if(!camera.fly){\r\n        let x = Math.floor(camera.eye[0] / 16.0);\r\n        let z = Math.floor(camera.eye[2] / 16.0);\r\n        let y = camera.eye[1] / 16.0 - 2.5;\r\n\r\n        let x2 = Math.floor((camera.eye[0] + move_tmp[0]) / 16.0);\r\n        let z2 = Math.floor((camera.eye[2] + move_tmp[2]) / 16.0);\r\n\r\n        if(x2 == x || y >= getY(x2, z)){\r\n            camera.eye[0] += move_tmp[0];\r\n        }else{\r\n            console.log(y);\r\n            console.log(getY(x2, z));\r\n        }\r\n        if(z2 == z || y >= getY(x, z2)){\r\n            camera.eye[2] += move_tmp[2];\r\n        }\r\n\r\n        canJump = false;\r\n        let ground = checkGround(camera.eye, ray_direction, ray_length, terrainObj);\r\n        if (ground) {\r\n            canJump = true;\r\n            camera.velocity_y = 0.0;\r\n            gravity = 0.0;\r\n        } else {\r\n            if (underwater) {\r\n                canJump = true;\r\n                jumpForce = 1.0;\r\n                gravity = -0.02;\r\n                camera.velocity_y_min = -1;\r\n            } else {\r\n                gravity = -0.1;\r\n                jumpForce = 2.0;\r\n                camera.velocity_y_min = -16;\r\n            }\r\n        }\r\n    \r\n        if (camera.keydown_space && canJump) {\r\n            camera.velocity_y = jumpForce;\r\n        } else {\r\n            camera.velocity_y += gravity;\r\n        }\r\n    \r\n        if (camera.velocity_y < camera.velocity_y_min) {\r\n            camera.velocity_y = (camera.velocity_y_min + camera.velocity_y) / 2.0;\r\n        }\r\n\r\n        // gravity\r\n        esm["vec3"].copy(dir_tmp, camera.up);\r\n        esm["vec3"].scale(dir_tmp, dir_tmp, camera.velocity_y);\r\n        esm["vec3"].add(camera.eye, camera.eye, dir_tmp);\r\n    }else{\r\n        esm["vec3"].add(camera.eye, camera.eye, move_tmp);\r\n        gravity = 0.0;\r\n    }\r\n\r\n\r\n\r\n    // checkGround (camera.eye, ray_direction, ray_length, terrainObj);\r\n\r\n    // for (var i=0; i<terrainObj.mesh.length; i++) {\r\n    //     if( glm.vec2.distance( [terrainObj.mesh[i][0][0], terrainObj.mesh[i][0][2] ], [camera.eye[0], camera.eye[2]] ) <= 50\r\n    //     ||  glm.vec2.distance( [terrainObj.mesh[i][1][0], terrainObj.mesh[i][1][2] ], [camera.eye[0], camera.eye[2]] ) <= 50\r\n    //     ||  glm.vec2.distance( [terrainObj.mesh[i][2][0], terrainObj.mesh[i][2][2] ], [camera.eye[0], camera.eye[2]] ) <= 50\r\n    //     )\r\n    //     checkIntersect(camera.eye, ray_direction, terrainObj.mesh[i][0], terrainObj.mesh[i][1], terrainObj.mesh[i][2], out);\r\n    // }\r\n    skylight.eye = esm["vec3"].fromValues(camera.eye[0] + skylight.eyeToCamera[0], camera.eye[1] + skylight.eyeToCamera[1], camera.eye[2] + skylight.eyeToCamera[2]);\r\n}\r\n\r\nfunction recalculateViewMatrix(view_matrix) {\r\n    let center = esm["vec3"].fromValues(camera.eye[0] + camera.front[0], camera.eye[1] + camera.front[1], camera.eye[2] + camera.front[2]);\r\n    esm["mat4"].lookAt(view_matrix, camera.eye, center, camera.up);\r\n    if(skylight.eye){\r\n        csm();\r\n    }\r\n    \r\n}\n// CONCATENATED MODULE: ./control.js\n\r\n\r\n\r\nfunction controlInit() {\r\n\r\n    document.onkeydown = keyboardEventKeyDown;\r\n    document.onkeyup = keyboardEventKeyUp;\r\n    document.getElementById(\'gcanvas\').onmousedown = mouseDown;\r\n\r\n    document.addEventListener(\'pointerlockchange\', function () {\r\n        if (document.pointerLockElement == document.body) {\r\n            document.addEventListener("mousemove", mouseMove, false);\r\n        } else {\r\n            document.removeEventListener("mousemove", mouseMove, false);\r\n        }\r\n    }, false);\r\n}\r\n\r\n\r\nfunction keyboardEventKeyDown(ev) {\r\n    // console.log(ev);\r\n    switch (ev.keyCode) {\r\n        case 65: //a\r\n            camera.keydown_a = true;\r\n            break;\r\n\r\n        case 87: //w\r\n            camera.keydown_w = true;\r\n            break;\r\n\r\n        case 68: //d\r\n            camera.keydown_d = true;\r\n            break;\r\n\r\n        case 83: //s\r\n            camera.keydown_s = true;\r\n            break;\r\n\r\n        case 90: //z\r\n            camera.keydown_z = true;\r\n            break;\r\n\r\n        case 88: //x\r\n            camera.keydown_x = true;\r\n            break;\r\n\r\n        case 16: //shift\r\n            camera.keydown_shift = true;\r\n            break;\r\n\r\n        case 32: //space\r\n            camera.keydown_space = true;\r\n            break;\r\n\r\n        case 84: //t\r\n            addSkylightTime(5);\r\n            break;\r\n\r\n        case 82: //r\r\n            addSkylightTime(-5);\r\n            break;\r\n    }\r\n\r\n}\r\n\r\nfunction keyboardEventKeyUp(ev) {\r\n    // console.log(ev);\r\n    switch (ev.keyCode) {\r\n        case 65: //a\r\n            camera.keydown_a = false;\r\n            break;\r\n\r\n        case 87: //w\r\n            camera.keydown_w = false;\r\n            break;\r\n\r\n        case 68: //d\r\n            camera.keydown_d = false;\r\n            break;\r\n\r\n        case 83: //s\r\n            camera.keydown_s = false;\r\n            break;\r\n\r\n        case 90: //z\r\n            camera.keydown_z = false;\r\n            break;\r\n\r\n        case 88: //x\r\n            camera.keydown_x = false;\r\n            break;\r\n\r\n        case 16: //shift\r\n            camera.keydown_shift = false;\r\n            break;\r\n\r\n        case 32: //space\r\n            camera.keydown_space = false;\r\n    }\r\n\r\n}\r\n\r\n\r\nfunction mouseMove(ev) {\r\n\r\n    // console.log(ev);\r\n\r\n    let xoffset = ev.movementX;\r\n    let yoffset = -ev.movementY;\r\n\r\n    xoffset *= camera.rot_sensitivity;\r\n    yoffset *= camera.rot_sensitivity;\r\n\r\n    camera.yaw += xoffset;\r\n    camera.pitch += yoffset;\r\n\r\n    if (camera.pitch > 89.0)\r\n        camera.pitch = 89.0;\r\n    if (camera.pitch < -89.0)\r\n        camera.pitch = -89.0;\r\n\r\n}\r\n\r\n\r\nfunction mouseDown(ev) {\r\n\r\n    if (ev.which == 1) {\r\n        if (document.pointerLockElement == null) {\r\n            document.body.requestPointerLock();\r\n        }\r\n    }\r\n\r\n}\n// CONCATENATED MODULE: ./render.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// global variable\r\nvar render_gl = window.WebGL2RenderingContext.prototype; // specify type for code snippet\r\nvar stats = null;\r\nvar render_gui = null;\r\n\r\nvar render_global = {\r\n    program: null,\r\n    start: null,\r\n};\r\nvar render_matrix = {\r\n    m: null,\r\n    v: null,\r\n    p: null,\r\n};\r\nvar uniform = {\r\n    mvp: null,\r\n    m: null,\r\n    eye: null,\r\n    light: null,\r\n    co: null,\r\n    nm: null,\r\n    use: null,\r\n    useAO: null,\r\n    useShadow: null,\r\n    depthBufferLocation: [],\r\n    shadowMVPLocation: null,\r\n    biasLocation: null,\r\n    csmRange: [],\r\n    uL: [],\r\n    shadowColor: null,\r\n};\r\nvar model = {\r\n    vao: null,\r\n    ctr: null,\r\n    tex: [],\r\n};\r\nvar highResolutionOffset = 0;\r\nvar UI = {\r\n    Normal_Mapping: false,\r\n    High_Resolution: false,\r\n    Use_AO: true,\r\n}\r\n\r\nvar terrain = {\r\n    vao: null,\r\n    ctr: null,\r\n    tex: [],\r\n}\r\nvar water = {\r\n    vao: null,\r\n    ctr: null,\r\n    tex: [],\r\n    program: null,\r\n    mvp: null,\r\n    m: null,\r\n    eye: null,\r\n    light: null,\r\n    co: null,\r\n    nm: null,\r\n    texOffset: null,\r\n}\r\n\r\nvar shadowMap = {\r\n    program: null,\r\n    fbo: null,\r\n    depthTex: [],\r\n    size: null,\r\n    tex: null,\r\n    v: null,\r\n    p: null,\r\n    mvp: null,\r\n    mvpLocation: null,\r\n    lightMvp: null,\r\n    color: false,\r\n}\r\n\r\nvar postProcessing = {\r\n    vao: null,\r\n    program: null,\r\n    fbo: null,\r\n    mainTexture: null,\r\n    depthTexture: null,\r\n    depthBuffer: null,\r\n    mainTexLocation: null,\r\n    depthTexLocation: null,\r\n    fxaaOnLocation: null,\r\n    vignetteLocation: null,\r\n    resolutionLocation: null,\r\n}\r\n\r\nvar fxaa = {\r\n    on: false\r\n}\r\nvar vignette = {\r\n    on: true\r\n}\r\n\r\n// -------------------- csm ----------------------\r\nvar render_frames = [];\r\nvar num_csm = 3;\r\nvar csm_range = [];\r\nvar csm_range_c = [];\r\nvar light_matrices = [];\r\n// -------------------- csm ----------------------\r\n\r\nfunction initWebGL() {\r\n    let canvas = document.createElement(\'canvas\');\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n    document.querySelector(\'body\').appendChild(canvas);\r\n    canvas.setAttribute("id", "gcanvas");\r\n\r\n    render_gl = canvas.getContext(\'webgl2\');\r\n    if (!render_gl) {\r\n        alert(\'WebGL 2 not available\');\r\n    }\r\n\r\n    // get extension\r\n    render_gl.getExtension(\'EXT_color_buffer_float\');\r\n\r\n    // webgl setting\r\n    // gl.clearColor(0.478431, 0.725490, 1.0, 1.0);\r\n    render_gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n    render_gl.clearDepth(1.0);\r\n    render_gl.enable(render_gl.DEPTH_TEST);\r\n    render_gl.viewport(0, 0, render_gl.drawingBufferWidth, render_gl.drawingBufferHeight);\r\n    \r\n    // fps\r\n    stats = new stats_min();\r\n    stats.domElement.classList.add(\'navbar\')\r\n    document.body.appendChild(stats.domElement);\r\n\r\n    // gui\r\n    render_gui = new dat_gui_module["a" /* GUI */]();\r\n    render_gui.domElement.classList.add(\'navbar\');\r\n    let TeFolder = render_gui.addFolder(\'Texture\');\r\n    TeFolder.add(UI, \'Normal_Mapping\').onChange((val) => {\r\n        render_gl.useProgram(render_global.program);\r\n        render_gl.uniform1i(uniform.use, val);\r\n    });\r\n    TeFolder.add(UI, \'High_Resolution\').onChange((val) => {\r\n        highResolutionOffset = (highResolutionOffset + 2)%4\r\n    });\r\n    TeFolder.add(UI, \'Use_AO\').onChange((val) => {\r\n        render_gl.useProgram(render_global.program);\r\n        render_gl.uniform1i(uniform.useAO, val);\r\n    });\r\n    TeFolder.open();\r\n    let ShadowFolder = render_gui.addFolder("Shadow");\r\n    ShadowFolder.add(shadowMap, "color").onChange((val) => {\r\n        render_gl.useProgram(render_global.program);\r\n        render_gl.uniform1i(uniform.shadowColor, val);\r\n    });\r\n    ShadowFolder.open();\r\n    let FXAAFolder = render_gui.addFolder("FXAA");\r\n    FXAAFolder.add(fxaa, "on").onChange((val) => {\r\n        render_gl.useProgram(postProcessing.program);\r\n        render_gl.uniform1i(postProcessing.fxaaOnLocation, val);\r\n    });\r\n    FXAAFolder.open();\r\n    let VignetteFolder = render_gui.addFolder("Vignette");\r\n    VignetteFolder.add(vignette, "on").onChange((val) => {\r\n        render_gl.useProgram(postProcessing.program);\r\n        render_gl.uniform1i(postProcessing.vignetteLocation, val);\r\n    });\r\n    VignetteFolder.open();\r\n    \r\n    let cameraUIObject = function() {\r\n        this.FOV = 70;\r\n    };\r\n\r\n    let cameraUI = new cameraUIObject();\r\n    let caFolder = render_gui.addFolder(\'Camera\');\r\n    let test;\r\n    caFolder.add(cameraUI, \'FOV\', 0.01, 179.99).onChange((val) => {\r\n        esm["mat4"].perspective(render_matrix.p, Math.PI * val / 180.0, render_gl.drawingBufferWidth / render_gl.drawingBufferHeight, camera.near, camera.far);\r\n        camera.FOV = val;\r\n    });\r\n    caFolder.add(camera, "fly");\r\n    caFolder.open();\r\n\r\n\r\n\r\n    // matrix\r\n    render_matrix.m = esm["mat4"].create();\r\n    render_matrix.v = esm["mat4"].create();\r\n    render_matrix.p = esm["mat4"].create();\r\n\r\n    \r\n\r\n    cameraInit(render_matrix.v, 70);\r\n    \r\n    createShader();\r\n\r\n    skylightInit(render_gl, render_gui, render_global);\r\n\r\n    shadowProgramSetup();\r\n    shadowFrameBufferSetup();\r\n    waterProgramSetup();\r\n\r\n    postProcessingSetup();\r\n\r\n    // glm.mat4.perspective(matrix.p, Math.PI * 0.5, gl.drawingBufferWidth / gl.drawingBufferHeight, 0.1, 20000.0);\r\n    esm["mat4"].perspective(render_matrix.p, Math.PI * camera.FOV / 180.0, render_gl.drawingBufferWidth / render_gl.drawingBufferHeight, camera.near, camera.far);\r\n\r\n    if (!String.prototype.getFileName) {\r\n        String.prototype.getFileName = function () {\r\n            let element = this.split(\'/\');\r\n            return element[element.length - 1];\r\n        }\r\n    }\r\n\r\n\r\n    skyboxInit(render_gl);\r\n\r\n    // control\r\n    controlInit();\r\n}\r\n\r\nfunction csm() {\r\n    var view_matrix_inv = esm["mat4"].create();\r\n    var view_matrix_light = esm["mat4"].create();\r\n    esm["mat4"].invert(view_matrix_inv, render_matrix.v);\r\n    esm["mat4"].lookAt(view_matrix_light, esm["vec3"].scale(skylight.eye, skylight.eye, 1.0), skylight.pointLookat, skylight.up);\r\n    var aspect_ratio = render_gl.drawingBufferWidth / render_gl.drawingBufferHeight;\r\n    var tan_half_hfov = Math.tan(camera.FOV * 0.5 * Math.PI / 180.0 * aspect_ratio);\r\n    var tan_half_vfov = Math.tan(camera.FOV * 0.5 * Math.PI / 180.0);\r\n\r\n    csm_range[0] = -camera.near;\r\n    csm_range[1] = -50.0;\r\n    csm_range[2] = -200.0;\r\n    csm_range[3] = -2000.0;\r\n\r\n    var view = esm["vec4"].create();\r\n    var clip = esm["vec4"].create();\r\n    for (var i = 0; i < num_csm; i++) {\r\n        view = esm["vec4"].fromValues(0, 0, csm_range[i+1], 1);\r\n        esm["vec4"].transformMat4(clip, view, render_matrix.p);\r\n        \r\n        csm_range_c[i] = clip[2] / camera.far;\r\n    }\r\n\r\n    var xn, xf, yn, yf;\r\n    for (var i = 0; i < num_csm; i++) {\r\n        xn = csm_range[i] * tan_half_hfov;\r\n        xf = csm_range[i+1] * tan_half_hfov;\r\n        yn = csm_range[i] * tan_half_vfov;\r\n        yf = csm_range[i+1] * tan_half_vfov;\r\n        \r\n        var frustum_corners = [];\r\n        frustum_corners.length = 8;\r\n\r\n        frustum_corners[0] = esm["vec4"].fromValues(xn, yn, csm_range[i], 1);\r\n        frustum_corners[1] = esm["vec4"].fromValues(-xn, yn, csm_range[i], 1);\r\n        frustum_corners[2] = esm["vec4"].fromValues(xn, -yn, csm_range[i], 1);\r\n        frustum_corners[3] = esm["vec4"].fromValues(-xn, -yn, csm_range[i], 1);\r\n        frustum_corners[4] = esm["vec4"].fromValues(xf, yf, csm_range[i+1], 1);\r\n        frustum_corners[5] = esm["vec4"].fromValues(-xf, yf, csm_range[i+1], 1);\r\n        frustum_corners[6] = esm["vec4"].fromValues(xf, -yf, csm_range[i+1], 1);\r\n        frustum_corners[7] = esm["vec4"].fromValues(-xf, -yf, csm_range[i+1], 1);\r\n\r\n        var frustum_corners_L = [];\r\n        frustum_corners_L.length = 8;\r\n\r\n        var min_x = Number.MAX_VALUE;\r\n        var min_y = Number.MAX_VALUE;\r\n        var min_z = Number.MAX_VALUE;\r\n        var max_x = Number.MIN_VALUE;\r\n        var max_y = Number.MIN_VALUE;\r\n        var max_z = Number.MIN_VALUE;\r\n\r\n        for (var j = 0; j < 8; j++) {\r\n            frustum_corners_L[j] = esm["vec4"].create();\r\n            esm["vec4"].transformMat4(view, frustum_corners[j], view_matrix_inv);\r\n            esm["vec4"].transformMat4(frustum_corners_L[j], view, view_matrix_light);\r\n\r\n            min_x = Math.min(min_x, frustum_corners_L[j][0]);\r\n            max_x = Math.max(max_x, frustum_corners_L[j][0]);\r\n\r\n            min_y = Math.min(min_y, frustum_corners_L[j][1]);\r\n            max_y = Math.max(max_y, frustum_corners_L[j][1]);\r\n\r\n            min_z = Math.min(min_z, frustum_corners_L[j][2]);\r\n            max_z = Math.max(max_z, frustum_corners_L[j][2]);\r\n        }\r\n\r\n        light_matrices[i] = esm["mat4"].create();\r\n        esm["mat4"].ortho(light_matrices[i], min_x, max_x, min_y, max_y, -max_z, -min_z);\r\n        esm["mat4"].multiply(light_matrices[i], light_matrices[i], view_matrix_light);\r\n    }\r\n}\r\n\r\nfunction shadowProgramSetup() {\r\n\r\n    shadowMap.program = shaderIdToProgram("depth-vs", "depth-fs");\r\n\r\n    // uniform location\r\n    shadowMap.mvpLocation = render_gl.getUniformLocation(shadowMap.program, \'mvp\');\r\n}\r\n\r\nfunction shadowFrameBufferSetup() {\r\n    shadowMap.size = 8196;\r\n\r\n    for (var i = 0; i < 3; i++) {\r\n        var frame = {\r\n            fbo: null,\r\n        }\r\n        if(render_frames[i] == null){\r\n            frame.fbo = render_gl.createFramebuffer();\r\n            render_frames.push(frame);\r\n        }else{\r\n            frame = render_frames[i];\r\n        }\r\n        render_gl.bindFramebuffer(render_gl.FRAMEBUFFER, frame.fbo);\r\n\r\n        render_gl.activeTexture(render_gl.TEXTURE0);\r\n\r\n        shadowMap.depthTex[i] = render_gl.createTexture();\r\n        render_gl.bindTexture(render_gl.TEXTURE_2D, shadowMap.depthTex[i]);\r\n        render_gl.texImage2D(render_gl.TEXTURE_2D, 0, render_gl.DEPTH_COMPONENT32F, render_gl.drawingBufferWidth * 4, render_gl.drawingBufferHeight * 4, 0, render_gl.DEPTH_COMPONENT, render_gl.FLOAT, null);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MAG_FILTER, render_gl.LINEAR);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MIN_FILTER, render_gl.LINEAR);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_S, render_gl.CLAMP_TO_EDGE);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_T, render_gl.CLAMP_TO_EDGE);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_COMPARE_MODE, render_gl.COMPARE_REF_TO_TEXTURE);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_COMPARE_FUNC, render_gl.LEQUAL);\r\n        render_gl.framebufferTexture2D(render_gl.FRAMEBUFFER, render_gl.DEPTH_ATTACHMENT, render_gl.TEXTURE_2D, shadowMap.depthTex[i], 0);\r\n\r\n        render_gl.bindFramebuffer(render_gl.FRAMEBUFFER, null);\r\n    }\r\n}\r\n\r\nfunction waterProgramSetup() {\r\n    water.program = shaderIdToProgram("water_vs", "water_fs");\r\n    \r\n    // uniform location\r\n    water.mvp = render_gl.getUniformLocation(water.program, \'uMVP\');\r\n    water.co = render_gl.getUniformLocation(water.program, \'uCO\');\r\n    water.nm = render_gl.getUniformLocation(water.program, \'uNM\');\r\n    water.m = render_gl.getUniformLocation(water.program, \'uM\');\r\n    water.eye = render_gl.getUniformLocation(water.program, \'uEye\');\r\n    water.light = render_gl.getUniformLocation(water.program, \'uLight\');\r\n    water.texOffset = render_gl.getUniformLocation(water.program, \'offset\');\r\n    \r\n    render_gl.useProgram(water.program);\r\n    render_gl.uniform1i(water.co, 0);\r\n    render_gl.uniform1i(water.nm, 1);\r\n    render_gl.uniform1f(water.texOffset, 0);\r\n}\r\n\r\nfunction postProcessingSetup() {\r\n    //program\r\n    postProcessing.program = shaderIdToProgram("postProcessing-vs", "postProcessing-fs");\r\n\r\n    let v = [\r\n        1.0, -1.0, 0.0,\r\n        -1.0, -1.0, 0.0,\r\n        -1.0, 1.0, 0.0,\r\n        1.0, -1.0, 0.0,\r\n        -1.0, 1.0, 0.0,\r\n        1.0, 1.0, 0.0\r\n    ]\r\n    let vt = [\r\n        1.0, 0.0,\r\n        0.0, 0.0,\r\n        0.0, 1.0,\r\n        1.0, 0.0,\r\n        0.0, 1.0,\r\n        1.0, 1.0\r\n    ]\r\n    let idx = [\r\n        0, 1, 2, 3, 4, 5\r\n    ]\r\n    let window_positions = new Float32Array(v);\r\n    let texture_coord = new Float32Array(vt);\r\n\r\n    postProcessing.vao = render_gl.createVertexArray();\r\n    render_gl.bindVertexArray(postProcessing.vao);\r\n\r\n    let window_buffer = render_gl.createBuffer();\r\n    render_gl.bindBuffer(render_gl.ARRAY_BUFFER, window_buffer);\r\n    render_gl.bufferData(render_gl.ARRAY_BUFFER, window_positions.byteLength + texture_coord.byteLength, render_gl.STATIC_DRAW);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, 0, window_positions);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, window_positions.byteLength, texture_coord);\r\n\r\n    render_gl.vertexAttribPointer(0, 3, render_gl.FLOAT, false, 0, 0);\r\n    render_gl.enableVertexAttribArray(0);\r\n    render_gl.vertexAttribPointer(1, 2, render_gl.FLOAT, false, 0, window_positions.byteLength);\r\n    render_gl.enableVertexAttribArray(1);\r\n\r\n    let indices = new Uint32Array(idx);\r\n    let ebo = render_gl.createBuffer();\r\n    render_gl.bindBuffer(render_gl.ELEMENT_ARRAY_BUFFER, ebo);\r\n    render_gl.bufferData(render_gl.ELEMENT_ARRAY_BUFFER, indices, render_gl.STATIC_DRAW);\r\n\r\n    v.length = 0;\r\n    idx.length = 0;\r\n\r\n    postProcessing.mainTexLocation = render_gl.getUniformLocation(postProcessing.program, "uColorBuffer");\r\n    postProcessing.depthTexLocation = render_gl.getUniformLocation(postProcessing.program, "uDepthBuffer");\r\n    postProcessing.fxaaOnLocation = render_gl.getUniformLocation(postProcessing.program, "fxaaOn");\r\n    postProcessing.vignetteLocation = render_gl.getUniformLocation(postProcessing.program, "vignetteOn");\r\n    postProcessing.resolutionLocation = render_gl.getUniformLocation(postProcessing.program, "resolution");\r\n    \r\n    render_gl.useProgram(postProcessing.program);\r\n    render_gl.uniform1i(postProcessing.vignetteLocation, 1);\r\n\r\n    //fbo\r\n    postProcessing.fbo = render_gl.createFramebuffer();\r\n    \r\n    initPostProcessingTexture();\r\n}\r\n\r\nfunction createShader() {\r\n\r\n    render_global.program = shaderIdToProgram(\'vertex\', \'fragment\');\r\n\r\n    // uniform location\r\n    uniform.mvp = render_gl.getUniformLocation(render_global.program, \'uMVP\');\r\n    uniform.co = render_gl.getUniformLocation(render_global.program, \'uCO\');\r\n    uniform.nm = render_gl.getUniformLocation(render_global.program, \'uNM\');\r\n    uniform.m = render_gl.getUniformLocation(render_global.program, \'uM\');\r\n    uniform.eye = render_gl.getUniformLocation(render_global.program, \'uEye\');\r\n    uniform.light = render_gl.getUniformLocation(render_global.program, \'uLight\');\r\n    uniform.use = render_gl.getUniformLocation(render_global.program, \'uUse\');\r\n    uniform.useAO = render_gl.getUniformLocation(render_global.program, \'uUseAO\');\r\n    uniform.useShadow = render_gl.getUniformLocation(render_global.program, \'uUseShadow\');\r\n    uniform.shadowColor = render_gl.getUniformLocation(render_global.program, "shadowColor");\r\n\r\n    uniform.depthBufferLocation[0] = render_gl.getUniformLocation(render_global.program, "uDepthBuffer[0]");\r\n    uniform.depthBufferLocation[1] = render_gl.getUniformLocation(render_global.program, "uDepthBuffer[1]");\r\n    uniform.depthBufferLocation[2] = render_gl.getUniformLocation(render_global.program, "uDepthBuffer[2]");\r\n\r\n    uniform.uL[0] = render_gl.getUniformLocation(render_global.program, "uL[0]");\r\n    uniform.uL[1] = render_gl.getUniformLocation(render_global.program, "uL[1]");\r\n    uniform.uL[2] = render_gl.getUniformLocation(render_global.program, "uL[2]");\r\n\r\n    uniform.shadowMVPLocation = render_gl.getUniformLocation(render_global.program, "uShadowMVP");\r\n    uniform.biasLocation = render_gl.getUniformLocation(render_global.program, \'bias\');\r\n\r\n    uniform.csmRange[0] = render_gl.getUniformLocation(render_global.program, "uCsmRange[0]");\r\n    uniform.csmRange[1] = render_gl.getUniformLocation(render_global.program, "uCsmRange[1]");\r\n    uniform.csmRange[2] = render_gl.getUniformLocation(render_global.program, "uCsmRange[2]");\r\n\r\n\r\n    render_gl.useProgram(render_global.program);\r\n    render_gl.uniform1i(uniform.co, 0);\r\n    render_gl.uniform1i(uniform.nm, 1);\r\n    render_gl.uniform3fv(uniform.eye, camera.eye);\r\n    render_gl.uniform1i(uniform.use, UI.Normal_Mapping);\r\n    render_gl.uniform1i(uniform.useAO, UI.Use_AO);\r\n}\r\n\r\nfunction shaderIdToProgram(vsId, fsId) {\r\n    // get shader string\r\n    let vsSrc = document.getElementById(vsId).innerText.trim();\r\n    let fsSrc = document.getElementById(fsId).innerText.trim();\r\n\r\n    // create vertex shader\r\n    let vs = render_gl.createShader(render_gl.VERTEX_SHADER);\r\n    render_gl.shaderSource(vs, vsSrc);\r\n    render_gl.compileShader(vs);\r\n\r\n    if (!render_gl.getShaderParameter(vs, render_gl.COMPILE_STATUS)) {\r\n        console.error(render_gl.getShaderInfoLog(vs));\r\n    }\r\n\r\n    // create fragment shader\r\n    let fs = render_gl.createShader(render_gl.FRAGMENT_SHADER);\r\n    render_gl.shaderSource(fs, fsSrc);\r\n    render_gl.compileShader(fs);\r\n\r\n    if (!render_gl.getShaderParameter(fs, render_gl.COMPILE_STATUS)) {\r\n        console.error(render_gl.getShaderInfoLog(fs));\r\n    }\r\n\r\n    // create shader program\r\n    let retProgram = render_gl.createProgram();\r\n    render_gl.attachShader(retProgram, vs);\r\n    render_gl.attachShader(retProgram, fs);\r\n    render_gl.linkProgram(retProgram);\r\n\r\n    if (!render_gl.getProgramParameter(retProgram, render_gl.LINK_STATUS)) {\r\n        console.error(render_gl.getProgramInfoLog(retProgram));\r\n    }\r\n\r\n    return retProgram;\r\n}\r\n\r\nfunction _loadFile(url) {\r\n    let fr = new FileReader();\r\n    return new Promise((resolve, reject) => {\r\n        let req = new XMLHttpRequest();\r\n        req.open(\'GET\', url, true);\r\n        req.responseType = \'blob\';\r\n        req.onload = () => {\r\n            fr.readAsText(req.response);\r\n            fr.onload = (e) => {\r\n                let f = e.target.result;\r\n                let ls = f.split(/\\r?\\n/);\r\n                resolve(ls);\r\n            };\r\n        }\r\n        req.onerror = () => {\r\n            reject(new Error(`Failed to load file\'s url: ${url}`));\r\n        };\r\n        req.send();\r\n    });\r\n}\r\n\r\nasync function loadObj(url) {\r\n    // read file\r\n    let lines = await _loadFile(url);\r\n\r\n    // parse obj format\r\n    let v = [];\r\n    let vt = [];\r\n    let vn = [];\r\n    let idx = [];\r\n\r\n    for (let line of lines) {\r\n        line = line.split(\' \');\r\n        // console.log(line);\r\n        if (line[0] == \'v\') {\r\n            v.push(parseFloat(line[1]));\r\n            v.push(parseFloat(line[2]));\r\n            v.push(parseFloat(line[3]));\r\n        }\r\n        else if (line[0] == \'vn\') {\r\n            vn.push(parseFloat(line[1]));\r\n            vn.push(parseFloat(line[2]));\r\n            vn.push(parseFloat(line[3]));\r\n        }\r\n        else if (line[0] == \'vt\') {\r\n            vt.push(parseFloat(line[1]));\r\n            // flip vertically\r\n            vt.push(1.0 - parseFloat(line[2]));\r\n        }\r\n        else if (line[0] == \'f\') {\r\n            // start from zero\r\n            idx.push(parseInt(line[1].split(\'/\')[0]) - 1);\r\n            idx.push(parseInt(line[2].split(\'/\')[0]) - 1);\r\n            idx.push(parseInt(line[3].split(\'/\')[0]) - 1);\r\n        }\r\n    }\r\n\r\n    // compute tangent\r\n    let tn = [];\r\n    for (let i = 0; i < idx.length; i += 3) {\r\n        let idx1 = idx[i];\r\n        let idx2 = idx[i + 1];\r\n        let idx3 = idx[i + 2];\r\n\r\n        let p1 = esm["vec3"].fromValues(v[idx1 * 3 + 0], v[idx1 * 3 + 1], v[idx1 * 3 + 2]);\r\n        let p2 = esm["vec3"].fromValues(v[idx2 * 3 + 0], v[idx2 * 3 + 1], v[idx2 * 3 + 2]);\r\n        let p3 = esm["vec3"].fromValues(v[idx3 * 3 + 0], v[idx3 * 3 + 1], v[idx3 * 3 + 2]);\r\n\r\n        let n1 = esm["vec3"].fromValues(vn[idx1 * 3 + 0], vn[idx1 * 3 + 1], vn[idx1 * 3 + 2]);\r\n        let n2 = esm["vec3"].fromValues(vn[idx2 * 3 + 0], vn[idx2 * 3 + 1], vn[idx2 * 3 + 2]);\r\n        let n3 = esm["vec3"].fromValues(vn[idx3 * 3 + 0], vn[idx3 * 3 + 1], vn[idx3 * 3 + 2]);\r\n\r\n        let uv1 = esm["vec2"].fromValues(vt[idx1 * 2 + 0], vt[idx1 * 2 + 1]);\r\n        let uv2 = esm["vec2"].fromValues(vt[idx2 * 2 + 0], vt[idx2 * 2 + 1]);\r\n        let uv3 = esm["vec2"].fromValues(vt[idx3 * 2 + 0], vt[idx3 * 2 + 1]);\r\n\r\n        let dp1 = esm["vec3"].create(); esm["vec3"].sub(dp1, p2, p1);\r\n        let dp2 = esm["vec3"].create(); esm["vec3"].sub(dp2, p3, p1);\r\n\r\n        let duv1 = esm["vec2"].create(); esm["vec2"].sub(duv1, uv2, uv1);\r\n        let duv2 = esm["vec2"].create(); esm["vec2"].sub(duv2, uv3, uv1);\r\n\r\n        let r = 1.0 / (duv1[0] * duv2[1] - duv1[1] * duv2[0]);\r\n\r\n        let t = esm["vec3"].fromValues(\r\n            (dp1[0] * duv2[1] - dp2[0] * duv1[1]) * r,\r\n            (dp1[1] * duv2[1] - dp2[1] * duv1[1]) * r,\r\n            (dp1[2] * duv2[1] - dp2[2] * duv1[1]) * r\r\n        );\r\n\r\n        let t1 = esm["vec3"].create(); esm["vec3"].cross(t1, n1, t);\r\n        let t2 = esm["vec3"].create(); esm["vec3"].cross(t2, n2, t);\r\n        let t3 = esm["vec3"].create(); esm["vec3"].cross(t3, n3, t);\r\n\r\n        tn[idx1 * 3 + 0] = t1[0];\r\n        tn[idx1 * 3 + 1] = t1[1];\r\n        tn[idx1 * 3 + 2] = t1[2];\r\n\r\n        tn[idx2 * 3 + 0] = t2[0];\r\n        tn[idx2 * 3 + 1] = t2[1];\r\n        tn[idx2 * 3 + 2] = t2[2];\r\n\r\n        tn[idx3 * 3 + 0] = t3[0];\r\n        tn[idx3 * 3 + 1] = t3[1];\r\n        tn[idx3 * 3 + 2] = t3[2];\r\n    }\r\n\r\n    // stats\r\n    console.log(`Load ${url}: ${v.length} vertices, ${vt.length} texcoords, ${vn.length} normals ` +\r\n        `${tn.length} tangents ${idx.length / 3} faces`);\r\n\r\n    // vao\r\n    model.vao = render_gl.createVertexArray();\r\n    render_gl.bindVertexArray(model.vao);\r\n\r\n    // vbo\r\n    let positions = new Float32Array(v);\r\n    let normals = new Float32Array(vn);\r\n    let texcoords = new Float32Array(vt);\r\n    let tangents = new Float32Array(tn);\r\n\r\n    let vbo = render_gl.createBuffer();\r\n    render_gl.bindBuffer(render_gl.ARRAY_BUFFER, vbo);\r\n    render_gl.bufferData(render_gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength + texcoords.byteLength + tangents.byteLength, render_gl.STATIC_DRAW);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, 0, positions);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, positions.byteLength, normals);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength, texcoords);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength + texcoords.byteLength, tangents);\r\n\r\n    render_gl.vertexAttribPointer(0, 3, render_gl.FLOAT, false, 0, 0);\r\n    render_gl.enableVertexAttribArray(0);\r\n    render_gl.vertexAttribPointer(1, 3, render_gl.FLOAT, false, 0, positions.byteLength);\r\n    render_gl.enableVertexAttribArray(1);\r\n    render_gl.vertexAttribPointer(2, 2, render_gl.FLOAT, false, 0, positions.byteLength + normals.byteLength);\r\n    render_gl.enableVertexAttribArray(2);\r\n    render_gl.vertexAttribPointer(3, 3, render_gl.FLOAT, false, 0, positions.byteLength + normals.byteLength + texcoords.byteLength);\r\n    render_gl.enableVertexAttribArray(3);\r\n\r\n    // ebo\r\n    let indices = new Uint32Array(idx);\r\n    let ebo = render_gl.createBuffer();\r\n    render_gl.bindBuffer(render_gl.ELEMENT_ARRAY_BUFFER, ebo);\r\n    render_gl.bufferData(render_gl.ELEMENT_ARRAY_BUFFER, indices, render_gl.STATIC_DRAW);\r\n    model.ctr = idx.length;\r\n\r\n    // free array\r\n    v.length = 0;\r\n    vt.length = 0;\r\n    vn.length = 0;\r\n    idx.length = 0;\r\n    tn.length = 0;\r\n\r\n    render_gl.bindVertexArray(null);\r\n    return true;\r\n}\r\n\r\nfunction loadImage(url) {\r\n    return new Promise((resolve, reject) => {\r\n        let img = new Image();\r\n        img.onload = () => {\r\n            resolve(img);\r\n        };\r\n        img.onerror = () => {\r\n            reject(new Error(`Failed to load image\'s url: ${url}`));\r\n        }\r\n        img.src = url;\r\n        img.crossOrigin = \'anonymous\';\r\n    });\r\n}\r\n\r\nasync function loadTerrain() {\r\n    terrain.vao = render_gl.createVertexArray();\r\n    render_gl.bindVertexArray(terrain.vao);\r\n    generateTerrain();\r\n\r\n    let v = terrainObj.v;\r\n    let vn = terrainObj.vn;\r\n    let vt = terrainObj.vt;\r\n    let idx = terrainObj.idx;\r\n    let vc = terrainObj.vc;\r\n\r\n    // compute tangent\r\n    let tn = [];\r\n    for (let i = 0; i < idx.length; i += 3) {\r\n        let idx1 = idx[i];\r\n        let idx2 = idx[i + 1];\r\n        let idx3 = idx[i + 2];\r\n\r\n        let p1 = esm["vec3"].fromValues(v[idx1 * 3 + 0], v[idx1 * 3 + 1], v[idx1 * 3 + 2]);\r\n        let p2 = esm["vec3"].fromValues(v[idx2 * 3 + 0], v[idx2 * 3 + 1], v[idx2 * 3 + 2]);\r\n        let p3 = esm["vec3"].fromValues(v[idx3 * 3 + 0], v[idx3 * 3 + 1], v[idx3 * 3 + 2]);\r\n\r\n        let n1 = esm["vec3"].fromValues(vn[idx1 * 3 + 0], vn[idx1 * 3 + 1], vn[idx1 * 3 + 2]);\r\n        let n2 = esm["vec3"].fromValues(vn[idx2 * 3 + 0], vn[idx2 * 3 + 1], vn[idx2 * 3 + 2]);\r\n        let n3 = esm["vec3"].fromValues(vn[idx3 * 3 + 0], vn[idx3 * 3 + 1], vn[idx3 * 3 + 2]);\r\n\r\n        let uv1 = esm["vec2"].fromValues(vt[idx1 * 2 + 0], vt[idx1 * 2 + 1]);\r\n        let uv2 = esm["vec2"].fromValues(vt[idx2 * 2 + 0], vt[idx2 * 2 + 1]);\r\n        let uv3 = esm["vec2"].fromValues(vt[idx3 * 2 + 0], vt[idx3 * 2 + 1]);\r\n\r\n        let dp1 = esm["vec3"].create(); esm["vec3"].sub(dp1, p2, p1);\r\n        let dp2 = esm["vec3"].create(); esm["vec3"].sub(dp2, p3, p1);\r\n\r\n        let duv1 = esm["vec2"].create(); esm["vec2"].sub(duv1, uv2, uv1);\r\n        let duv2 = esm["vec2"].create(); esm["vec2"].sub(duv2, uv3, uv1);\r\n\r\n        let r = 1.0 / (duv1[0] * duv2[1] - duv1[1] * duv2[0]);\r\n\r\n        let t = esm["vec3"].fromValues(\r\n            (dp1[0] * duv2[1] - dp2[0] * duv1[1]) * r,\r\n            (dp1[1] * duv2[1] - dp2[1] * duv1[1]) * r,\r\n            (dp1[2] * duv2[1] - dp2[2] * duv1[1]) * r\r\n        );\r\n\r\n        let t1 = esm["vec3"].create(); esm["vec3"].cross(t1, n1, t);\r\n        let t2 = esm["vec3"].create(); esm["vec3"].cross(t2, n2, t);\r\n        let t3 = esm["vec3"].create(); esm["vec3"].cross(t3, n3, t);\r\n\r\n        tn[idx1 * 3 + 0] = t1[0];\r\n        tn[idx1 * 3 + 1] = t1[1];\r\n        tn[idx1 * 3 + 2] = t1[2];\r\n\r\n        tn[idx2 * 3 + 0] = t2[0];\r\n        tn[idx2 * 3 + 1] = t2[1];\r\n        tn[idx2 * 3 + 2] = t2[2];\r\n\r\n        tn[idx3 * 3 + 0] = t3[0];\r\n        tn[idx3 * 3 + 1] = t3[1];\r\n        tn[idx3 * 3 + 2] = t3[2];\r\n    }\r\n\r\n    let positions = new Float32Array(v);\r\n    let normals = new Float32Array(vn);\r\n    let texcoords = new Float32Array(vt);\r\n    let tangents = new Float32Array(tn);\r\n    let vertexColors = new Float32Array(vc);\r\n\r\n    let vbo = render_gl.createBuffer();\r\n    render_gl.bindBuffer(render_gl.ARRAY_BUFFER, vbo);\r\n    render_gl.bufferData(render_gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength + texcoords.byteLength + tangents.byteLength + vertexColors.byteLength, render_gl.STATIC_DRAW);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, 0, positions);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, positions.byteLength, normals);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength, texcoords);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength + texcoords.byteLength, tangents);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength + texcoords.byteLength + tangents.byteLength, vertexColors);\r\n\r\n    render_gl.vertexAttribPointer(0, 3, render_gl.FLOAT, false, 0, 0);\r\n    render_gl.enableVertexAttribArray(0);\r\n    render_gl.vertexAttribPointer(1, 3, render_gl.FLOAT, false, 0, positions.byteLength);\r\n    render_gl.enableVertexAttribArray(1);\r\n    render_gl.vertexAttribPointer(2, 2, render_gl.FLOAT, false, 0, positions.byteLength + normals.byteLength);\r\n    render_gl.enableVertexAttribArray(2);\r\n    render_gl.vertexAttribPointer(3, 3, render_gl.FLOAT, false, 0, positions.byteLength + normals.byteLength + texcoords.byteLength);\r\n    render_gl.enableVertexAttribArray(3);\r\n    render_gl.vertexAttribPointer(4, 1, render_gl.FLOAT, false, 0, positions.byteLength + normals.byteLength + texcoords.byteLength + tangents.byteLength);\r\n    render_gl.enableVertexAttribArray(4);\r\n\r\n    // ebo\r\n    let indices = new Uint32Array(idx);\r\n    let ebo = render_gl.createBuffer();\r\n    render_gl.bindBuffer(render_gl.ELEMENT_ARRAY_BUFFER, ebo);\r\n    render_gl.bufferData(render_gl.ELEMENT_ARRAY_BUFFER, indices, render_gl.STATIC_DRAW);\r\n    terrain.ctr = idx.length;\r\n\r\n    // water\r\n    water.vao = render_gl.createVertexArray();\r\n    render_gl.bindVertexArray(water.vao);\r\n\r\n    v = waterObj.v;\r\n    vn = waterObj.vn;\r\n    vt = waterObj.vt;\r\n    idx = waterObj.idx;\r\n\r\n    let positions2 = new Float32Array(v);\r\n    let normals2 = new Float32Array(vn);\r\n    let texcoords2 = new Float32Array(vt);\r\n\r\n    let vbo2 = render_gl.createBuffer();\r\n    render_gl.bindBuffer(render_gl.ARRAY_BUFFER, vbo2);\r\n    render_gl.bufferData(render_gl.ARRAY_BUFFER, positions2.byteLength + normals2.byteLength + texcoords2.byteLength, render_gl.STATIC_DRAW);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, 0, positions2);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, positions2.byteLength, normals2);\r\n    render_gl.bufferSubData(render_gl.ARRAY_BUFFER, positions2.byteLength + normals2.byteLength, texcoords2);\r\n\r\n    render_gl.vertexAttribPointer(0, 3, render_gl.FLOAT, false, 0, 0);\r\n    render_gl.enableVertexAttribArray(0);\r\n    render_gl.vertexAttribPointer(1, 3, render_gl.FLOAT, false, 0, positions2.byteLength);\r\n    render_gl.enableVertexAttribArray(1);\r\n    render_gl.vertexAttribPointer(2, 2, render_gl.FLOAT, false, 0, positions2.byteLength + normals2.byteLength);\r\n    render_gl.enableVertexAttribArray(2);\r\n\r\n    let indices2 = new Uint32Array(idx);\r\n    let ebo2 = render_gl.createBuffer();\r\n    render_gl.bindBuffer(render_gl.ELEMENT_ARRAY_BUFFER, ebo2);\r\n    render_gl.bufferData(render_gl.ELEMENT_ARRAY_BUFFER, indices2, render_gl.STATIC_DRAW);\r\n    water.ctr = idx.length;\r\n\r\n    // free array\r\n    v.length = 0;\r\n    vn.length = 0;\r\n    vt.length = 0;\r\n    idx.length = 0;\r\n    tn.length = 0;\r\n    vc.length = 0;\r\n\r\n    render_gl.bindVertexArray(null);\r\n    return true;\r\n}\r\n\r\nasync function loadAsset() {\r\n    // obj\r\n    let retTerrain = await loadTerrain();\r\n\r\n    // texture\r\n    let promises = [];\r\n    skybox.tex_cubemap_path.forEach(path => {   // 0~5\r\n        promises.push(loadImage(path));\r\n    });\r\n    promises.push(loadImage(\'./asset/atlas2.png\')); // 6\r\n    promises.push(loadImage(\'./asset/atlas2_n.png\'));  // 7\r\n    promises.push(loadImage(\'./asset/atlas3.png\')); // 8\r\n    promises.push(loadImage(\'./asset/atlas3_n.png\'));  // 9\r\n    promises.push(loadImage(\'./asset/water_still.png\'));  // 10\r\n    promises.push(loadImage(\'./asset/noisy-texture.png\'));  // 11\r\n    let results = await Promise.all(promises);\r\n\r\n    render_gl.activeTexture(render_gl.TEXTURE0);\r\n\r\n    for(let i = 0; i < 4; i++){\r\n        terrain.tex[i] = render_gl.createTexture();\r\n        render_gl.bindTexture(render_gl.TEXTURE_2D, terrain.tex[i]);\r\n        render_gl.texImage2D(render_gl.TEXTURE_2D, 0, render_gl.RGBA, render_gl.RGBA, render_gl.UNSIGNED_BYTE, results[6 + i]);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_S, render_gl.REPEAT);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_T, render_gl.REPEAT);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MIN_FILTER, render_gl.NEAREST);\r\n        render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MAG_FILTER, render_gl.NEAREST);\r\n    }\r\n\r\n    water.tex[0] = render_gl.createTexture();\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, water.tex[0]);\r\n    render_gl.texImage2D(render_gl.TEXTURE_2D, 0, render_gl.RGBA, render_gl.RGBA, render_gl.UNSIGNED_BYTE, results[10]);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_S, render_gl.REPEAT);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_T, render_gl.REPEAT);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MIN_FILTER, render_gl.NEAREST);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MAG_FILTER, render_gl.NEAREST);\r\n\r\n\r\n    skylight.tex_noise = render_gl.createTexture();\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, skylight.tex_noise);\r\n    render_gl.texImage2D(render_gl.TEXTURE_2D, 0, render_gl.RGBA, render_gl.RGBA, render_gl.UNSIGNED_BYTE, results[11]);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_S, render_gl.REPEAT);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_T, render_gl.REPEAT);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MIN_FILTER, render_gl.LINEAR);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MAG_FILTER, render_gl.LINEAR);\r\n\r\n\r\n\r\n\r\n    createSkyboxTexture(render_gl, results);\r\n\r\n\r\n    results.length = 0;\r\n}\r\n\r\nfunction render(time) {\r\n    // update time\r\n    if (!render_global.start) {\r\n        render_global.start = time;\r\n    }\r\n    // in milliseconds\r\n    let delta = time - render_global.start;\r\n    render_global.start = time;\r\n\r\n    \r\n    if(!skylight.time_pause){\r\n        addSkylightTime(delta / 100.0);\r\n    }\r\n    \r\n\r\n    stats.update();\r\n\r\n    cameraMove();\r\n    recalculateViewMatrix(render_matrix.v);\r\n\r\n    let mvp = esm["mat4"].create();\r\n    let smvp = esm["mat4"].create();\r\n\r\n    //========================shadow pass========================\r\n    for (var i = 0; i < 3; i++) {\r\n        render_gl.bindFramebuffer(render_gl.FRAMEBUFFER, render_frames[i].fbo);\r\n\r\n        render_gl.viewport(0, 0, render_gl.drawingBufferWidth * 4, render_gl.drawingBufferHeight * 4);\r\n        render_gl.clear(render_gl.COLOR_BUFFER_BIT | render_gl.DEPTH_BUFFER_BIT);\r\n\r\n        render_gl.useProgram(shadowMap.program);\r\n\r\n        render_gl.enable(render_gl.POLYGON_OFFSET_FILL);\r\n        render_gl.polygonOffset(4.0, 4.0);\r\n\r\n        esm["mat4"].multiply(smvp, light_matrices[i], render_matrix.m);\r\n        render_gl.uniformMatrix4fv(shadowMap.mvpLocation, false, smvp);\r\n\r\n        render_gl.bindVertexArray(terrain.vao);\r\n        render_gl.drawElements(render_gl.TRIANGLES, terrain.ctr, render_gl.UNSIGNED_INT, 0);\r\n\r\n        render_gl.disable(render_gl.POLYGON_OFFSET_FILL);\r\n    }\r\n    //======================= shadow pass =======================\r\n\r\n    //======================== main pass ========================\r\n    render_gl.bindFramebuffer(render_gl.FRAMEBUFFER, postProcessing.fbo);\r\n    render_gl.viewport(0, 0, render_gl.drawingBufferWidth, render_gl.drawingBufferHeight);\r\n    render_gl.clear(render_gl.COLOR_BUFFER_BIT | render_gl.DEPTH_BUFFER_BIT);\r\n    \r\n    // drawAtmosphere(gl, matrix, global.program);\r\n    \r\n    render_gl.useProgram(render_global.program);\r\n\r\n    render_gl.activeTexture(render_gl.TEXTURE0);\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, terrain.tex[0 + highResolutionOffset]);\r\n    render_gl.activeTexture(render_gl.TEXTURE1);\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, terrain.tex[1 + highResolutionOffset]);\r\n    render_gl.activeTexture(render_gl.TEXTURE3);\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, shadowMap.depthTex[0]);\r\n    render_gl.activeTexture(render_gl.TEXTURE4);\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, shadowMap.depthTex[1]);\r\n    render_gl.activeTexture(render_gl.TEXTURE5);\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, shadowMap.depthTex[2]);\r\n\r\n\r\n    esm["mat4"].multiply(mvp, render_matrix.p, render_matrix.v);\r\n    esm["mat4"].multiply(mvp, mvp, render_matrix.m);\r\n    render_gl.uniformMatrix4fv(uniform.mvp, false, mvp);\r\n    render_gl.uniformMatrix4fv(uniform.m, false, render_matrix.m);\r\n    render_gl.uniform3fv(uniform.eye, camera.eye);\r\n    render_gl.uniform3fv(uniform.light, skylight.eye);\r\n    render_gl.uniform1i(uniform.useShadow, 1);\r\n    \r\n    render_gl.uniform3fv(render_gl.getUniformLocation(render_global.program, \'light_color\'), skylight.color);\r\n    render_gl.uniform1i(render_gl.getUniformLocation(render_global.program, "usePreCalSunColor"), skylight.usePreCalSunColor);\r\n\r\n\r\n\r\n    // csm range\r\n    render_gl.uniform1f(uniform.csmRange[0], csm_range_c[0]);\r\n    render_gl.uniform1f(uniform.csmRange[1], csm_range_c[1]);\r\n    render_gl.uniform1f(uniform.csmRange[2], csm_range_c[2]);\r\n\r\n    render_gl.uniform1i(uniform.depthBufferLocation[0], 3);\r\n    render_gl.uniform1i(uniform.depthBufferLocation[1], 4);\r\n    render_gl.uniform1i(uniform.depthBufferLocation[2], 5);\r\n\r\n    render_gl.uniformMatrix4fv(uniform.uL[0], false, light_matrices[0]);\r\n    render_gl.uniformMatrix4fv(uniform.uL[1], false, light_matrices[1]);\r\n    render_gl.uniformMatrix4fv(uniform.uL[2], false, light_matrices[2]);\r\n\r\n    render_gl.uniformMatrix4fv(uniform.shadowMVPLocation, false, smvp);\r\n    render_gl.uniform1f(uniform.biasLocation, skylight.bias);\r\n\r\n    render_gl.bindVertexArray(terrain.vao);\r\n    render_gl.drawElements(render_gl.TRIANGLES, terrain.ctr, render_gl.UNSIGNED_INT, 0);\r\n\r\n    // drawSkybox(gl, matrix, global.program);\r\n    drawAtmosphere(render_gl, render_matrix, render_global.program);\r\n    \r\n    //======================== main pass ========================\r\n\r\n    //======================= water pass ========================\r\n    render_gl.enable(render_gl.BLEND);\r\n    render_gl.blendFuncSeparate(render_gl.SRC_ALPHA, render_gl.ONE_MINUS_SRC_ALPHA, render_gl.ZERO, render_gl.ONE);\r\n    render_gl.useProgram(water.program);\r\n\r\n    render_gl.activeTexture(render_gl.TEXTURE0);\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, water.tex[0]);\r\n\r\n    render_gl.uniformMatrix4fv(water.mvp, false, mvp);\r\n    render_gl.uniformMatrix4fv(water.m, false, render_matrix.m);\r\n    render_gl.uniform3fv(water.light, skylight.eye);\r\n    render_gl.uniform3fv(water.eye, camera.eye);\r\n    render_gl.uniform1f(water.texOffset, Math.floor(time / 64) % 32);\r\n\r\n    render_gl.bindVertexArray(water.vao);\r\n    render_gl.drawElements(render_gl.TRIANGLES, water.ctr, render_gl.UNSIGNED_INT, 0);\r\n\r\n    render_gl.disable(render_gl.BLEND);\r\n    //======================= water pass ========================\r\n\r\n\r\n    //===================== post processing =====================\r\n    render_gl.bindFramebuffer(render_gl.FRAMEBUFFER, null);\r\n    render_gl.clear(render_gl.COLOR_BUFFER_BIT | render_gl.DEPTH_BUFFER_BIT);\r\n    render_gl.useProgram(postProcessing.program);\r\n\r\n    render_gl.activeTexture(render_gl.TEXTURE0);\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, postProcessing.mainTexture);\r\n    render_gl.uniform1i(postProcessing.mainTexLocation, 0);\r\n    render_gl.activeTexture(render_gl.TEXTURE1);\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, postProcessing.depthTexture);\r\n    render_gl.uniform1i(postProcessing.depthTexLocation, 1);\r\n\r\n    render_gl.uniform2fv(postProcessing.resolutionLocation, esm["vec2"].fromValues(render_gl.drawingBufferWidth, render_gl.drawingBufferHeight));\r\n\r\n    render_gl.bindVertexArray(postProcessing.vao);\r\n\r\n    render_gl.drawElements(render_gl.TRIANGLES, 6, render_gl.UNSIGNED_INT, 0);\r\n    //===================== post processing =====================\r\n}\r\n\r\nfunction initPostProcessingTexture() {\r\n    render_gl.bindFramebuffer(render_gl.FRAMEBUFFER, postProcessing.fbo);\r\n\r\n    render_gl.deleteTexture(postProcessing.mainTexture);\r\n    render_gl.deleteTexture(postProcessing.depthTexture);\r\n    render_gl.deleteRenderbuffer(postProcessing.depthBuffer);\r\n\r\n    render_gl.activeTexture(render_gl.TEXTURE0);\r\n\r\n    postProcessing.mainTexture = render_gl.createTexture();\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, postProcessing.mainTexture)\r\n    render_gl.pixelStorei(render_gl.UNPACK_FLIP_Y_WEBGL, false);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MAG_FILTER, render_gl.NEAREST);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MIN_FILTER, render_gl.NEAREST);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_S, render_gl.MIRRORED_REPEAT);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_T, render_gl.MIRRORED_REPEAT);\r\n    render_gl.texStorage2D(render_gl.TEXTURE_2D, 1, render_gl.RGBA32F, render_gl.drawingBufferWidth, render_gl.drawingBufferHeight);\r\n    render_gl.framebufferTexture2D(render_gl.FRAMEBUFFER, render_gl.COLOR_ATTACHMENT0, render_gl.TEXTURE_2D, postProcessing.mainTexture, 0);\r\n\r\n    postProcessing.depthTexture = render_gl.createTexture();\r\n    render_gl.bindTexture(render_gl.TEXTURE_2D, postProcessing.depthTexture)\r\n    render_gl.pixelStorei(render_gl.UNPACK_FLIP_Y_WEBGL, false);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MAG_FILTER, render_gl.NEAREST);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_MIN_FILTER, render_gl.NEAREST);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_S, render_gl.MIRRORED_REPEAT);\r\n    render_gl.texParameteri(render_gl.TEXTURE_2D, render_gl.TEXTURE_WRAP_T, render_gl.MIRRORED_REPEAT);\r\n    render_gl.texStorage2D(render_gl.TEXTURE_2D, 1, render_gl.RGBA32F, render_gl.drawingBufferWidth, render_gl.drawingBufferHeight);\r\n    render_gl.framebufferTexture2D(render_gl.FRAMEBUFFER, render_gl.COLOR_ATTACHMENT1, render_gl.TEXTURE_2D, postProcessing.depthTexture, 0);\r\n\r\n    postProcessing.depthBuffer = render_gl.createRenderbuffer();\r\n    render_gl.bindRenderbuffer(render_gl.RENDERBUFFER, postProcessing.depthBuffer);\r\n    render_gl.renderbufferStorage(render_gl.RENDERBUFFER, render_gl.DEPTH_COMPONENT32F, render_gl.drawingBufferWidth, render_gl.drawingBufferHeight);\r\n    render_gl.framebufferRenderbuffer(render_gl.FRAMEBUFFER, render_gl.DEPTH_ATTACHMENT, render_gl.RENDERBUFFER, postProcessing.depthBuffer);\r\n\r\n    // gl.texImage2D(gl.TEXTURE_2D, 0, gl.DEPTH_COMPONENT32F, gl.drawingBufferWidth, gl.drawingBufferHeight, 0, gl.DEPTH_COMPONENT, gl.FLOAT, null);\r\n    // gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n    // gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n    // gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    // gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    // gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, depthBuffer, 0);\r\n\r\n    render_gl.drawBuffers([render_gl.COLOR_ATTACHMENT0, render_gl.COLOR_ATTACHMENT1]);\r\n\r\n    render_gl.bindFramebuffer(render_gl.FRAMEBUFFER, null);\r\n}\r\n\r\nfunction resize() {\r\n    let canvas = document.querySelector(\'canvas\');\r\n\r\n    if (render_gl && canvas) {\r\n        canvas.width = window.innerWidth;\r\n        canvas.height = window.innerHeight;\r\n        // glm.mat4.perspective(matrix.p, Math.PI * 0.7, gl.drawingBufferWidth / gl.drawingBufferHeight, 0.1, 20000.0);\r\n        esm["mat4"].perspective(render_matrix.p, Math.PI * camera.FOV / 180.0, render_gl.drawingBufferWidth / render_gl.drawingBufferHeight, camera.near, camera.far);\r\n        render_gl.viewport(0, 0, render_gl.drawingBufferWidth, render_gl.drawingBufferHeight);\r\n\r\n        initPostProcessingTexture();\r\n        shadowFrameBufferSetup();\r\n    }\r\n}\n// CONCATENATED MODULE: ./main.js\n\r\n\r\n\r\nfunction animate(time) {\r\n\r\n    render(time);\r\n\r\n    window.requestAnimationFrame(animate);\r\n}\r\n\r\nwindow.onresize = () => {\r\n    resize();\r\n}\r\n\r\nwindow.onload = () => {\r\n    initWebGL();\r\n    //createShader();\r\n    loadAsset().then(() => {\r\n        // rendering loop\r\n        window.requestAnimationFrame(animate);\r\n    });\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3RlcnJhaW4uanM/YWQ0ZiIsIndlYnBhY2s6Ly8vLi9yYXljYXN0LmpzPzAwMmYiLCJ3ZWJwYWNrOi8vLy4vc2t5Ym94LmpzPzczNDUiLCJ3ZWJwYWNrOi8vLy4vc2t5bGlnaHQuanM/ZjQ1NyIsIndlYnBhY2s6Ly8vLi9jYW1lcmEuanM/ZDZmNyIsIndlYnBhY2s6Ly8vLi9jb250cm9sLmpzPzk5MDQiLCJ3ZWJwYWNrOi8vLy4vcmVuZGVyLmpzP2I3ZjMiLCJ3ZWJwYWNrOi8vLy4vbWFpbi5qcz8xZDUwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEltcHJvdmVkTm9pc2UgZnJvbSAnLi9pbXByb3ZlZC1ub2lzZSc7XHJcblxyXG5jb25zdCB7IHZlYzMgfSA9IHJlcXVpcmUoJ2dsLW1hdHJpeCcpO1xyXG5cclxudmFyIG1pblkgPSAwO1xyXG52YXIgd29ybGRXaWR0aCA9IDIwMCwgd29ybGREZXB0aCA9IDIwMDtcclxudmFyIGRhdGEgPSBnZW5lcmF0ZUhlaWdodCggd29ybGRXaWR0aCwgd29ybGREZXB0aCApO1xyXG52YXIgbGlnaHQgPSAxLjA7XHJcbnZhciBzaGFkb3cgPSAwLjc7XHJcbnZhciBzaGFkb3cyID0gMC44O1xyXG5cclxuZXhwb3J0IHZhciB0ZXJyYWluT2JqID0ge1xyXG4gICAgdjogbnVsbCxcclxuICAgIHZuOiBudWxsLFxyXG4gICAgdnQ6IG51bGwsXHJcbiAgICBpZHg6IG51bGwsXHJcbiAgICB2YzogbnVsbCxcclxuICAgIG1lc2g6IG51bGwsXHJcbiAgICB3aWR0aDogbnVsbCxcclxuICAgIGRlcHRoOiBudWxsLFxyXG59XHJcbmV4cG9ydCB2YXIgd2F0ZXJPYmogPSB7XHJcbiAgICB2OiBudWxsLFxyXG4gICAgdm46IG51bGwsXHJcbiAgICB2dDogbnVsbCxcclxuICAgIGlkeDogbnVsbCxcclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVIZWlnaHQoIHdpZHRoLCBoZWlnaHQgKSB7XHJcbiAgICB2YXIgZGF0YSA9IFtdLCBwZXJsaW4gPSBuZXcgSW1wcm92ZWROb2lzZSgpLFxyXG4gICAgICAgIHNpemUgPSB3aWR0aCAqIGhlaWdodCwgcXVhbGl0eSA9IDIsIHogPSBNYXRoLnJhbmRvbSgpICogMTAwO1xyXG4gICAgZm9yICggdmFyIGogPSAwOyBqIDwgNDsgaiArKyApIHtcclxuICAgICAgICBpZiAoIGogPT0gMCApIGZvciAoIHZhciBpID0gMDsgaSA8IHNpemU7IGkgKysgKSBkYXRhWyBpIF0gPSAwO1xyXG4gICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHNpemU7IGkgKysgKSB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gaSAlIHdpZHRoLCB5ID0gKCBpIC8gd2lkdGggKSB8IDA7XHJcbiAgICAgICAgICAgIGRhdGFbIGkgXSArPSBwZXJsaW4ubm9pc2UoIHggLyBxdWFsaXR5LCB5IC8gcXVhbGl0eSwgeiApICogcXVhbGl0eTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcXVhbGl0eSAqPSA0O1xyXG4gICAgfVxyXG4gICAgbWluWSA9IE1hdGgubWluKC4uLmRhdGEpICogMC4yIHwgMDtcclxuICAgIGNvbnNvbGUubG9nKG1pblkpO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRZKCB4LCB6ICkge1xyXG4gICAgcmV0dXJuICggZGF0YVsgeCAqIHdvcmxkRGVwdGggKyB6IF0gKiAwLjIgKSB8IDA7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVRlcnJhaW4oKSB7XHJcbiAgICBsZXQgcHl2ID0gW1xyXG4gICAgICAgIDAuMCwgMTYuMCwgMTYuMCxcclxuICAgICAgICAxNi4wLCAxNi4wLCAxNi4wLFxyXG4gICAgICAgIDE2LjAsIDE2LjAsIDAuMCxcclxuICAgICAgICAwLjAsIDE2LjAsIDE2LjAsXHJcbiAgICAgICAgMTYuMCwgMTYuMCwgMC4wLFxyXG4gICAgICAgIDAuMCwgMTYuMCwgMC4wLFxyXG4gICAgXTtcclxuICAgIGxldCBweXYyID0gW1xyXG4gICAgICAgIDAuMCwgMTUuMCwgMTYuMCxcclxuICAgICAgICAxNi4wLCAxNS4wLCAxNi4wLFxyXG4gICAgICAgIDE2LjAsIDE1LjAsIDAuMCxcclxuICAgICAgICAwLjAsIDE1LjAsIDE2LjAsXHJcbiAgICAgICAgMTYuMCwgMTUuMCwgMC4wLFxyXG4gICAgICAgIDAuMCwgMTUuMCwgMC4wLFxyXG4gICAgXTtcclxuICAgIGxldCBweHYgPSBbXHJcbiAgICAgICAgMTYuMCwgMC4wLCAxNi4wLFxyXG4gICAgICAgIDE2LjAsIDAuMCwgMC4wLFxyXG4gICAgICAgIDE2LjAsIDE2LjAsIDAuMCxcclxuICAgICAgICAxNi4wLCAwLjAsIDE2LjAsXHJcbiAgICAgICAgMTYuMCwgMTYuMCwgMC4wLFxyXG4gICAgICAgIDE2LjAsIDE2LjAsIDE2LjAsXHJcbiAgICBdO1xyXG4gICAgbGV0IHB6diA9IFtcclxuICAgICAgICAwLjAsIDAuMCwgMTYuMCxcclxuICAgICAgICAxNi4wLCAwLjAsIDE2LjAsXHJcbiAgICAgICAgMTYuMCwgMTYuMCwgMTYuMCxcclxuICAgICAgICAwLjAsIDAuMCwgMTYuMCxcclxuICAgICAgICAxNi4wLCAxNi4wLCAxNi4wLFxyXG4gICAgICAgIDAuMCwgMTYuMCwgMTYuMCxcclxuICAgIF07XHJcbiAgICBsZXQgbnh2ID0gW1xyXG4gICAgICAgIDAuMCwgMC4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAwLjAsIDE2LjAsXHJcbiAgICAgICAgMC4wLCAxNi4wLCAxNi4wLFxyXG4gICAgICAgIDAuMCwgMC4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAxNi4wLCAxNi4wLFxyXG4gICAgICAgIDAuMCwgMTYuMCwgMC4wLFxyXG4gICAgXTtcclxuICAgIGxldCBuenYgPSBbXHJcbiAgICAgICAgMTYuMCwgMC4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAwLjAsIDAuMCxcclxuICAgICAgICAwLjAsIDE2LjAsIDAuMCxcclxuICAgICAgICAxNi4wLCAwLjAsIDAuMCxcclxuICAgICAgICAwLjAsIDE2LjAsIDAuMCxcclxuICAgICAgICAxNi4wLCAxNi4wLCAwLjAsXHJcbiAgICBdO1xyXG5cclxuXHJcbiAgICBsZXQgcHl2biA9IFtcclxuICAgICAgICAwLjAsIDEuMCwgMC4wLFxyXG4gICAgICAgIDAuMCwgMS4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAxLjAsIDAuMCxcclxuICAgICAgICAwLjAsIDEuMCwgMC4wLFxyXG4gICAgICAgIDAuMCwgMS4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAxLjAsIDAuMCxcclxuICAgIF07XHJcbiAgICBsZXQgcHh2biA9IFtcclxuICAgICAgICAxLjAsIDAuMCwgMC4wLFxyXG4gICAgICAgIDEuMCwgMC4wLCAwLjAsXHJcbiAgICAgICAgMS4wLCAwLjAsIDAuMCxcclxuICAgICAgICAxLjAsIDAuMCwgMC4wLFxyXG4gICAgICAgIDEuMCwgMC4wLCAwLjAsXHJcbiAgICAgICAgMS4wLCAwLjAsIDAuMCxcclxuICAgIF07XHJcbiAgICBsZXQgcHp2biA9IFtcclxuICAgICAgICAwLjAsIDAuMCwgMS4wLFxyXG4gICAgICAgIDAuMCwgMC4wLCAxLjAsXHJcbiAgICAgICAgMC4wLCAwLjAsIDEuMCxcclxuICAgICAgICAwLjAsIDAuMCwgMS4wLFxyXG4gICAgICAgIDAuMCwgMC4wLCAxLjAsXHJcbiAgICAgICAgMC4wLCAwLjAsIDEuMCxcclxuICAgIF07XHJcbiAgICBsZXQgbnh2biA9IFtcclxuICAgICAgICAtMS4wLCAwLjAsIDAuMCxcclxuICAgICAgICAtMS4wLCAwLjAsIDAuMCxcclxuICAgICAgICAtMS4wLCAwLjAsIDAuMCxcclxuICAgICAgICAtMS4wLCAwLjAsIDAuMCxcclxuICAgICAgICAtMS4wLCAwLjAsIDAuMCxcclxuICAgICAgICAtMS4wLCAwLjAsIDAuMCxcclxuICAgIF07XHJcbiAgICBsZXQgbnp2biA9IFtcclxuICAgICAgICAwLjAsIDAuMCwgLTEuMCxcclxuICAgICAgICAwLjAsIDAuMCwgLTEuMCxcclxuICAgICAgICAwLjAsIDAuMCwgLTEuMCxcclxuICAgICAgICAwLjAsIDAuMCwgLTEuMCxcclxuICAgICAgICAwLjAsIDAuMCwgLTEuMCxcclxuICAgICAgICAwLjAsIDAuMCwgLTEuMCxcclxuICAgIF07XHJcblxyXG4gICAgbGV0IHB5dnQgPSBbXHJcbiAgICAgICAgMC4wLCAwLjEyNSxcclxuICAgICAgICAxLjAsIDAuMTI1LFxyXG4gICAgICAgIDEuMCwgMC4wLFxyXG4gICAgICAgIDAuMCwgMC4xMjUsXHJcbiAgICAgICAgMS4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAwLjAsXHJcbiAgICBdO1xyXG4gICAgbGV0IHB5dnQyID0gW1xyXG4gICAgICAgIDAuMCwgMS4wIC8gMzIuMCxcclxuICAgICAgICAxLjAsIDEuMCAvIDMyLjAsXHJcbiAgICAgICAgMS4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAxLjAgLyAzMi4wLFxyXG4gICAgICAgIDEuMCwgMC4wLFxyXG4gICAgICAgIDAuMCwgMC4wLFxyXG4gICAgXTtcclxuICAgIGxldCBweHZ0ID0gW1xyXG4gICAgICAgIDAuMCwgMC4yNSxcclxuICAgICAgICAxLjAsIDAuMjUsXHJcbiAgICAgICAgMS4wLCAwLjEyNSxcclxuICAgICAgICAwLjAsIDAuMjUsXHJcbiAgICAgICAgMS4wLCAwLjEyNSxcclxuICAgICAgICAwLjAsIDAuMTI1LFxyXG4gICAgXTtcclxuICAgIGxldCBzYW5kdnQgPSBbXHJcbiAgICAgICAgMC4wLCAwLjYyNSxcclxuICAgICAgICAxLjAsIDAuNjI1LFxyXG4gICAgICAgIDEuMCwgMC41LFxyXG4gICAgICAgIDAuMCwgMC42MjUsXHJcbiAgICAgICAgMS4wLCAwLjUsXHJcbiAgICAgICAgMC4wLCAwLjUsXHJcbiAgICBdO1xyXG4gICAgbGV0IHN0b25ldnQgPSBbXHJcbiAgICAgICAgMC4wLCAxLjAsXHJcbiAgICAgICAgMS4wLCAxLjAsXHJcbiAgICAgICAgMS4wLCAwLjg3NSxcclxuICAgICAgICAwLjAsIDEuMCxcclxuICAgICAgICAxLjAsIDAuODc1LFxyXG4gICAgICAgIDAuMCwgMC44NzUsXHJcbiAgICBdO1xyXG4gICAgbGV0IGlkeCA9IFtcclxuICAgICAgICAwLCAxLCAyLFxyXG4gICAgICAgIDMsIDQsIDUsXHJcbiAgICBdO1xyXG5cclxuICAgIGxldCBzaWRldmMgPSBbXHJcbiAgICAgICAgc2hhZG93LCBzaGFkb3csIGxpZ2h0LFxyXG4gICAgICAgIHNoYWRvdywgbGlnaHQsIGxpZ2h0LFxyXG4gICAgXVxyXG5cclxuICAgIHRlcnJhaW5PYmoudiA9IFtdO1xyXG4gICAgdGVycmFpbk9iai52biA9IFtdO1xyXG4gICAgdGVycmFpbk9iai52dCA9IFtdO1xyXG4gICAgdGVycmFpbk9iai5pZHggPSBbXTtcclxuICAgIHRlcnJhaW5PYmoudmMgPSBbXTtcclxuICAgIHRlcnJhaW5PYmoubWVzaCA9IFtdO1xyXG4gICAgdGVycmFpbk9iai53aWR0aCA9IHdvcmxkV2lkdGg7XHJcbiAgICB0ZXJyYWluT2JqLmRlcHRoID0gd29ybGREZXB0aDtcclxuXHJcbiAgICB3YXRlck9iai52ID0gW107XHJcbiAgICB3YXRlck9iai52biA9IFtdO1xyXG4gICAgd2F0ZXJPYmoudnQgPSBbXTtcclxuICAgIHdhdGVyT2JqLmlkeCA9IFtdO1xyXG5cclxuICAgIGxldCBpbmRleCA9IDA7XHJcbiAgICBsZXQgaW5kZXgyID0gMDtcclxuICAgIGxldCBsZXZlbDEgPSAwO1xyXG4gICAgbGV0IGxldmVsMCA9IC0xMDtcclxuXHJcbiAgICBsZXQgdmVydGljZXMgPSBbXTtcclxuXHJcbiAgICBmb3IodmFyIHggPSAwOyB4IDwgd29ybGRXaWR0aDsgeCsrKXtcclxuICAgICAgICBmb3IodmFyIHogPSAwOyB6IDwgd29ybGREZXB0aDsgeisrKXtcclxuICAgICAgICAgICAgdmFyIGggPSBnZXRZKHgsIHopO1xyXG4gICAgICAgICAgICB2YXIgcHggPSBnZXRZKCB4ICsgMSwgeiApO1xyXG4gICAgICAgICAgICB2YXIgbnggPSBnZXRZKCB4IC0gMSwgeiApO1xyXG4gICAgICAgICAgICB2YXIgcHogPSBnZXRZKCB4LCB6ICsgMSApO1xyXG4gICAgICAgICAgICB2YXIgbnogPSBnZXRZKCB4LCB6IC0gMSApO1xyXG4gICAgICAgICAgICB2YXIgcHhweiA9IGdldFkoIHggKyAxLCB6ICsgMSApO1xyXG4gICAgICAgICAgICB2YXIgbnhweiA9IGdldFkoIHggLSAxLCB6ICsgMSApO1xyXG4gICAgICAgICAgICB2YXIgcHhueiA9IGdldFkoIHggKyAxLCB6IC0gMSApO1xyXG4gICAgICAgICAgICB2YXIgbnhueiA9IGdldFkoIHggLSAxLCB6IC0gMSApO1xyXG4gICAgICAgICAgICB2YXIgYSA9IG54ID4gaCB8fCBueiA+IGggfHwgbnhueiA+IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgIHZhciBiID0gbnggPiBoIHx8IHB6ID4gaCB8fCBueHB6ID4gaCA/IHNoYWRvdzIgOiBsaWdodDtcclxuICAgICAgICAgICAgdmFyIGMgPSBweCA+IGggfHwgcHogPiBoIHx8IHB4cHogPiBoID8gc2hhZG93MiA6IGxpZ2h0O1xyXG4gICAgICAgICAgICB2YXIgZCA9IHB4ID4gaCB8fCBueiA+IGggfHwgcHhueiA+IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcblxyXG4gICAgICAgICAgICBsZXQgdG9wdmMgPSBbXHJcbiAgICAgICAgICAgICAgICBiLCBjLCBkLFxyXG4gICAgICAgICAgICAgICAgYiwgZCwgYSxcclxuICAgICAgICAgICAgXVxyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IDY7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBsZXQgdnggPSBweXZbaSozXSArIHggKiAxNi4wO1xyXG4gICAgICAgICAgICAgICAgbGV0IHZ5ID0gcHl2W2kqMysxXSArIGggKiAxNi4wO1xyXG4gICAgICAgICAgICAgICAgbGV0IHZ6ID0gcHl2W2kqMysyXSArIHogKiAxNi4wO1xyXG4gICAgICAgICAgICAgICAgdGVycmFpbk9iai52LnB1c2godngpO1xyXG4gICAgICAgICAgICAgICAgdGVycmFpbk9iai52LnB1c2godnkpO1xyXG4gICAgICAgICAgICAgICAgdGVycmFpbk9iai52LnB1c2godnopO1xyXG5cclxuICAgICAgICAgICAgICAgIHZlcnRpY2VzLnB1c2godmVjMy5mcm9tVmFsdWVzKHZ4LCB2eSwgdnopKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gocHl2bltpKjNdKTtcclxuICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChweXZuW2kqMysxXSk7XHJcbiAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gocHl2bltpKjMrMl0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihoID4gbGV2ZWwxKXtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZ0LnB1c2gocHl2dFtpKjJdKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZ0LnB1c2gocHl2dFtpKjIrMV0pO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYoaCA+IGxldmVsMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKHNhbmR2dFtpKjJdKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZ0LnB1c2goc2FuZHZ0W2kqMisxXSk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZ0LnB1c2goc3RvbmV2dFtpKjJdKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZ0LnB1c2goc3RvbmV2dFtpKjIrMV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRlcnJhaW5PYmouaWR4LnB1c2goaSArIGluZGV4KjYpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudmMucHVzaCh0b3B2Y1tpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKGggPCBsZXZlbDEgLSAyKXtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCA2OyBpKyspe1xyXG4gICAgICAgICAgICAgICAgICAgIHdhdGVyT2JqLnYucHVzaChweXYyW2kqM10gKyB4ICogMTYuMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2F0ZXJPYmoudi5wdXNoKHB5djJbaSozKzFdICsgKGxldmVsMSAtIDIpICogMTYuMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2F0ZXJPYmoudi5wdXNoKHB5djJbaSozKzJdICsgeiAqIDE2LjApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgd2F0ZXJPYmoudm4ucHVzaChweXZuW2kqM10pO1xyXG4gICAgICAgICAgICAgICAgICAgIHdhdGVyT2JqLnZuLnB1c2gocHl2bltpKjMrMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHdhdGVyT2JqLnZuLnB1c2gocHl2bltpKjMrMl0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB3YXRlck9iai52dC5wdXNoKHB5dnQyW2kqMl0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHdhdGVyT2JqLnZ0LnB1c2gocHl2dDJbaSoyKzFdKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHdhdGVyT2JqLmlkeC5wdXNoKGkgKyBpbmRleDIqNik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbmRleDIrKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYocHggPCBoKXtcclxuICAgICAgICAgICAgICAgIHNpZGV2Y1syXSA9IHB4bnogPT0gaCA/IHNoYWRvdzIgOiBsaWdodDtcclxuICAgICAgICAgICAgICAgIHNpZGV2Y1s0XSA9IHB4bnogPT0gaCA/IHNoYWRvdzIgOiBsaWdodDtcclxuICAgICAgICAgICAgICAgIHNpZGV2Y1s1XSA9IHB4cHogPT0gaCA/IHNoYWRvdzIgOiBsaWdodDtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCA2OyBpKyspe1xyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudi5wdXNoKHB4dltpKjNdICsgeCAqIDE2LjApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudi5wdXNoKHB4dltpKjMrMV0gKyBoICogMTYuMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52LnB1c2gocHh2W2kqMysyXSArIHogKiAxNi4wKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChweHZuW2kqM10pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChweHZuW2kqMysxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52bi5wdXNoKHB4dm5baSozKzJdKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZihoID4gbGV2ZWwxKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKHB4dnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChweHZ0W2kqMisxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoaCA+IGxldmVsMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzYW5kdnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzYW5kdnRbaSoyKzFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKHN0b25ldnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzdG9uZXZ0W2kqMisxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai5pZHgucHVzaChpICsgaW5kZXgqNik7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52Yy5wdXNoKHNpZGV2Y1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHB6IDwgaCl7XHJcbiAgICAgICAgICAgICAgICBzaWRldmNbMl0gPSBweHB6ID09IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgICAgICBzaWRldmNbNF0gPSBweHB6ID09IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgICAgICBzaWRldmNbNV0gPSBueHB6ID09IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgNjsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnYucHVzaChwenZbaSozXSArIHggKiAxNi4wKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnYucHVzaChwenZbaSozKzFdICsgaCAqIDE2LjApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudi5wdXNoKHB6dltpKjMrMl0gKyB6ICogMTYuMCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gocHp2bltpKjNdKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gocHp2bltpKjMrMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChwenZuW2kqMysyXSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZihoID4gbGV2ZWwxKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKHB4dnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChweHZ0W2kqMisxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoaCA+IGxldmVsMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzYW5kdnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzYW5kdnRbaSoyKzFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKHN0b25ldnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzdG9uZXZ0W2kqMisxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai5pZHgucHVzaChpICsgaW5kZXgqNik7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52Yy5wdXNoKHNpZGV2Y1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKG54IDwgaCl7XHJcbiAgICAgICAgICAgICAgICBzaWRldmNbMl0gPSBueHB6ID09IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgICAgICBzaWRldmNbNF0gPSBueHB6ID09IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgICAgICBzaWRldmNbNV0gPSBueG56ID09IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgNjsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnYucHVzaChueHZbaSozXSArIHggKiAxNi4wKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnYucHVzaChueHZbaSozKzFdICsgaCAqIDE2LjApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudi5wdXNoKG54dltpKjMrMl0gKyB6ICogMTYuMCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gobnh2bltpKjNdKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gobnh2bltpKjMrMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChueHZuW2kqMysyXSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZihoID4gbGV2ZWwxKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKHB4dnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChweHZ0W2kqMisxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoaCA+IGxldmVsMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzYW5kdnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzYW5kdnRbaSoyKzFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKHN0b25ldnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzdG9uZXZ0W2kqMisxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai5pZHgucHVzaChpICsgaW5kZXgqNik7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52Yy5wdXNoKHNpZGV2Y1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKG56IDwgaCl7XHJcbiAgICAgICAgICAgICAgICBzaWRldmNbMl0gPSBueG56ID09IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgICAgICBzaWRldmNbNF0gPSBueG56ID09IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgICAgICBzaWRldmNbNV0gPSBweG56ID09IGggPyBzaGFkb3cyIDogbGlnaHQ7XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgNjsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnYucHVzaChuenZbaSozXSArIHggKiAxNi4wKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnYucHVzaChuenZbaSozKzFdICsgaCAqIDE2LjApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudi5wdXNoKG56dltpKjMrMl0gKyB6ICogMTYuMCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gobnp2bltpKjNdKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gobnp2bltpKjMrMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChuenZuW2kqMysyXSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZihoID4gbGV2ZWwxKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKHB4dnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChweHZ0W2kqMisxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoaCA+IGxldmVsMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzYW5kdnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzYW5kdnRbaSoyKzFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKHN0b25ldnRbaSoyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlcnJhaW5PYmoudnQucHVzaChzdG9uZXZ0W2kqMisxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai5pZHgucHVzaChpICsgaW5kZXgqNik7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVycmFpbk9iai52Yy5wdXNoKHNpZGV2Y1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLyBhZGQgYm91bmQgbWVzaFxyXG4gICAgbGV0IHdvcmxkV2lkdGhTaXplID0gd29ybGRXaWR0aCAqIDE2LjA7XHJcbiAgICBsZXQgd29ybGREZXB0aFNpemUgPSB3b3JsZERlcHRoICogMTYuMDtcclxuXHJcbiAgICBjb25zb2xlLmxvZyh0ZXJyYWluT2JqLnYpO1xyXG5cclxuICAgIHRlcnJhaW5PYmoudi5wdXNoKCAgICAgICAgICAgMC4wLCBtaW5ZICogMTYuMCwgICAgICAgICAgICAwLjApO1xyXG4gICAgdGVycmFpbk9iai52LnB1c2god29ybGRXaWR0aFNpemUsIG1pblkgKiAxNi4wLCAgICAgICAgICAgIDAuMCk7XHJcbiAgICB0ZXJyYWluT2JqLnYucHVzaCh3b3JsZFdpZHRoU2l6ZSwgICAgICAgLTE3LjAsICAgICAgICAgICAgMC4wKTtcclxuICAgIHRlcnJhaW5PYmoudi5wdXNoKCAgICAgICAgICAgMC4wLCBtaW5ZICogMTYuMCwgICAgICAgICAgICAwLjApO1xyXG4gICAgdGVycmFpbk9iai52LnB1c2god29ybGRXaWR0aFNpemUsICAgICAgIC0xNy4wLCAgICAgICAgICAgIDAuMCk7XHJcbiAgICB0ZXJyYWluT2JqLnYucHVzaCggICAgICAgICAgIDAuMCwgICAgICAgLTE3LjAsICAgICAgICAgICAgMC4wKTtcclxuXHJcbiAgICBmb3IobGV0IGk9MDsgaTw2OyBpKyspe1xyXG4gICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChwenZuW2kqM10pO1xyXG4gICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChwenZuW2kqMysxXSlcclxuICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gocHp2bltpKjMrMl0pO1xyXG5cclxuICAgICAgICB0ZXJyYWluT2JqLnZ0LnB1c2goMC4wLCAwLjApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRlcnJhaW5PYmouaWR4LnB1c2goaSArIGluZGV4KjYpO1xyXG4gICAgfVxyXG4gICAgaW5kZXgrKztcclxuXHJcbiAgICB0ZXJyYWluT2JqLnYucHVzaCh3b3JsZFdpZHRoU2l6ZSwgbWluWSAqIDE2LjAsIHdvcmxkRGVwdGhTaXplKTtcclxuICAgIHRlcnJhaW5PYmoudi5wdXNoKCAgICAgICAgICAgMC4wLCBtaW5ZICogMTYuMCwgd29ybGREZXB0aFNpemUpO1xyXG4gICAgdGVycmFpbk9iai52LnB1c2goICAgICAgICAgICAwLjAsICAgICAgIC0xNy4wLCB3b3JsZERlcHRoU2l6ZSk7XHJcbiAgICB0ZXJyYWluT2JqLnYucHVzaCh3b3JsZFdpZHRoU2l6ZSwgbWluWSAqIDE2LjAsIHdvcmxkRGVwdGhTaXplKTtcclxuICAgIHRlcnJhaW5PYmoudi5wdXNoKCAgICAgICAgICAgMC4wLCAgICAgICAtMTcuMCwgd29ybGREZXB0aFNpemUpO1xyXG4gICAgdGVycmFpbk9iai52LnB1c2god29ybGRXaWR0aFNpemUsICAgICAgIC0xNy4wLCB3b3JsZERlcHRoU2l6ZSk7XHJcblxyXG4gICAgZm9yKGxldCBpPTA7IGk8NjsgaSsrKXtcclxuICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gobnp2bltpKjNdKTtcclxuICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gobnp2bltpKjMrMV0pXHJcbiAgICAgICAgdGVycmFpbk9iai52bi5wdXNoKG56dm5baSozKzJdKTtcclxuXHJcbiAgICAgICAgdGVycmFpbk9iai52dC5wdXNoKDAuMCwgMC4wKTtcclxuICAgICAgICBcclxuICAgICAgICB0ZXJyYWluT2JqLmlkeC5wdXNoKGkgKyBpbmRleCo2KTtcclxuICAgIH1cclxuICAgIGluZGV4Kys7XHJcblxyXG4gICAgdGVycmFpbk9iai52LnB1c2goICAgICAgICAgICAwLjAsIG1pblkgKiAxNi4wLCB3b3JsZERlcHRoU2l6ZSk7XHJcbiAgICB0ZXJyYWluT2JqLnYucHVzaCggICAgICAgICAgIDAuMCwgbWluWSAqIDE2LjAsICAgICAgICAgICAgMC4wKTtcclxuICAgIHRlcnJhaW5PYmoudi5wdXNoKCAgICAgICAgICAgMC4wLCAgICAgICAtMTcuMCwgICAgICAgICAgICAwLjApO1xyXG4gICAgdGVycmFpbk9iai52LnB1c2goICAgICAgICAgICAwLjAsIG1pblkgKiAxNi4wLCB3b3JsZERlcHRoU2l6ZSk7XHJcbiAgICB0ZXJyYWluT2JqLnYucHVzaCggICAgICAgICAgIDAuMCwgICAgICAgLTE3LjAsICAgICAgICAgICAgMC4wKTtcclxuICAgIHRlcnJhaW5PYmoudi5wdXNoKCAgICAgICAgICAgMC4wLCAgICAgICAtMTcuMCwgd29ybGREZXB0aFNpemUpO1xyXG5cclxuICAgIGZvcihsZXQgaT0wOyBpPDY7IGkrKyl7XHJcbiAgICAgICAgdGVycmFpbk9iai52bi5wdXNoKHB4dm5baSozXSk7XHJcbiAgICAgICAgdGVycmFpbk9iai52bi5wdXNoKHB4dm5baSozKzFdKVxyXG4gICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChweHZuW2kqMysyXSk7XHJcblxyXG4gICAgICAgIHRlcnJhaW5PYmoudnQucHVzaCgwLjAsIDAuMCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGVycmFpbk9iai5pZHgucHVzaChpICsgaW5kZXgqNik7XHJcbiAgICB9XHJcbiAgICBpbmRleCsrO1xyXG5cclxuICAgIHRlcnJhaW5PYmoudi5wdXNoKHdvcmxkV2lkdGhTaXplLCBtaW5ZICogMTYuMCwgICAgICAgICAgICAwLjApO1xyXG4gICAgdGVycmFpbk9iai52LnB1c2god29ybGRXaWR0aFNpemUsIG1pblkgKiAxNi4wLCB3b3JsZERlcHRoU2l6ZSk7XHJcbiAgICB0ZXJyYWluT2JqLnYucHVzaCh3b3JsZFdpZHRoU2l6ZSwgICAgICAgLTE3LjAsIHdvcmxkRGVwdGhTaXplKTtcclxuICAgIHRlcnJhaW5PYmoudi5wdXNoKHdvcmxkV2lkdGhTaXplLCBtaW5ZICogMTYuMCwgICAgICAgICAgICAwLjApO1xyXG4gICAgdGVycmFpbk9iai52LnB1c2god29ybGRXaWR0aFNpemUsICAgICAgIC0xNy4wLCB3b3JsZERlcHRoU2l6ZSk7XHJcbiAgICB0ZXJyYWluT2JqLnYucHVzaCh3b3JsZFdpZHRoU2l6ZSwgICAgICAgLTE3LjAsICAgICAgICAgICAgMC4wKTtcclxuXHJcbiAgICBmb3IobGV0IGk9MDsgaTw2OyBpKyspe1xyXG4gICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChueHZuW2kqM10pO1xyXG4gICAgICAgIHRlcnJhaW5PYmoudm4ucHVzaChueHZuW2kqMysxXSlcclxuICAgICAgICB0ZXJyYWluT2JqLnZuLnB1c2gobnh2bltpKjMrMl0pO1xyXG5cclxuICAgICAgICB0ZXJyYWluT2JqLnZ0LnB1c2goMC4wLCAwLjApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRlcnJhaW5PYmouaWR4LnB1c2goaSArIGluZGV4KjYpO1xyXG4gICAgfVxyXG4gICAgaW5kZXgrKztcclxuXHJcbiAgICBjb25zb2xlLmxvZyh0ZXJyYWluT2JqLnYpO1xyXG5cclxuICAgIC8vIHRyaWFuZ2xlIGZvciByYXljYXN0XHJcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgdmVydGljZXMubGVuZ3RoIC8gMy4wOyBpKyspe1xyXG4gICAgICAgIGxldCB0cmlhbmdsZSA9IFtdO1xyXG4gICAgICAgIHRyaWFuZ2xlLnB1c2godmVydGljZXNbaSozKzBdKTtcclxuICAgICAgICB0cmlhbmdsZS5wdXNoKHZlcnRpY2VzW2kqMysxXSk7XHJcbiAgICAgICAgdHJpYW5nbGUucHVzaCh2ZXJ0aWNlc1tpKjMrMl0pO1xyXG4gICAgICAgIHRlcnJhaW5PYmoubWVzaC5wdXNoKHRyaWFuZ2xlKTtcclxuICAgIH1cclxufVxyXG5cclxuIiwiaW1wb3J0IHsgdmVjMyB9IGZyb20gJ2dsLW1hdHJpeCc7XHJcblxyXG4vKipcclxuICogUmF5IHRyaWFuZ2xlIGludGVyc2VjdGlvbiBhbGdvcml0aG0gXHJcbiAqIFxyXG4gKiBAcGFyYW0gcmF5T3JpZ2luIHJheSBvcmlnaW4gcG9pbnRcclxuICogQHBhcmFtIHJheVZlY3RvciByYXkgZGlyZWN0aW9uXHJcbiAqIEBwYXJhbSB0cmlhbmdsZSB0aHJlZSBwb2ludHMgb2YgdHJpYW5nbGUsIHNob3VsZCBiZSBjY3cgb3JkZXJcclxuICogQHBhcmFtIG91dCB0aGUgaW50ZXJzZWN0aW9uIHBvaW50XHJcbiAqIEByZXR1cm4gaW50ZXJzZWN0cyBvciBub3RcclxuICogXHJcbiAqIFVzZXMgTcO2bGxlcuKAk1RydW1ib3JlIGludGVyc2VjdGlvbiBhbGdvcml0aG1cclxuICovXHJcblxyXG4vLyByYXljYXN0XHJcbmV4cG9ydCBmdW5jdGlvbiBjaGVja0dyb3VuZCAob3JpZ2luLCBkaXJlY3Rpb24sIGxlbmd0aCwgb2JqKSB7XHJcbiAgICBsZXQgeCA9IE1hdGguZmxvb3Iob3JpZ2luWzBdIC8gMTYuMCk7XHJcbiAgICBsZXQgeiA9IE1hdGguZmxvb3Iob3JpZ2luWzJdIC8gMTYuMCk7XHJcbiAgICBsZXQgaWR4MCA9IHggKiBvYmouZGVwdGggKiAyICsgeiAqIDI7XHJcbiAgICBsZXQgaWR4MSA9IHggKiBvYmouZGVwdGggKiAyICsgeiAqIDIgKyAxO1xyXG4gICAgXHJcbiAgICBpZihvYmoubWVzaFtpZHgwXSA9PSB1bmRlZmluZWQgfHwgb2JqLm1lc2hbaWR4MV0gPT0gdW5kZWZpbmVkKSByZXR1cm4gZmFsc2U7XHJcbiAgICBcclxuICAgIGxldCBncm91bmQgPSBcclxuICAgICAgICBjaGVja0ludGVyc2VjdChvcmlnaW4sIGRpcmVjdGlvbiwgbGVuZ3RoLCBvYmoubWVzaFtpZHgwXVswXSwgb2JqLm1lc2hbaWR4MF1bMV0sIG9iai5tZXNoW2lkeDBdWzJdKSB8fFxyXG4gICAgICAgIGNoZWNrSW50ZXJzZWN0KG9yaWdpbiwgZGlyZWN0aW9uLCBsZW5ndGgsIG9iai5tZXNoW2lkeDFdWzBdLCBvYmoubWVzaFtpZHgxXVsxXSwgb2JqLm1lc2hbaWR4MV1bMl0pO1xyXG4gICAgaWYoZ3JvdW5kID09IHRydWUpIHJldHVybiB0cnVlO1xyXG4gICAgXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoZWNrSW50ZXJzZWN0IChvcmlnaW4sIGRpcmVjdGlvbiwgbGVuZ3RoLCB2MCwgdjEsIHYyKSB7XHJcbiAgICBjb25zdCBlcHMgPSAwLjAwMDAwMDE7XHJcbiAgICBjb25zdCBlZGdlMSA9IHZlYzMuY3JlYXRlKCk7XHJcbiAgICBjb25zdCBlZGdlMiA9IHZlYzMuY3JlYXRlKCk7XHJcbiAgICBjb25zdCBoID0gdmVjMy5jcmVhdGUoKTtcclxuXHJcbiAgICB2ZWMzLnN1YihlZGdlMSwgdjEsIHYwKTtcclxuICAgIHZlYzMuc3ViKGVkZ2UyLCB2MiwgdjApO1xyXG4gICAgdmVjMy5jcm9zcyhoLCBkaXJlY3Rpb24sIGVkZ2UyKTtcclxuICAgIGNvbnN0IGEgPSB2ZWMzLmRvdChlZGdlMSwgaCk7XHJcblxyXG4gICAgaWYoYSA+IC1lcHMgJiYgYSA8IGVwcykge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzID0gdmVjMy5jcmVhdGUoKTtcclxuICAgIHZlYzMuc3ViKHMsIG9yaWdpbiwgdjApO1xyXG4gICAgY29uc3QgdSA9IHZlYzMuZG90KHMsIGgpO1xyXG5cclxuXHJcbiAgICBpZiAodSA8IDAgfHwgdSA+IGEpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcSA9IHZlYzMuY3JlYXRlKCk7XHJcbiAgICB2ZWMzLmNyb3NzKHEsIHMsIGVkZ2UxKTtcclxuICAgIGNvbnN0IHYgPSB2ZWMzLmRvdChkaXJlY3Rpb24sIHEpO1xyXG5cclxuICAgIGlmICh2IDwgMCB8fCB1ICsgdiA+IGEpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdCA9IHZlYzMuZG90KGVkZ2UyLCBxKSAvIGE7XHJcbiAgICAvLyBjb25zb2xlLmxvZyh0KTtcclxuICAgIGlmICh0ID4gZXBzICYmIHQgPD0gbGVuZ3RoKSB7XHJcbiAgICAgICAgLy8gaWYgKG91dCkge1xyXG4gICAgICAgIC8vICAgICB2ZWMzLmFkZChvdXQsIG9yaWdpbiwgW2RpcmVjdGlvblswXSAqIHQsIGRpcmVjdGlvblsxXSAqIHQsIGRpcmVjdGlvblsyXSAqIHRdKTtcclxuICAgICAgICAvLyAgICAgLy8gY29uc29sZS5sb2cob3V0KTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbi8vIHVudXNlZFxyXG4vLyBmdW5jdGlvbiBwcm9qZWN0VG8zRCAoc2NyZWVuY29vcmQsIHZpZXdwb3J0LCBpbnZQcm9qZWN0aW9uLCBpbnZWaWV3KSB7XHJcbi8vICAgICBjb25zdCBbbGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0XSA9IHZpZXdwb3J0O1xyXG4vLyAgICAgY29uc3QgW3gsIHldID0gc2NyZWVuQ29vcmQ7XHJcblxyXG4vLyAgICAgY29uc3Qgb3V0ID0gdmVjNC5mcm9tVmFsdWVzKFxyXG4vLyAgICAgICAgICgyICogeCkgLyB3aWR0aCAtIDEgLSBsZWZ0LFxyXG4vLyAgICAgICAgICgyICogKGhlaWdodCAtIHkgLSAxKSkgLyBoZWlnaHQgLSAxLFxyXG4vLyAgICAgICAgIDEsXHJcbi8vICAgICAgICAgMSxcclxuLy8gICAgICk7XHJcblxyXG4vLyAgICAgdmVjNC50cmFuc2Zvcm1NYXQ0KG91dCwgb3V0LCBpbnZQcm9qZWN0aW9uKTtcclxuLy8gICAgIG91dFszXSA9IDA7XHJcbi8vICAgICB2ZWM0LnRyYW5zZm9ybU1hdDQob3V0LCBvdXQsIGludlZpZXcpO1xyXG4vLyAgICAgcmV0dXJuIHZlYzMubm9ybWFsaXplKHZlYzMuY3JlYXRlKCksIG91dCk7XHJcbi8vIH0iLCJcclxuZXhwb3J0IHZhciBza3lib3ggPSB7XHJcbiAgICB2aWV3X0xvY2F0aW9uOiBudWxsLFxyXG4gICAgcHJvamVjdF9Mb2NhdGlvbjogbnVsbCxcclxuXHJcbiAgICB0ZXhfY3ViZW1hcDogbnVsbCxcclxuXHJcbiAgICB0ZXhfY3ViZW1hcF9wYXRoOiBudWxsLFxyXG4gICAgdGV4X2N1YmVtYXBfd2lkdGg6IG51bGwsXHJcbiAgICB0ZXhfY3ViZW1hcF9oZWlnaHQ6IG51bGwsXHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2t5Ym94SW5pdChnbCkge1xyXG4gICAgc2t5Ym94LnRleF9jdWJlbWFwX3BhdGggPSBbXTtcclxuICAgIC8vIHNreWJveC50ZXhfY3ViZW1hcF9wYXRoLnB1c2goJy4vYXNzZXQvc2t5Ym94L1N0YXJTa3lib3gwNDEyLnBuZycpO1xyXG4gICAgLy8gc2t5Ym94LnRleF9jdWJlbWFwX3BhdGgucHVzaCgnLi9hc3NldC9za3lib3gvU3RhclNreWJveDA0MjIucG5nJyk7XHJcbiAgICAvLyBza3lib3gudGV4X2N1YmVtYXBfcGF0aC5wdXNoKCcuL2Fzc2V0L3NreWJveC9TdGFyU2t5Ym94MDQzMi5wbmcnKTtcclxuICAgIC8vIHNreWJveC50ZXhfY3ViZW1hcF9wYXRoLnB1c2goJy4vYXNzZXQvc2t5Ym94L1N0YXJTa3lib3gwNDQyLnBuZycpO1xyXG4gICAgLy8gc2t5Ym94LnRleF9jdWJlbWFwX3BhdGgucHVzaCgnLi9hc3NldC9za3lib3gvU3RhclNreWJveDA0NTIucG5nJyk7XHJcbiAgICAvLyBza3lib3gudGV4X2N1YmVtYXBfcGF0aC5wdXNoKCcuL2Fzc2V0L3NreWJveC9TdGFyU2t5Ym94MDQ2Mi5wbmcnKTtcclxuICAgIC8vIHNreWJveC50ZXhfY3ViZW1hcF9wYXRoLnB1c2goJy4vYXNzZXQvc2t5Ym94L3B4LnBuZycpO1xyXG4gICAgLy8gc2t5Ym94LnRleF9jdWJlbWFwX3BhdGgucHVzaCgnLi9hc3NldC9za3lib3gvbngucG5nJyk7XHJcbiAgICAvLyBza3lib3gudGV4X2N1YmVtYXBfcGF0aC5wdXNoKCcuL2Fzc2V0L3NreWJveC9weS5wbmcnKTtcclxuICAgIC8vIHNreWJveC50ZXhfY3ViZW1hcF9wYXRoLnB1c2goJy4vYXNzZXQvc2t5Ym94L255LnBuZycpO1xyXG4gICAgLy8gc2t5Ym94LnRleF9jdWJlbWFwX3BhdGgucHVzaCgnLi9hc3NldC9za3lib3gvcHoucG5nJyk7XHJcbiAgICAvLyBza3lib3gudGV4X2N1YmVtYXBfcGF0aC5wdXNoKCcuL2Fzc2V0L3NreWJveC9uei5wbmcnKTtcclxuXHJcbiAgICBza3lib3gudGV4X2N1YmVtYXBfcGF0aC5wdXNoKCcuL2Fzc2V0L3NreWJveC9weC5wbmcnKTtcclxuICAgIHNreWJveC50ZXhfY3ViZW1hcF9wYXRoLnB1c2goJy4vYXNzZXQvc2t5Ym94L254LnBuZycpO1xyXG4gICAgc2t5Ym94LnRleF9jdWJlbWFwX3BhdGgucHVzaCgnLi9hc3NldC9za3lib3gvbnoucG5nJyk7XHJcbiAgICBza3lib3gudGV4X2N1YmVtYXBfcGF0aC5wdXNoKCcuL2Fzc2V0L3NreWJveC9wei5wbmcnKTtcclxuICAgIHNreWJveC50ZXhfY3ViZW1hcF9wYXRoLnB1c2goJy4vYXNzZXQvc2t5Ym94L3B5LnBuZycpO1xyXG4gICAgc2t5Ym94LnRleF9jdWJlbWFwX3BhdGgucHVzaCgnLi9hc3NldC9za3lib3gvbnkucG5nJyk7XHJcblxyXG4gICAgc2t5Ym94LnRleF9jdWJlbWFwX3dpZHRoID0gMjA0ODtcclxuICAgIHNreWJveC50ZXhfY3ViZW1hcF9oZWlnaHQgPSAyMDQ4O1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNreWJveFRleHR1cmUoZ2wsIHRleCkge1xyXG5cclxuICAgIHNreWJveC50ZXhfY3ViZW1hcCA9IGdsLmNyZWF0ZVRleHR1cmUoKTtcclxuXHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcclxuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIHNreWJveC50ZXhfY3ViZW1hcCk7XHJcblxyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgKytpKSB7XHJcbiAgICAgICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCBnbC5SR0IsIHNreWJveC50ZXhfY3ViZW1hcF93aWR0aCwgc2t5Ym94LnRleF9jdWJlbWFwX2hlaWdodCwgMCwgZ2wuUkdCLCBnbC5VTlNJR05FRF9CWVRFLCB0ZXhbaV0pO1xyXG4gICAgfVxyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFX0NVQkVfTUFQLCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLkxJTkVBUik7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTElORUFSKTtcclxuXHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFX0NVQkVfTUFQLCBudWxsKTtcclxufSIsImltcG9ydCAqIGFzIGdsbSBmcm9tICdnbC1tYXRyaXgnO1xyXG5pbXBvcnQgeyBjc20sIHNoYWRlcklkVG9Qcm9ncmFtIH0gZnJvbSAnLi9yZW5kZXInO1xyXG5pbXBvcnQgeyBjYW1lcmEgfSBmcm9tICcuL2NhbWVyYSc7XHJcbmltcG9ydCB7IHNreWJveCB9IGZyb20gJy4vc2t5Ym94JztcclxuXHJcbmV4cG9ydCB2YXIgc2t5bGlnaHQgPSB7XHJcbiAgICBleWU6IG51bGwsICAgICAgLy8gcG9zaXRpb25cclxuICAgIGV5ZVRvQ2FtZXJhOiBudWxsLFxyXG4gICAgYmFzZV9leWVUb0NhbWVyYTogbnVsbCxcclxuICAgIHJvdF9tYXQ6IG51bGwsXHJcblxyXG4gICAgcG9pbnRMb29rYXQ6IG51bGwsXHJcbiAgICB1cDogbnVsbCxcclxuICAgIG5lYXI6IG51bGwsXHJcbiAgICBmYXI6IG51bGwsXHJcblxyXG4gICAgcmFuZ2U6IG51bGwsXHJcblxyXG4gICAgdGltZTogbnVsbCxcclxuICAgIC8vIHByb2dyYW0gdGltZSAwLjEgc2Vjb25kcyA9IDEgVW5pdCA9IGdhbWUgdGltZSAwLjEgbWludXRlXHJcbiAgICB0aW1lVW5pdDogbnVsbCxcclxuXHJcbiAgICAvL2ZvciBjbG91ZCBtb3ZlXHJcbiAgICBpVGltZTogbnVsbCxcclxuXHJcbiAgICBiaWFzOiBudWxsLFxyXG5cclxuICAgIGNvbG9yOiBudWxsLFxyXG5cclxuICAgIGF0bVZhbzogbnVsbCxcclxuICAgIGF0bVByb2dyYW06IG51bGwsXHJcbiAgICB1U3VuUG9zTG9jYXRpb246IG51bGwsXHJcbiAgICB2aWV3X0xvY2F0aW9uOiBudWxsLFxyXG4gICAgcHJvamVjdF9Mb2NhdGlvbjogbnVsbCxcclxuXHJcbiAgICB0ZXhfbm9pc2U6IG51bGwsXHJcblxyXG5cclxuICAgIGNsb3VkczogdHJ1ZSxcclxuICAgIGxpZ2h0X3NjYXR0ZXJpbmc6IHRydWUsXHJcbiAgICBjbG91ZF9kZW5zaXR5OiAwLjAzLFxyXG4gICAgY2xvdWRfaGVpZ2h0OiAxNjAwLjAsXHJcbiAgICBjbG91ZF90aGlja25lc3M6IDUwMC4wLFxyXG4gICAgdGltZV9wYXVzZTogZmFsc2UsXHJcblxyXG4gICAgdXNlUHJlQ2FsU3VuQ29sb3I6IHRydWUsXHJcblxyXG4gICAgZ2FtbWFfY29ycmVjdGlvbjogMS42LFxyXG59O1xyXG5cclxuXHJcblxyXG5cclxuLy8vLyAgeDpFICB6Ok5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBza3lsaWdodEluaXQoZ2wsIGd1aSwgZ2xvYmFsKSB7XHJcbi8vLTE0OTYwMDAwMDAwMDBcclxuICAgIHNreWxpZ2h0LmJhc2VfZXllVG9DYW1lcmEgPSBnbG0udmVjMy5mcm9tVmFsdWVzKDAsIC02MDAwLCAwKTtcclxuICAgIHNreWxpZ2h0LnJvdF9tYXQgPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxuICAgIGdsbS5tYXQ0LnJvdGF0ZVgoc2t5bGlnaHQucm90X21hdCwgc2t5bGlnaHQucm90X21hdCwgTWF0aC5QSSAqIDIzLjUgLyAxODAuMCk7XHJcblxyXG5cclxuICAgIHNreWxpZ2h0LnRpbWUgPSAxMi4wO1xyXG4gICAgc2t5bGlnaHQudGltZVVuaXQgPSAwLjEgLyA2MC4wO1xyXG4gICAgc2t5bGlnaHQuaVRpbWUgPSAwLjA7XHJcblxyXG4gICAgc2t5bGlnaHQuZXllVG9DYW1lcmEgPSBnbG0udmVjMy5jcmVhdGUoKTtcclxuXHJcbiAgICBjYWxjdWxhdGVQb3NpdGlvbigpO1xyXG5cclxuXHJcbiAgICBza3lsaWdodC5leWUgPSBnbG0udmVjMy5jcmVhdGUoKTtcclxuICAgIGdsbS52ZWMzLmFkZChza3lsaWdodC5leWUsIGNhbWVyYS5leWUsIHNreWxpZ2h0LmV5ZVRvQ2FtZXJhKTtcclxuICAgIHNreWxpZ2h0LnBvaW50TG9va2F0ID0gY2FtZXJhLmV5ZTtcclxuICAgIHNreWxpZ2h0LnVwID0gZ2xtLnZlYzMuZnJvbVZhbHVlcygwLCAxLCAwKTtcclxuXHJcblxyXG4gICAgc2t5bGlnaHQucmFuZ2UgPSAzMDAwO1xyXG4gICAgc2t5bGlnaHQubmVhciA9IDAuMTtcclxuICAgIHNreWxpZ2h0LmZhciA9IDEyMDAwO1xyXG5cclxuXHJcbiAgICAvLyBza3lsaWdodC5iaWFzID0gMS4wMDA0O1xyXG4gICAgc2t5bGlnaHQuYmlhcyA9IDEuMDAwMTQ5OTk5OTk5OTk4MztcclxuXHJcblxyXG5cclxuICAgIGxldCBza0ZvbGRlciA9IGd1aS5hZGRGb2xkZXIoJ1NreWxpZ2h0Jyk7XHJcblxyXG4gICAgbGV0IHVpID0gc2tGb2xkZXIuYWRkKHNreWxpZ2h0LCAndGltZScsIDAuMDAsIDIzLjk5KS5saXN0ZW4oKTtcclxuICAgIHVpLm9uQ2hhbmdlKCh2YWwpID0+IHtcclxuICAgICAgICBzZXRTa3lsaWdodFRpbWUodmFsKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBza0ZvbGRlci5hZGQoc2t5bGlnaHQsIFwidGltZV9wYXVzZVwiKTtcclxuICAgIHNrRm9sZGVyLmFkZChza3lsaWdodCwgXCJjbG91ZHNcIikub25DaGFuZ2UoKHZhbCkgPT4ge1xyXG4gICAgICAgIGdsLnVzZVByb2dyYW0oc2t5bGlnaHQuYXRtUHJvZ3JhbSk7XHJcbiAgICAgICAgZ2wudW5pZm9ybTFpKGdsLmdldFVuaWZvcm1Mb2NhdGlvbihza3lsaWdodC5hdG1Qcm9ncmFtLCBcImlzQ2xvdWRcIiksIHZhbCk7XHJcblxyXG4gICAgfSk7XHJcbiAgICBza0ZvbGRlci5hZGQoc2t5bGlnaHQsIFwiY2xvdWRfZGVuc2l0eVwiLCAwLjAwLCAwLjA0KS5vbkNoYW5nZSgodmFsKSA9PiB7XHJcbiAgICAgICAgZ2wudXNlUHJvZ3JhbShza3lsaWdodC5hdG1Qcm9ncmFtKTtcclxuICAgICAgICBnbC51bmlmb3JtMWYoZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHNreWxpZ2h0LmF0bVByb2dyYW0sIFwiY2xvdWREZW5zaXR5XCIpLCB2YWwpO1xyXG4gICAgfSk7XHJcbiAgICBza0ZvbGRlci5hZGQoc2t5bGlnaHQsIFwiY2xvdWRfaGVpZ2h0XCIsIDEwMDAuMDAsIDUwMDAuMCkub25DaGFuZ2UoKHZhbCkgPT4ge1xyXG4gICAgICAgIGdsLnVzZVByb2dyYW0oc2t5bGlnaHQuYXRtUHJvZ3JhbSk7XHJcbiAgICAgICAgZ2wudW5pZm9ybTFmKGdsLmdldFVuaWZvcm1Mb2NhdGlvbihza3lsaWdodC5hdG1Qcm9ncmFtLCBcImNsb3VkSGVpZ2h0XCIpLCB2YWwpO1xyXG4gICAgfSk7XHJcbiAgICBza0ZvbGRlci5hZGQoc2t5bGlnaHQsIFwiY2xvdWRfdGhpY2tuZXNzXCIsIDAuMDAsIDE1MDAuMCkub25DaGFuZ2UoKHZhbCkgPT4ge1xyXG4gICAgICAgIGdsLnVzZVByb2dyYW0oc2t5bGlnaHQuYXRtUHJvZ3JhbSk7XHJcbiAgICAgICAgZ2wudW5pZm9ybTFmKGdsLmdldFVuaWZvcm1Mb2NhdGlvbihza3lsaWdodC5hdG1Qcm9ncmFtLCBcImNsb3VkVGhpY2tuZXNzXCIpLCB2YWwpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgc2tGb2xkZXIuYWRkKHNreWxpZ2h0LCBcImxpZ2h0X3NjYXR0ZXJpbmdcIikub25DaGFuZ2UoKHZhbCkgPT4ge1xyXG4gICAgICAgIGdsLnVzZVByb2dyYW0oc2t5bGlnaHQuYXRtUHJvZ3JhbSk7XHJcbiAgICAgICAgZ2wudW5pZm9ybTFpKGdsLmdldFVuaWZvcm1Mb2NhdGlvbihza3lsaWdodC5hdG1Qcm9ncmFtLCBcImlzTGlnaHRTY2F0dGVyaW5nXCIpLCB2YWwpO1xyXG4gICAgfSk7XHJcbiAgICBza0ZvbGRlci5hZGQoc2t5bGlnaHQsIFwidXNlUHJlQ2FsU3VuQ29sb3JcIikub25DaGFuZ2UoKHZhbCkgPT4ge1xyXG4gICAgICAgIGdsLnVzZVByb2dyYW0oZ2xvYmFsLnByb2dyYW0pO1xyXG4gICAgICAgIGdsLnVuaWZvcm0xaShnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sIFwidXNlUHJlQ2FsU3VuQ29sb3JcIiksIHZhbCk7XHJcbiAgICB9KTtcclxuICAgIHNrRm9sZGVyLmFkZChza3lsaWdodCwgXCJnYW1tYV9jb3JyZWN0aW9uXCIsIDEuMCwgMi41KS5vbkNoYW5nZSgodmFsKSA9PiB7XHJcbiAgICAgICAgZ2wudXNlUHJvZ3JhbShza3lsaWdodC5hdG1Qcm9ncmFtKTtcclxuICAgICAgICBnbC51bmlmb3JtMWYoZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHNreWxpZ2h0LmF0bVByb2dyYW0sIFwiZ2FtbWFDb3JcIiksIHZhbCk7XHJcbiAgICB9KTtcclxuICAgIHNrRm9sZGVyLm9wZW4oKTtcclxuXHJcbiAgICBcclxuICAgIFxyXG5cclxuICAgIGNyZWF0ZUF0bW9zcGhlcmUoZ2wsIGdsb2JhbCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzZXRTa3lsaWdodFRpbWUodGltZSkge1xyXG5cclxuICAgIHNreWxpZ2h0LnRpbWUgPSAodGltZSA+PSAyNC4wKSA/IHRpbWUgLSAyNC4wIDogdGltZTtcclxuICAgIHNreWxpZ2h0LmlUaW1lID0gdGltZTtcclxuICAgIHNreWxpZ2h0TW92ZSgpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYWRkU2t5bGlnaHRUaW1lKGFkZHRpbWUpIHtcclxuXHJcbiAgICBsZXQgdG1wID0gYWRkdGltZSAqIHNreWxpZ2h0LnRpbWVVbml0O1xyXG4gICAgc2t5bGlnaHQudGltZSA9IChza3lsaWdodC50aW1lICsgdG1wID49IDI0LjApID8gc2t5bGlnaHQudGltZSArIHRtcCAtIDI0LjAgOiBza3lsaWdodC50aW1lICsgdG1wO1xyXG5cclxuICAgIHNreWxpZ2h0LmlUaW1lICs9IHRtcDtcclxuICAgIHNreWxpZ2h0TW92ZSgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBza3lsaWdodE1vdmUoKSB7XHJcblxyXG4gICAgY2FsY3VsYXRlUG9zaXRpb24oKTtcclxuXHJcbiAgICBnbG0udmVjMy5hZGQoc2t5bGlnaHQuZXllLCBjYW1lcmEuZXllLCBza3lsaWdodC5leWVUb0NhbWVyYSk7XHJcblxyXG4gICAgY3NtKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNhbGN1bGF0ZVBvc2l0aW9uKCkge1xyXG5cclxuICAgIHNldExpZ2h0Q29sb3IoKTtcclxuXHJcbiAgICAvLyAgMCAxMiAyNFxyXG4gICAgLy8gKzAgKzEyLSAtMFxyXG4gICAgbGV0IHJvdFRpbWUgPSBza3lsaWdodC50aW1lO1xyXG4gICAgaWYoc2t5bGlnaHQudGltZT49MTIuMCl7XHJcbiAgICAgICAgcm90VGltZSA9IHNreWxpZ2h0LnRpbWUtMjQuMDtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgdG1wcm90ID0gZ2xtLm1hdDQuY3JlYXRlKCk7XHJcbiAgICBnbG0ubWF0NC5yb3RhdGVaKHRtcHJvdCwgdG1wcm90LCBNYXRoLlBJICogKHJvdFRpbWUgLyAyNC4wKSAqIDM2MCAvIDE4MC4wKTtcclxuICAgIGxldCBhID0gZ2xtLm1hdDQuY3JlYXRlKCk7XHJcbiAgICBnbG0ubWF0NC5tdWx0aXBseShhLCB0bXByb3QsIHNreWxpZ2h0LnJvdF9tYXQpO1xyXG4gICAgZ2xtLm1hdDQucm90YXRlWSh0bXByb3QsIGdsbS5tYXQ0LmNyZWF0ZSgpLCBNYXRoLlBJICogKHJvdFRpbWUgLyAyNC4wKSAvIDE4MC4wKTtcclxuICAgIGdsbS5tYXQ0Lm11bHRpcGx5KGEsIHRtcHJvdCwgYSk7XHJcblxyXG5cclxuICAgIGxldCBiID0gc2t5bGlnaHQuYmFzZV9leWVUb0NhbWVyYVswXSAqIGFbMF0gKyBza3lsaWdodC5iYXNlX2V5ZVRvQ2FtZXJhWzFdICogYVsxXSArIHNreWxpZ2h0LmJhc2VfZXllVG9DYW1lcmFbMl0gKiBhWzJdICsgMS4wICogYVszXTtcclxuICAgIGxldCBjID0gc2t5bGlnaHQuYmFzZV9leWVUb0NhbWVyYVswXSAqIGFbNF0gKyBza3lsaWdodC5iYXNlX2V5ZVRvQ2FtZXJhWzFdICogYVs1XSArIHNreWxpZ2h0LmJhc2VfZXllVG9DYW1lcmFbMl0gKiBhWzZdICsgMS4wICogYVs3XTtcclxuICAgIGxldCBkID0gc2t5bGlnaHQuYmFzZV9leWVUb0NhbWVyYVswXSAqIGFbOF0gKyBza3lsaWdodC5iYXNlX2V5ZVRvQ2FtZXJhWzFdICogYVs5XSArIHNreWxpZ2h0LmJhc2VfZXllVG9DYW1lcmFbMl0gKiBhWzEwXSArIDEuMCAqIGFbMTFdO1xyXG4gICAgc2t5bGlnaHQuZXllVG9DYW1lcmEgPSBnbG0udmVjMy5mcm9tVmFsdWVzKGIsIGMsIGQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRMaWdodENvbG9yKCkgeyAgICBcclxuICAgIGlmIChza3lsaWdodC50aW1lID49IDYuNSAmJiBza3lsaWdodC50aW1lIDw9IDEyKSB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSAoMzIwMCAtIDEwMDAwKSAqIChza3lsaWdodC50aW1lIC0gMTIpIC8gKDYuNSAtIDEyKSArIDEwMDAwO1xyXG4gICAgICAgIHNreWxpZ2h0LmNvbG9yID0gdGVtcFRvQ29sb3IodGVtcCk7XHJcbiAgICB9IGVsc2UgaWYgKHNreWxpZ2h0LnRpbWUgPj0gMTIgJiYgc2t5bGlnaHQudGltZSA8PSAxNy41KSB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSAoMzIwMCAtIDEwMDAwKSAqIChza3lsaWdodC50aW1lIC0gMTIpIC8gKDE3LjUgLSAxMikgKyAxMDAwMDtcclxuICAgICAgICBza3lsaWdodC5jb2xvciA9IHRlbXBUb0NvbG9yKHRlbXApO1xyXG4gICAgfSBlbHNlIGlmIChza3lsaWdodC50aW1lID49IDE3LjUgJiYgc2t5bGlnaHQudGltZSA8PSAxOCkge1xyXG4gICAgICAgIGxldCB0bXBjb2xvciA9IHRlbXBUb0NvbG9yKDMyMDApO1xyXG4gICAgICAgIGdsbS52ZWMzLmxlcnAoc2t5bGlnaHQuY29sb3IsIFswLCAwLCAwXSwgdG1wY29sb3IsICgxOCAtIHNreWxpZ2h0LnRpbWUpIC8gKDE4IC0gMTcuNSkpO1xyXG4gICAgfSBlbHNlIGlmIChza3lsaWdodC50aW1lID49IDYgJiYgc2t5bGlnaHQudGltZSA8PSA2LjUpIHtcclxuICAgICAgICBsZXQgdG1wY29sb3IgPSB0ZW1wVG9Db2xvcigzMjAwKTtcclxuICAgICAgICBnbG0udmVjMy5sZXJwKHNreWxpZ2h0LmNvbG9yLCB0bXBjb2xvciwgWzAsIDAsIDBdLCAoc2t5bGlnaHQudGltZSAtIDYuNSkgLyAoNiAtIDYuNSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBza3lsaWdodC5jb2xvciA9IGdsbS52ZWMzLmZyb21WYWx1ZXMoMCwgMCwgMCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vIGNhbGN1bGF0ZSBjb2xvciBieSB0ZW1wZXJhdHVyZShLKVxyXG5mdW5jdGlvbiB0ZW1wVG9Db2xvcihUZW1wZXJhdHVyZSkge1xyXG5cclxuICAgIC8vIHN1bnJpc2Ugc3Vuc2V0IDMyMDAgS1xyXG4gICAgLy8gbm9vbiAxMDAwMCBLXHJcblxyXG4gICAgbGV0IHI7XHJcbiAgICBsZXQgZztcclxuICAgIGxldCBiO1xyXG5cclxuICAgIFRlbXBlcmF0dXJlID0gVGVtcGVyYXR1cmUgLyAxMDA7XHJcblxyXG4gICAgLy8gQ2FsY3VsYXRlIFJlZDpcclxuICAgIGlmIChUZW1wZXJhdHVyZSA8PSA2Nikge1xyXG4gICAgICAgIHIgPSAyNTU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHIgPSBUZW1wZXJhdHVyZSAtIDYwO1xyXG4gICAgICAgIHIgPSAzMjkuNjk4NzI3NDQ2ICogTWF0aC5wb3cociwgLTAuMTMzMjA0NzU5Mik7XHJcbiAgICAgICAgaWYgKHIgPCAwKSByID0gMDtcclxuICAgICAgICBpZiAociA+IDI1NSkgciA9IDI1NTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDYWxjdWxhdGUgR3JlZW46XHJcbiAgICBpZiAoVGVtcGVyYXR1cmUgPD0gNjYpIHtcclxuICAgICAgICBnID0gVGVtcGVyYXR1cmU7XHJcbiAgICAgICAgZyA9IDk5LjQ3MDgwMjU4NjEgKiBNYXRoLmxvZyhnKSAtIDE2MS4xMTk1NjgxNjYxO1xyXG4gICAgICAgIGlmIChnIDwgMCkgZyA9IDA7XHJcbiAgICAgICAgaWYgKGcgPiAyNTUpIGcgPSAyNTU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGcgPSBUZW1wZXJhdHVyZSAtIDYwO1xyXG4gICAgICAgIGcgPSAyODguMTIyMTY5NTI4MyAqIE1hdGgucG93KGcsIC0wLjA3NTUxNDg0OTIpO1xyXG4gICAgICAgIGlmIChnIDwgMCkgZyA9IDA7XHJcbiAgICAgICAgaWYgKGcgPiAyNTUpIGcgPSAyNTU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2FsY3VsYXRlIEJsdWU6XHJcbiAgICBpZiAoVGVtcGVyYXR1cmUgPj0gNjYpIHtcclxuICAgICAgICBiID0gMjU1O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoVGVtcGVyYXR1cmUgPD0gMTkpIHtcclxuICAgICAgICAgICAgYiA9IDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYiA9IFRlbXBlcmF0dXJlIC0gMTA7XHJcbiAgICAgICAgICAgIGIgPSAxMzguNTE3NzMxMjIzMSAqIE1hdGgubG9nKGIpIC0gMzA1LjA0NDc5MjczMDc7XHJcbiAgICAgICAgICAgIGlmIChiIDwgMCkgYiA9IDA7XHJcbiAgICAgICAgICAgIGlmIChiID4gMjU1KSBiID0gMjU1O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZ2xtLnZlYzMuZnJvbVZhbHVlcyhyIC8gMjU1LCBiIC8gMjU1LCBnIC8gMjU1KTtcclxufVxyXG5cclxuXHJcblxyXG5mdW5jdGlvbiBjcmVhdGVBdG1vc3BoZXJlKGdsLCBnbG9iYWwpIHtcclxuXHJcbiAgICBza3lsaWdodC5hdG1Qcm9ncmFtID0gc2hhZGVySWRUb1Byb2dyYW0oJ2F0bV92cycsICdhdG1fZnMnKTtcclxuXHJcblxyXG4gICAgc2t5bGlnaHQudVN1blBvc0xvY2F0aW9uID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHNreWxpZ2h0LmF0bVByb2dyYW0sIFwidVN1blBvc1wiKTtcclxuICAgIHNreWxpZ2h0LnZpZXdfTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oc2t5bGlnaHQuYXRtUHJvZ3JhbSwgXCJ2aWV3XCIpO1xyXG4gICAgc2t5bGlnaHQucHJvamVjdF9Mb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihza3lsaWdodC5hdG1Qcm9ncmFtLCBcInByb2plY3Rpb25cIik7XHJcblxyXG4gICAgZ2wudXNlUHJvZ3JhbShza3lsaWdodC5hdG1Qcm9ncmFtKTtcclxuICAgIGdsLnVuaWZvcm0xaShnbC5nZXRVbmlmb3JtTG9jYXRpb24oc2t5bGlnaHQuYXRtUHJvZ3JhbSwgXCJpc0Nsb3VkXCIpLCBza3lsaWdodC5jbG91ZHMpO1xyXG4gICAgZ2wudW5pZm9ybTFmKGdsLmdldFVuaWZvcm1Mb2NhdGlvbihza3lsaWdodC5hdG1Qcm9ncmFtLCBcImNsb3VkRGVuc2l0eVwiKSwgc2t5bGlnaHQuY2xvdWRfZGVuc2l0eSk7XHJcbiAgICBnbC51bmlmb3JtMWYoZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHNreWxpZ2h0LmF0bVByb2dyYW0sIFwiY2xvdWRIZWlnaHRcIiksIHNreWxpZ2h0LmNsb3VkX2hlaWdodCk7XHJcbiAgICBnbC51bmlmb3JtMWYoZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHNreWxpZ2h0LmF0bVByb2dyYW0sIFwiY2xvdWRUaGlja25lc3NcIiksIHNreWxpZ2h0LmNsb3VkX3RoaWNrbmVzcyk7XHJcbiAgICBnbC51bmlmb3JtMWkoZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHNreWxpZ2h0LmF0bVByb2dyYW0sIFwiaXNMaWdodFNjYXR0ZXJpbmdcIiksIHNreWxpZ2h0LmxpZ2h0X3NjYXR0ZXJpbmcpO1xyXG4gICAgZ2wudW5pZm9ybTFmKGdsLmdldFVuaWZvcm1Mb2NhdGlvbihza3lsaWdodC5hdG1Qcm9ncmFtLCBcImdhbW1hQ29yXCIpLCBza3lsaWdodC5nYW1tYV9jb3JyZWN0aW9uKTtcclxuXHJcbiAgICBnbC51c2VQcm9ncmFtKGdsb2JhbC5wcm9ncmFtKTtcclxuICAgIGdsLnVuaWZvcm0xaShnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sIFwiaXNDbG91ZFwiKSwgc2t5bGlnaHQuY2xvdWRzKTtcclxuICAgIGdsLnVuaWZvcm0xZihnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sIFwiY2xvdWREZW5zaXR5XCIpLCBza3lsaWdodC5jbG91ZF9kZW5zaXR5KTtcclxuICAgIGdsLnVuaWZvcm0xZihnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sIFwiY2xvdWRIZWlnaHRcIiksIHNreWxpZ2h0LmNsb3VkX2hlaWdodCk7XHJcbiAgICBnbC51bmlmb3JtMWYoZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsb2JhbC5wcm9ncmFtLCBcImNsb3VkVGhpY2tuZXNzXCIpLCBza3lsaWdodC5jbG91ZF90aGlja25lc3MpO1xyXG5cclxuICAgIGxldCB2ID0gW1xyXG4gICAgICAgIC0xLjAsIDEuMCwgLTEuMCxcclxuICAgICAgICAtMS4wLCAtMS4wLCAtMS4wLFxyXG4gICAgICAgIDEuMCwgLTEuMCwgLTEuMCxcclxuICAgICAgICAxLjAsIC0xLjAsIC0xLjAsXHJcbiAgICAgICAgMS4wLCAxLjAsIC0xLjAsXHJcbiAgICAgICAgLTEuMCwgMS4wLCAtMS4wLFxyXG5cclxuICAgICAgICAtMS4wLCAtMS4wLCAxLjAsXHJcbiAgICAgICAgLTEuMCwgLTEuMCwgLTEuMCxcclxuICAgICAgICAtMS4wLCAxLjAsIC0xLjAsXHJcbiAgICAgICAgLTEuMCwgMS4wLCAtMS4wLFxyXG4gICAgICAgIC0xLjAsIDEuMCwgMS4wLFxyXG4gICAgICAgIC0xLjAsIC0xLjAsIDEuMCxcclxuXHJcbiAgICAgICAgMS4wLCAtMS4wLCAtMS4wLFxyXG4gICAgICAgIDEuMCwgLTEuMCwgMS4wLFxyXG4gICAgICAgIDEuMCwgMS4wLCAxLjAsXHJcbiAgICAgICAgMS4wLCAxLjAsIDEuMCxcclxuICAgICAgICAxLjAsIDEuMCwgLTEuMCxcclxuICAgICAgICAxLjAsIC0xLjAsIC0xLjAsXHJcblxyXG4gICAgICAgIC0xLjAsIC0xLjAsIDEuMCxcclxuICAgICAgICAtMS4wLCAxLjAsIDEuMCxcclxuICAgICAgICAxLjAsIDEuMCwgMS4wLFxyXG4gICAgICAgIDEuMCwgMS4wLCAxLjAsXHJcbiAgICAgICAgMS4wLCAtMS4wLCAxLjAsXHJcbiAgICAgICAgLTEuMCwgLTEuMCwgMS4wLFxyXG5cclxuICAgICAgICAtMS4wLCAxLjAsIC0xLjAsXHJcbiAgICAgICAgMS4wLCAxLjAsIC0xLjAsXHJcbiAgICAgICAgMS4wLCAxLjAsIDEuMCxcclxuICAgICAgICAxLjAsIDEuMCwgMS4wLFxyXG4gICAgICAgIC0xLjAsIDEuMCwgMS4wLFxyXG4gICAgICAgIC0xLjAsIDEuMCwgLTEuMCxcclxuXHJcbiAgICAgICAgLTEuMCwgLTEuMCwgLTEuMCxcclxuICAgICAgICAtMS4wLCAtMS4wLCAxLjAsXHJcbiAgICAgICAgMS4wLCAtMS4wLCAtMS4wLFxyXG4gICAgICAgIDEuMCwgLTEuMCwgLTEuMCxcclxuICAgICAgICAtMS4wLCAtMS4wLCAxLjAsXHJcbiAgICAgICAgMS4wLCAtMS4wLCAxLjBcclxuICAgIF07XHJcbiAgICBsZXQgYXRtVmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KHYpO1xyXG5cclxuICAgIHNreWxpZ2h0LmF0bVZhbyA9IGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7XHJcblxyXG4gICAgbGV0IHZibyA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xyXG5cclxuICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShza3lsaWdodC5hdG1WYW8pO1xyXG5cclxuICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2Ym8pO1xyXG4gICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIGF0bVZlcnRpY2VzLmJ5dGVMZW5ndGgsIGdsLlNUQVRJQ19EUkFXKTtcclxuICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuQVJSQVlfQlVGRkVSLCAwLCBhdG1WZXJ0aWNlcyk7XHJcblxyXG5cclxuICAgIC8vIFBvc2l0aW9uIGF0dHJpYnV0ZVxyXG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcigwLCAzLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDApO1xyXG4gICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoMCk7XHJcblxyXG5cclxuICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShudWxsKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkcmF3QXRtb3NwaGVyZShnbCwgbWF0cml4LCBwcmV2X3Byb2dyYW0pIHtcclxuICAgIC8vIGdsLmRpc2FibGUoZ2wuREVQVEhfVEVTVCk7XHJcbiAgICBnbC5lbmFibGUoZ2wuQkxFTkQpO1xyXG4gICAgZ2wuYmxlbmRGdW5jU2VwYXJhdGUoZ2wuU1JDX0FMUEhBLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBLCBnbC5aRVJPLCBnbC5PTkUpO1xyXG5cclxuICAgIGdsLnVzZVByb2dyYW0oc2t5bGlnaHQuYXRtUHJvZ3JhbSk7XHJcbiAgICBnbC5kZXB0aEZ1bmMoZ2wuTEVRVUFMKTtcclxuXHJcbiAgICBnbC51bmlmb3JtM2Z2KHNreWxpZ2h0LnVTdW5Qb3NMb2NhdGlvbiwgc2t5bGlnaHQuZXllVG9DYW1lcmEpO1xyXG4gICAgZ2wudW5pZm9ybU1hdHJpeDRmdihza3lsaWdodC52aWV3X0xvY2F0aW9uLCBmYWxzZSwgbWF0cml4LnYpO1xyXG4gICAgZ2wudW5pZm9ybU1hdHJpeDRmdihza3lsaWdodC5wcm9qZWN0X0xvY2F0aW9uLCBmYWxzZSwgbWF0cml4LnApO1xyXG5cclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV9DVUJFX01BUCwgc2t5Ym94LnRleF9jdWJlbWFwKTtcclxuICAgIGdsLnVuaWZvcm0xaShnbC5nZXRVbmlmb3JtTG9jYXRpb24oc2t5bGlnaHQuYXRtUHJvZ3JhbSwgXCJza3lib3hcIiksIDApO1xyXG5cclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTEpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgc2t5bGlnaHQudGV4X25vaXNlKTtcclxuICAgIGdsLnVuaWZvcm0xaShnbC5nZXRVbmlmb3JtTG9jYXRpb24oc2t5bGlnaHQuYXRtUHJvZ3JhbSwgXCJ0ZXhfbm9pc2VcIiksIDEpO1xyXG5cclxuICAgIGdsLnVuaWZvcm0xZihnbC5nZXRVbmlmb3JtTG9jYXRpb24oc2t5bGlnaHQuYXRtUHJvZ3JhbSwgXCJpVGltZVwiKSwgc2t5bGlnaHQuaVRpbWUqMTAwKTtcclxuICAgIFxyXG5cclxuICAgIC8vIHNreWJveCByb3RhdGlvblxyXG4gICAgLy8gIDAgMTIgMjRcclxuICAgIC8vICswICsxMi0gLTBcclxuICAgIGxldCByb3RUaW1lID0gc2t5bGlnaHQudGltZTtcclxuICAgIGlmKHNreWxpZ2h0LnRpbWU+PTEyLjApe1xyXG4gICAgICAgIHJvdFRpbWUgPSBza3lsaWdodC50aW1lLTI0LjA7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJvdCA9IGdsbS5tYXQ0LmNyZWF0ZSgpO1xyXG4gICAgZ2xtLm1hdDQucm90YXRlWChyb3QsIHJvdCwgTWF0aC5QSSAqIDIzLjUgLyAxODAuMCk7XHJcbiAgICBsZXQgYiA9IGdsbS5tYXQ0LmNyZWF0ZSgpO1xyXG4gICAgZ2xtLm1hdDQucm90YXRlWihiLCBiLCBNYXRoLlBJICogKHJvdFRpbWUgLyAyNC4wKSAqIDM2MCAvIDE4MC4wKTtcclxuICAgIGdsbS5tYXQ0Lm11bHRpcGx5KHJvdCwgYiwgcm90KTtcclxuICAgIGdsbS5tYXQ0LnJvdGF0ZVkoYiwgZ2xtLm1hdDQuY3JlYXRlKCksIE1hdGguUEkgKiAocm90VGltZSAvIDI0LjApIC8gMTgwLjApO1xyXG4gICAgZ2xtLm1hdDQubXVsdGlwbHkocm90LCBiLCByb3QpO1xyXG4gICAgZ2wudW5pZm9ybU1hdHJpeDRmdihnbC5nZXRVbmlmb3JtTG9jYXRpb24oc2t5bGlnaHQuYXRtUHJvZ3JhbSwgXCJyb3RcIiksIGZhbHNlLCByb3QpO1xyXG5cclxuICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShza3lsaWdodC5hdG1WYW8pO1xyXG4gICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRVMsIDAsIDM2KTtcclxuICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShudWxsKTtcclxuXHJcbiAgICAvLyBnbC5lbmFibGUoZ2wuREVQVEhfVEVTVCk7XHJcbiAgICBnbC5kZXB0aEZ1bmMoZ2wuTEVTUyk7XHJcbiAgICBnbC51c2VQcm9ncmFtKHByZXZfcHJvZ3JhbSk7XHJcblxyXG4gICAgZ2wuZGlzYWJsZShnbC5CTEVORCk7XHJcbn0iLCJpbXBvcnQgKiBhcyBnbG0gZnJvbSAnZ2wtbWF0cml4JztcclxuaW1wb3J0IHsgY2hlY2tHcm91bmQgfSBmcm9tICcuL3JheWNhc3QnO1xyXG5pbXBvcnQgeyB0ZXJyYWluT2JqLCBnZXRZIH0gZnJvbSAnLi90ZXJyYWluJztcclxuaW1wb3J0IHsgc2t5bGlnaHQgfSBmcm9tICcuL3NreWxpZ2h0JztcclxuaW1wb3J0IHsgY3NtIH0gZnJvbSAnLi9yZW5kZXInO1xyXG5cclxuZXhwb3J0IHZhciBjYW1lcmEgPSB7XHJcbiAgICBleWU6IG51bGwsICAgICAgLy8gcG9zaXRpb25cclxuICAgIGZyb250OiBudWxsLFxyXG4gICAgdXA6IG51bGwsXHJcbiAgICBuZWFyOiBudWxsLFxyXG4gICAgZmFyOiBudWxsLFxyXG5cclxuICAgIEZPVjogbnVsbCxcclxuXHJcbiAgICB5YXc6IG51bGwsXHJcbiAgICBwaXRjaDogbnVsbCxcclxuXHJcbiAgICByb3Rfc2Vuc2l0aXZpdHk6IG51bGwsXHJcblxyXG4gICAga2V5ZG93bl9hOiBudWxsLFxyXG4gICAga2V5ZG93bl93OiBudWxsLFxyXG4gICAga2V5ZG93bl9kOiBudWxsLFxyXG4gICAga2V5ZG93bl9zOiBudWxsLFxyXG4gICAga2V5ZG93bl96OiBudWxsLFxyXG4gICAga2V5ZG93bl94OiBudWxsLFxyXG4gICAga2V5ZG93bl9zaGlmdDogbnVsbCxcclxuICAgIGtleWRvd25fc3BhY2U6IG51bGwsXHJcblxyXG4gICAgc3BlZWQ6IG51bGwsXHJcbiAgICBzcGVlZEZhc3Q6IG51bGwsXHJcblxyXG4gICAgdmVsb2NpdHlfeTogbnVsbCxcclxuICAgIHZlbG9jaXR5X3lfbWluOiBudWxsLFxyXG5cclxuICAgIGZseTogZmFsc2UsXHJcbn1cclxuXHJcbnZhciByYXlfZGlyZWN0aW9uID0gZ2xtLnZlYzMuZnJvbVZhbHVlcygwLCAtMSwgMCk7XHJcbnZhciB2MCA9IGdsbS52ZWMzLmZyb21WYWx1ZXMoLTEsIC0xLCAwKTtcclxudmFyIHYxID0gZ2xtLnZlYzMuZnJvbVZhbHVlcygxLCAxLCAwKTtcclxudmFyIHYyID0gZ2xtLnZlYzMuZnJvbVZhbHVlcygtMSwgMSwgMCk7XHJcbnZhciByYXlfbGVuZ3RoID0gMTYuMCAqIDEuNztcclxudmFyIGdyb3VuZCA9IGZhbHNlO1xyXG52YXIgY2FuSnVtcCA9IGZhbHNlO1xyXG52YXIganVtcEZvcmNlID0gMi4wO1xyXG52YXIgc2VhTGV2ZWwgPSAtMzIuMDtcclxudmFyIHdhdGVyRHJhZyA9IDAuNTtcclxudmFyIGdyYXZpdHkgPSAwLjA7XHJcbi8vIHZhciBvdXQgPSBnbG0udmVjMy5mcm9tVmFsdWVzKDAsIDAsIDApO1xyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjYW1lcmFJbml0KHZpZXdfbWF0cml4LCBmb3YpIHtcclxuICAgIGNhbWVyYS5leWUgPSBnbG0udmVjMy5mcm9tVmFsdWVzKDE2MDAsIDIwMCwgMjAwMCk7XHJcbiAgICBjYW1lcmEuZnJvbnQgPSBnbG0udmVjMy5mcm9tVmFsdWVzKDEsIDAsIDApO1xyXG4gICAgY2FtZXJhLnVwID0gZ2xtLnZlYzMuZnJvbVZhbHVlcygwLCAxLCAwKTtcclxuICAgIGNhbWVyYS5uZWFyID0gMC4xO1xyXG4gICAgY2FtZXJhLmZhciA9IDMyMDAuMDtcclxuXHJcbiAgICBjYW1lcmEuRk9WID0gZm92O1xyXG5cclxuICAgIGNhbWVyYS55YXcgPSAwLjA7XHJcbiAgICBjYW1lcmEucGl0Y2ggPSAwLjA7XHJcblxyXG4gICAgY2FtZXJhLnJvdF9zZW5zaXRpdml0eSA9IDAuMDg7XHJcblxyXG4gICAgY2FtZXJhLmtleWRvd25fYSA9IGZhbHNlO1xyXG4gICAgY2FtZXJhLmtleWRvd25fdyA9IGZhbHNlO1xyXG4gICAgY2FtZXJhLmtleWRvd25fZCA9IGZhbHNlO1xyXG4gICAgY2FtZXJhLmtleWRvd25fcyA9IGZhbHNlO1xyXG4gICAgY2FtZXJhLmtleWRvd25feiA9IGZhbHNlO1xyXG4gICAgY2FtZXJhLmtleWRvd25feCA9IGZhbHNlO1xyXG4gICAgY2FtZXJhLmtleWRvd25fc2hpZnQgPSBmYWxzZTtcclxuICAgIGNhbWVyYS5rZXlkb3duX3NwYWNlID0gZmFsc2U7XHJcblxyXG4gICAgY2FtZXJhLnNwZWVkID0gMS4wO1xyXG4gICAgY2FtZXJhLnNwZWVkRmFzdCA9IDIuMDtcclxuXHJcbiAgICBjYW1lcmEudmVsb2NpdHlfeSA9IDAuMDtcclxuICAgIGNhbWVyYS52ZWxvY2l0eV95X21pbiA9IC0xNi4wO1xyXG5cclxuICAgIHJlY2FsY3VsYXRlVmlld01hdHJpeCh2aWV3X21hdHJpeCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjYW1lcmFNb3ZlKCkge1xyXG5cclxuICAgIC8vcm90YXRlXHJcbiAgICBjYW1lcmEuZnJvbnRbMF0gPSBNYXRoLmNvcyhjYW1lcmEucGl0Y2ggKiAoTWF0aC5QSSAvIDE4MCkpICogTWF0aC5jb3MoY2FtZXJhLnlhdyAqIChNYXRoLlBJIC8gMTgwKSk7XHJcbiAgICBjYW1lcmEuZnJvbnRbMV0gPSBNYXRoLnNpbihjYW1lcmEucGl0Y2ggKiAoTWF0aC5QSSAvIDE4MCkpO1xyXG4gICAgY2FtZXJhLmZyb250WzJdID0gTWF0aC5jb3MoY2FtZXJhLnBpdGNoICogKE1hdGguUEkgLyAxODApKSAqIE1hdGguc2luKGNhbWVyYS55YXcgKiAoTWF0aC5QSSAvIDE4MCkpO1xyXG5cclxuICAgIGdsbS52ZWMzLm5vcm1hbGl6ZShjYW1lcmEuZnJvbnQsIGNhbWVyYS5mcm9udCk7XHJcblxyXG5cclxuICAgIC8vbW92ZVxyXG4gICAgbGV0IGRpcl90bXAgPSBnbG0udmVjMy5mcm9tVmFsdWVzKDAsIDAsIDApO1xyXG4gICAgbGV0IG1vdmVfdG1wID0gZ2xtLnZlYzMuZnJvbVZhbHVlcygwLCAwLCAwKTtcclxuICAgIGxldCBzcGVlZF90bXAgPSAoY2FtZXJhLmtleWRvd25fc2hpZnQpID8gY2FtZXJhLnNwZWVkRmFzdCA6IGNhbWVyYS5zcGVlZDtcclxuICAgIGxldCB1bmRlcndhdGVyID0gZmFsc2U7XHJcbiAgICBpZihjYW1lcmEuZmx5KXtcclxuICAgICAgICBzcGVlZF90bXAgKj0gNS4wO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgLy91bmRlcndhdGVyIGRldGVjdGlvblxyXG4gICAgICAgIGlmIChjYW1lcmEuZXllWzFdIDwgc2VhTGV2ZWwgKyAxNi4wICogMS43IC0gMil7XHJcbiAgICAgICAgICAgIHVuZGVyd2F0ZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICBzcGVlZF90bXAgKj0gd2F0ZXJEcmFnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8vTGVmdFxyXG4gICAgaWYgKGNhbWVyYS5rZXlkb3duX2EpIHtcclxuICAgICAgICBnbG0udmVjMy5jcm9zcyhkaXJfdG1wLCBjYW1lcmEuZnJvbnQsIGNhbWVyYS51cCk7XHJcbiAgICAgICAgZ2xtLnZlYzMubm9ybWFsaXplKGRpcl90bXAsIGRpcl90bXApO1xyXG4gICAgICAgIGdsbS52ZWMzLnNjYWxlKGRpcl90bXAsIGRpcl90bXAsIC1zcGVlZF90bXApO1xyXG4gICAgICAgIGdsbS52ZWMzLmFkZChtb3ZlX3RtcCwgbW92ZV90bXAsIGRpcl90bXApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vRnJvbnRcclxuICAgIGlmIChjYW1lcmEua2V5ZG93bl93KSB7XHJcbiAgICAgICAgaWYoY2FtZXJhLmZseSl7XHJcbiAgICAgICAgICAgIGdsbS52ZWMzLmNvcHkoZGlyX3RtcCwgY2FtZXJhLmZyb250KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgZ2xtLnZlYzMuY3Jvc3MoZGlyX3RtcCwgY2FtZXJhLmZyb250LCBjYW1lcmEudXApO1xyXG4gICAgICAgICAgICBnbG0udmVjMy5jcm9zcyhkaXJfdG1wLCBjYW1lcmEudXAsIGRpcl90bXApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBnbG0udmVjMy5ub3JtYWxpemUoZGlyX3RtcCwgZGlyX3RtcCk7XHJcbiAgICAgICAgZ2xtLnZlYzMuc2NhbGUoZGlyX3RtcCwgZGlyX3RtcCwgc3BlZWRfdG1wKTtcclxuICAgICAgICBnbG0udmVjMy5hZGQobW92ZV90bXAsIG1vdmVfdG1wLCBkaXJfdG1wKTtcclxuICAgIH1cclxuXHJcbiAgICAvL1JpZ2h0XHJcbiAgICBpZiAoY2FtZXJhLmtleWRvd25fZCkge1xyXG4gICAgICAgIGdsbS52ZWMzLmNyb3NzKGRpcl90bXAsIGNhbWVyYS5mcm9udCwgY2FtZXJhLnVwKTtcclxuICAgICAgICBnbG0udmVjMy5ub3JtYWxpemUoZGlyX3RtcCwgZGlyX3RtcCk7XHJcbiAgICAgICAgZ2xtLnZlYzMuc2NhbGUoZGlyX3RtcCwgZGlyX3RtcCwgc3BlZWRfdG1wKTtcclxuICAgICAgICBnbG0udmVjMy5hZGQobW92ZV90bXAsIG1vdmVfdG1wLCBkaXJfdG1wKTtcclxuICAgIH1cclxuXHJcbiAgICAvL0JhY2tcclxuICAgIGlmIChjYW1lcmEua2V5ZG93bl9zKSB7XHJcbiAgICAgICAgaWYoY2FtZXJhLmZseSl7XHJcbiAgICAgICAgICAgIGdsbS52ZWMzLmNvcHkoZGlyX3RtcCwgY2FtZXJhLmZyb250KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgZ2xtLnZlYzMuY3Jvc3MoZGlyX3RtcCwgY2FtZXJhLmZyb250LCBjYW1lcmEudXApO1xyXG4gICAgICAgICAgICBnbG0udmVjMy5jcm9zcyhkaXJfdG1wLCBjYW1lcmEudXAsIGRpcl90bXApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBnbG0udmVjMy5ub3JtYWxpemUoZGlyX3RtcCwgZGlyX3RtcCk7XHJcbiAgICAgICAgZ2xtLnZlYzMuc2NhbGUoZGlyX3RtcCwgZGlyX3RtcCwgLXNwZWVkX3RtcCk7XHJcbiAgICAgICAgZ2xtLnZlYzMuYWRkKG1vdmVfdG1wLCBtb3ZlX3RtcCwgZGlyX3RtcCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9VcFxyXG4gICAgaWYgKGNhbWVyYS5rZXlkb3duX3opIHtcclxuICAgICAgICBnbG0udmVjMy5jb3B5KGRpcl90bXAsIGNhbWVyYS51cCk7XHJcbiAgICAgICAgZ2xtLnZlYzMuc2NhbGUoZGlyX3RtcCwgZGlyX3RtcCwgc3BlZWRfdG1wKTtcclxuICAgICAgICBnbG0udmVjMy5hZGQoY2FtZXJhLmV5ZSwgY2FtZXJhLmV5ZSwgZGlyX3RtcCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9Eb3duXHJcbiAgICBpZiAoY2FtZXJhLmtleWRvd25feCkge1xyXG4gICAgICAgIGdsbS52ZWMzLmNvcHkoZGlyX3RtcCwgY2FtZXJhLnVwKTtcclxuICAgICAgICBnbG0udmVjMy5zY2FsZShkaXJfdG1wLCBkaXJfdG1wLCAtc3BlZWRfdG1wKTtcclxuICAgICAgICBnbG0udmVjMy5hZGQoY2FtZXJhLmV5ZSwgY2FtZXJhLmV5ZSwgZGlyX3RtcCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZGV0ZWN0IGdyb3VuZCAocmF5Y2FzdClcclxuICAgIGlmKCFjYW1lcmEuZmx5KXtcclxuICAgICAgICBsZXQgeCA9IE1hdGguZmxvb3IoY2FtZXJhLmV5ZVswXSAvIDE2LjApO1xyXG4gICAgICAgIGxldCB6ID0gTWF0aC5mbG9vcihjYW1lcmEuZXllWzJdIC8gMTYuMCk7XHJcbiAgICAgICAgbGV0IHkgPSBjYW1lcmEuZXllWzFdIC8gMTYuMCAtIDIuNTtcclxuXHJcbiAgICAgICAgbGV0IHgyID0gTWF0aC5mbG9vcigoY2FtZXJhLmV5ZVswXSArIG1vdmVfdG1wWzBdKSAvIDE2LjApO1xyXG4gICAgICAgIGxldCB6MiA9IE1hdGguZmxvb3IoKGNhbWVyYS5leWVbMl0gKyBtb3ZlX3RtcFsyXSkgLyAxNi4wKTtcclxuXHJcbiAgICAgICAgaWYoeDIgPT0geCB8fCB5ID49IGdldFkoeDIsIHopKXtcclxuICAgICAgICAgICAgY2FtZXJhLmV5ZVswXSArPSBtb3ZlX3RtcFswXTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coeSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGdldFkoeDIsIHopKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoejIgPT0geiB8fCB5ID49IGdldFkoeCwgejIpKXtcclxuICAgICAgICAgICAgY2FtZXJhLmV5ZVsyXSArPSBtb3ZlX3RtcFsyXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNhbkp1bXAgPSBmYWxzZTtcclxuICAgICAgICBsZXQgZ3JvdW5kID0gY2hlY2tHcm91bmQoY2FtZXJhLmV5ZSwgcmF5X2RpcmVjdGlvbiwgcmF5X2xlbmd0aCwgdGVycmFpbk9iaik7XHJcbiAgICAgICAgaWYgKGdyb3VuZCkge1xyXG4gICAgICAgICAgICBjYW5KdW1wID0gdHJ1ZTtcclxuICAgICAgICAgICAgY2FtZXJhLnZlbG9jaXR5X3kgPSAwLjA7XHJcbiAgICAgICAgICAgIGdyYXZpdHkgPSAwLjA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHVuZGVyd2F0ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNhbkp1bXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAganVtcEZvcmNlID0gMS4wO1xyXG4gICAgICAgICAgICAgICAgZ3Jhdml0eSA9IC0wLjAyO1xyXG4gICAgICAgICAgICAgICAgY2FtZXJhLnZlbG9jaXR5X3lfbWluID0gLTE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBncmF2aXR5ID0gLTAuMTtcclxuICAgICAgICAgICAgICAgIGp1bXBGb3JjZSA9IDIuMDtcclxuICAgICAgICAgICAgICAgIGNhbWVyYS52ZWxvY2l0eV95X21pbiA9IC0xNjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIGlmIChjYW1lcmEua2V5ZG93bl9zcGFjZSAmJiBjYW5KdW1wKSB7XHJcbiAgICAgICAgICAgIGNhbWVyYS52ZWxvY2l0eV95ID0ganVtcEZvcmNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNhbWVyYS52ZWxvY2l0eV95ICs9IGdyYXZpdHk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgaWYgKGNhbWVyYS52ZWxvY2l0eV95IDwgY2FtZXJhLnZlbG9jaXR5X3lfbWluKSB7XHJcbiAgICAgICAgICAgIGNhbWVyYS52ZWxvY2l0eV95ID0gKGNhbWVyYS52ZWxvY2l0eV95X21pbiArIGNhbWVyYS52ZWxvY2l0eV95KSAvIDIuMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGdyYXZpdHlcclxuICAgICAgICBnbG0udmVjMy5jb3B5KGRpcl90bXAsIGNhbWVyYS51cCk7XHJcbiAgICAgICAgZ2xtLnZlYzMuc2NhbGUoZGlyX3RtcCwgZGlyX3RtcCwgY2FtZXJhLnZlbG9jaXR5X3kpO1xyXG4gICAgICAgIGdsbS52ZWMzLmFkZChjYW1lcmEuZXllLCBjYW1lcmEuZXllLCBkaXJfdG1wKTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIGdsbS52ZWMzLmFkZChjYW1lcmEuZXllLCBjYW1lcmEuZXllLCBtb3ZlX3RtcCk7XHJcbiAgICAgICAgZ3Jhdml0eSA9IDAuMDtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8vIGNoZWNrR3JvdW5kIChjYW1lcmEuZXllLCByYXlfZGlyZWN0aW9uLCByYXlfbGVuZ3RoLCB0ZXJyYWluT2JqKTtcclxuXHJcbiAgICAvLyBmb3IgKHZhciBpPTA7IGk8dGVycmFpbk9iai5tZXNoLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAvLyAgICAgaWYoIGdsbS52ZWMyLmRpc3RhbmNlKCBbdGVycmFpbk9iai5tZXNoW2ldWzBdWzBdLCB0ZXJyYWluT2JqLm1lc2hbaV1bMF1bMl0gXSwgW2NhbWVyYS5leWVbMF0sIGNhbWVyYS5leWVbMl1dICkgPD0gNTBcclxuICAgIC8vICAgICB8fCAgZ2xtLnZlYzIuZGlzdGFuY2UoIFt0ZXJyYWluT2JqLm1lc2hbaV1bMV1bMF0sIHRlcnJhaW5PYmoubWVzaFtpXVsxXVsyXSBdLCBbY2FtZXJhLmV5ZVswXSwgY2FtZXJhLmV5ZVsyXV0gKSA8PSA1MFxyXG4gICAgLy8gICAgIHx8ICBnbG0udmVjMi5kaXN0YW5jZSggW3RlcnJhaW5PYmoubWVzaFtpXVsyXVswXSwgdGVycmFpbk9iai5tZXNoW2ldWzJdWzJdIF0sIFtjYW1lcmEuZXllWzBdLCBjYW1lcmEuZXllWzJdXSApIDw9IDUwXHJcbiAgICAvLyAgICAgKVxyXG4gICAgLy8gICAgIGNoZWNrSW50ZXJzZWN0KGNhbWVyYS5leWUsIHJheV9kaXJlY3Rpb24sIHRlcnJhaW5PYmoubWVzaFtpXVswXSwgdGVycmFpbk9iai5tZXNoW2ldWzFdLCB0ZXJyYWluT2JqLm1lc2hbaV1bMl0sIG91dCk7XHJcbiAgICAvLyB9XHJcbiAgICBza3lsaWdodC5leWUgPSBnbG0udmVjMy5mcm9tVmFsdWVzKGNhbWVyYS5leWVbMF0gKyBza3lsaWdodC5leWVUb0NhbWVyYVswXSwgY2FtZXJhLmV5ZVsxXSArIHNreWxpZ2h0LmV5ZVRvQ2FtZXJhWzFdLCBjYW1lcmEuZXllWzJdICsgc2t5bGlnaHQuZXllVG9DYW1lcmFbMl0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVjYWxjdWxhdGVWaWV3TWF0cml4KHZpZXdfbWF0cml4KSB7XHJcbiAgICBsZXQgY2VudGVyID0gZ2xtLnZlYzMuZnJvbVZhbHVlcyhjYW1lcmEuZXllWzBdICsgY2FtZXJhLmZyb250WzBdLCBjYW1lcmEuZXllWzFdICsgY2FtZXJhLmZyb250WzFdLCBjYW1lcmEuZXllWzJdICsgY2FtZXJhLmZyb250WzJdKTtcclxuICAgIGdsbS5tYXQ0Lmxvb2tBdCh2aWV3X21hdHJpeCwgY2FtZXJhLmV5ZSwgY2VudGVyLCBjYW1lcmEudXApO1xyXG4gICAgaWYoc2t5bGlnaHQuZXllKXtcclxuICAgICAgICBjc20oKTtcclxuICAgIH1cclxuICAgIFxyXG59IiwiaW1wb3J0IHsgY2FtZXJhIH0gZnJvbSAnLi9jYW1lcmEnO1xyXG5pbXBvcnQgeyBhZGRTa3lsaWdodFRpbWUgfSBmcm9tICcuL3NreWxpZ2h0JztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb250cm9sSW5pdCgpIHtcclxuXHJcbiAgICBkb2N1bWVudC5vbmtleWRvd24gPSBrZXlib2FyZEV2ZW50S2V5RG93bjtcclxuICAgIGRvY3VtZW50Lm9ua2V5dXAgPSBrZXlib2FyZEV2ZW50S2V5VXA7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2NhbnZhcycpLm9ubW91c2Vkb3duID0gbW91c2VEb3duO1xyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsb2NrY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChkb2N1bWVudC5wb2ludGVyTG9ja0VsZW1lbnQgPT0gZG9jdW1lbnQuYm9keSkge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIG1vdXNlTW92ZSwgZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSwgZmFsc2UpO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24ga2V5Ym9hcmRFdmVudEtleURvd24oZXYpIHtcclxuICAgIC8vIGNvbnNvbGUubG9nKGV2KTtcclxuICAgIHN3aXRjaCAoZXYua2V5Q29kZSkge1xyXG4gICAgICAgIGNhc2UgNjU6IC8vYVxyXG4gICAgICAgICAgICBjYW1lcmEua2V5ZG93bl9hID0gdHJ1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgODc6IC8vd1xyXG4gICAgICAgICAgICBjYW1lcmEua2V5ZG93bl93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgNjg6IC8vZFxyXG4gICAgICAgICAgICBjYW1lcmEua2V5ZG93bl9kID0gdHJ1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgODM6IC8vc1xyXG4gICAgICAgICAgICBjYW1lcmEua2V5ZG93bl9zID0gdHJ1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgOTA6IC8velxyXG4gICAgICAgICAgICBjYW1lcmEua2V5ZG93bl96ID0gdHJ1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgODg6IC8veFxyXG4gICAgICAgICAgICBjYW1lcmEua2V5ZG93bl94ID0gdHJ1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgMTY6IC8vc2hpZnRcclxuICAgICAgICAgICAgY2FtZXJhLmtleWRvd25fc2hpZnQgPSB0cnVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAzMjogLy9zcGFjZVxyXG4gICAgICAgICAgICBjYW1lcmEua2V5ZG93bl9zcGFjZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIDg0OiAvL3RcclxuICAgICAgICAgICAgYWRkU2t5bGlnaHRUaW1lKDUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSA4MjogLy9yXHJcbiAgICAgICAgICAgIGFkZFNreWxpZ2h0VGltZSgtNSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZnVuY3Rpb24ga2V5Ym9hcmRFdmVudEtleVVwKGV2KSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhldik7XHJcbiAgICBzd2l0Y2ggKGV2LmtleUNvZGUpIHtcclxuICAgICAgICBjYXNlIDY1OiAvL2FcclxuICAgICAgICAgICAgY2FtZXJhLmtleWRvd25fYSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSA4NzogLy93XHJcbiAgICAgICAgICAgIGNhbWVyYS5rZXlkb3duX3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgNjg6IC8vZFxyXG4gICAgICAgICAgICBjYW1lcmEua2V5ZG93bl9kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIDgzOiAvL3NcclxuICAgICAgICAgICAgY2FtZXJhLmtleWRvd25fcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSA5MDogLy96XHJcbiAgICAgICAgICAgIGNhbWVyYS5rZXlkb3duX3ogPSBmYWxzZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgODg6IC8veFxyXG4gICAgICAgICAgICBjYW1lcmEua2V5ZG93bl94ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIDE2OiAvL3NoaWZ0XHJcbiAgICAgICAgICAgIGNhbWVyYS5rZXlkb3duX3NoaWZ0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIDMyOiAvL3NwYWNlXHJcbiAgICAgICAgICAgIGNhbWVyYS5rZXlkb3duX3NwYWNlID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gbW91c2VNb3ZlKGV2KSB7XHJcblxyXG4gICAgLy8gY29uc29sZS5sb2coZXYpO1xyXG5cclxuICAgIGxldCB4b2Zmc2V0ID0gZXYubW92ZW1lbnRYO1xyXG4gICAgbGV0IHlvZmZzZXQgPSAtZXYubW92ZW1lbnRZO1xyXG5cclxuICAgIHhvZmZzZXQgKj0gY2FtZXJhLnJvdF9zZW5zaXRpdml0eTtcclxuICAgIHlvZmZzZXQgKj0gY2FtZXJhLnJvdF9zZW5zaXRpdml0eTtcclxuXHJcbiAgICBjYW1lcmEueWF3ICs9IHhvZmZzZXQ7XHJcbiAgICBjYW1lcmEucGl0Y2ggKz0geW9mZnNldDtcclxuXHJcbiAgICBpZiAoY2FtZXJhLnBpdGNoID4gODkuMClcclxuICAgICAgICBjYW1lcmEucGl0Y2ggPSA4OS4wO1xyXG4gICAgaWYgKGNhbWVyYS5waXRjaCA8IC04OS4wKVxyXG4gICAgICAgIGNhbWVyYS5waXRjaCA9IC04OS4wO1xyXG5cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIG1vdXNlRG93bihldikge1xyXG5cclxuICAgIGlmIChldi53aGljaCA9PSAxKSB7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LnBvaW50ZXJMb2NrRWxlbWVudCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVxdWVzdFBvaW50ZXJMb2NrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSIsImltcG9ydCAqIGFzIGdsbSBmcm9tICdnbC1tYXRyaXgnO1xyXG5pbXBvcnQgKiBhcyBTdGF0cyBmcm9tICdzdGF0cy1qcyc7XHJcbmltcG9ydCAqIGFzIERhdCBmcm9tICdkYXQuZ3VpJztcclxuaW1wb3J0IHsgdGVycmFpbk9iaiwgd2F0ZXJPYmosIGdlbmVyYXRlVGVycmFpbiB9IGZyb20gJy4vdGVycmFpbic7XHJcbmltcG9ydCB7IGNhbWVyYSwgY2FtZXJhSW5pdCwgcmVjYWxjdWxhdGVWaWV3TWF0cml4LCBjYW1lcmFNb3ZlIH0gZnJvbSAnLi9jYW1lcmEnO1xyXG5pbXBvcnQgeyBjb250cm9sSW5pdCB9IGZyb20gJy4vY29udHJvbCc7XHJcbmltcG9ydCB7IHNreWJveCwgc2t5Ym94SW5pdCwgY3JlYXRlU2t5Ym94VGV4dHVyZSwgZHJhd1NreWJveCB9IGZyb20gJy4vc2t5Ym94JztcclxuaW1wb3J0IHsgc2t5bGlnaHQsIHNreWxpZ2h0SW5pdCwgYWRkU2t5bGlnaHRUaW1lLCBkcmF3QXRtb3NwaGVyZSB9IGZyb20gJy4vc2t5bGlnaHQnO1xyXG5cclxuLy8gZ2xvYmFsIHZhcmlhYmxlXHJcbnZhciBnbCA9IHdpbmRvdy5XZWJHTDJSZW5kZXJpbmdDb250ZXh0LnByb3RvdHlwZTsgLy8gc3BlY2lmeSB0eXBlIGZvciBjb2RlIHNuaXBwZXRcclxudmFyIHN0YXRzID0gbnVsbDtcclxudmFyIGd1aSA9IG51bGw7XHJcblxyXG52YXIgZ2xvYmFsID0ge1xyXG4gICAgcHJvZ3JhbTogbnVsbCxcclxuICAgIHN0YXJ0OiBudWxsLFxyXG59O1xyXG52YXIgbWF0cml4ID0ge1xyXG4gICAgbTogbnVsbCxcclxuICAgIHY6IG51bGwsXHJcbiAgICBwOiBudWxsLFxyXG59O1xyXG52YXIgdW5pZm9ybSA9IHtcclxuICAgIG12cDogbnVsbCxcclxuICAgIG06IG51bGwsXHJcbiAgICBleWU6IG51bGwsXHJcbiAgICBsaWdodDogbnVsbCxcclxuICAgIGNvOiBudWxsLFxyXG4gICAgbm06IG51bGwsXHJcbiAgICB1c2U6IG51bGwsXHJcbiAgICB1c2VBTzogbnVsbCxcclxuICAgIHVzZVNoYWRvdzogbnVsbCxcclxuICAgIGRlcHRoQnVmZmVyTG9jYXRpb246IFtdLFxyXG4gICAgc2hhZG93TVZQTG9jYXRpb246IG51bGwsXHJcbiAgICBiaWFzTG9jYXRpb246IG51bGwsXHJcbiAgICBjc21SYW5nZTogW10sXHJcbiAgICB1TDogW10sXHJcbiAgICBzaGFkb3dDb2xvcjogbnVsbCxcclxufTtcclxudmFyIG1vZGVsID0ge1xyXG4gICAgdmFvOiBudWxsLFxyXG4gICAgY3RyOiBudWxsLFxyXG4gICAgdGV4OiBbXSxcclxufTtcclxudmFyIGhpZ2hSZXNvbHV0aW9uT2Zmc2V0ID0gMDtcclxudmFyIFVJID0ge1xyXG4gICAgTm9ybWFsX01hcHBpbmc6IGZhbHNlLFxyXG4gICAgSGlnaF9SZXNvbHV0aW9uOiBmYWxzZSxcclxuICAgIFVzZV9BTzogdHJ1ZSxcclxufVxyXG5cclxudmFyIHRlcnJhaW4gPSB7XHJcbiAgICB2YW86IG51bGwsXHJcbiAgICBjdHI6IG51bGwsXHJcbiAgICB0ZXg6IFtdLFxyXG59XHJcbnZhciB3YXRlciA9IHtcclxuICAgIHZhbzogbnVsbCxcclxuICAgIGN0cjogbnVsbCxcclxuICAgIHRleDogW10sXHJcbiAgICBwcm9ncmFtOiBudWxsLFxyXG4gICAgbXZwOiBudWxsLFxyXG4gICAgbTogbnVsbCxcclxuICAgIGV5ZTogbnVsbCxcclxuICAgIGxpZ2h0OiBudWxsLFxyXG4gICAgY286IG51bGwsXHJcbiAgICBubTogbnVsbCxcclxuICAgIHRleE9mZnNldDogbnVsbCxcclxufVxyXG5cclxudmFyIHNoYWRvd01hcCA9IHtcclxuICAgIHByb2dyYW06IG51bGwsXHJcbiAgICBmYm86IG51bGwsXHJcbiAgICBkZXB0aFRleDogW10sXHJcbiAgICBzaXplOiBudWxsLFxyXG4gICAgdGV4OiBudWxsLFxyXG4gICAgdjogbnVsbCxcclxuICAgIHA6IG51bGwsXHJcbiAgICBtdnA6IG51bGwsXHJcbiAgICBtdnBMb2NhdGlvbjogbnVsbCxcclxuICAgIGxpZ2h0TXZwOiBudWxsLFxyXG4gICAgY29sb3I6IGZhbHNlLFxyXG59XHJcblxyXG52YXIgcG9zdFByb2Nlc3NpbmcgPSB7XHJcbiAgICB2YW86IG51bGwsXHJcbiAgICBwcm9ncmFtOiBudWxsLFxyXG4gICAgZmJvOiBudWxsLFxyXG4gICAgbWFpblRleHR1cmU6IG51bGwsXHJcbiAgICBkZXB0aFRleHR1cmU6IG51bGwsXHJcbiAgICBkZXB0aEJ1ZmZlcjogbnVsbCxcclxuICAgIG1haW5UZXhMb2NhdGlvbjogbnVsbCxcclxuICAgIGRlcHRoVGV4TG9jYXRpb246IG51bGwsXHJcbiAgICBmeGFhT25Mb2NhdGlvbjogbnVsbCxcclxuICAgIHZpZ25ldHRlTG9jYXRpb246IG51bGwsXHJcbiAgICByZXNvbHV0aW9uTG9jYXRpb246IG51bGwsXHJcbn1cclxuXHJcbnZhciBmeGFhID0ge1xyXG4gICAgb246IGZhbHNlXHJcbn1cclxudmFyIHZpZ25ldHRlID0ge1xyXG4gICAgb246IHRydWVcclxufVxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0gY3NtIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxudmFyIGZyYW1lcyA9IFtdO1xyXG52YXIgbnVtX2NzbSA9IDM7XHJcbnZhciBjc21fcmFuZ2UgPSBbXTtcclxudmFyIGNzbV9yYW5nZV9jID0gW107XHJcbnZhciBsaWdodF9tYXRyaWNlcyA9IFtdO1xyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLSBjc20gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGluaXRXZWJHTCgpIHtcclxuICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuICAgIGNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKS5hcHBlbmRDaGlsZChjYW52YXMpO1xyXG4gICAgY2FudmFzLnNldEF0dHJpYnV0ZShcImlkXCIsIFwiZ2NhbnZhc1wiKTtcclxuXHJcbiAgICBnbCA9IGNhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbDInKTtcclxuICAgIGlmICghZ2wpIHtcclxuICAgICAgICBhbGVydCgnV2ViR0wgMiBub3QgYXZhaWxhYmxlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZ2V0IGV4dGVuc2lvblxyXG4gICAgZ2wuZ2V0RXh0ZW5zaW9uKCdFWFRfY29sb3JfYnVmZmVyX2Zsb2F0Jyk7XHJcblxyXG4gICAgLy8gd2ViZ2wgc2V0dGluZ1xyXG4gICAgLy8gZ2wuY2xlYXJDb2xvcigwLjQ3ODQzMSwgMC43MjU0OTAsIDEuMCwgMS4wKTtcclxuICAgIGdsLmNsZWFyQ29sb3IoMC4wLCAwLjAsIDAuMCwgMS4wKTtcclxuICAgIGdsLmNsZWFyRGVwdGgoMS4wKTtcclxuICAgIGdsLmVuYWJsZShnbC5ERVBUSF9URVNUKTtcclxuICAgIGdsLnZpZXdwb3J0KDAsIDAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7XHJcbiAgICBcclxuICAgIC8vIGZwc1xyXG4gICAgc3RhdHMgPSBuZXcgU3RhdHMoKTtcclxuICAgIHN0YXRzLmRvbUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnbmF2YmFyJylcclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3RhdHMuZG9tRWxlbWVudCk7XHJcblxyXG4gICAgLy8gZ3VpXHJcbiAgICBndWkgPSBuZXcgRGF0LkdVSSgpO1xyXG4gICAgZ3VpLmRvbUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnbmF2YmFyJyk7XHJcbiAgICBsZXQgVGVGb2xkZXIgPSBndWkuYWRkRm9sZGVyKCdUZXh0dXJlJyk7XHJcbiAgICBUZUZvbGRlci5hZGQoVUksICdOb3JtYWxfTWFwcGluZycpLm9uQ2hhbmdlKCh2YWwpID0+IHtcclxuICAgICAgICBnbC51c2VQcm9ncmFtKGdsb2JhbC5wcm9ncmFtKTtcclxuICAgICAgICBnbC51bmlmb3JtMWkodW5pZm9ybS51c2UsIHZhbCk7XHJcbiAgICB9KTtcclxuICAgIFRlRm9sZGVyLmFkZChVSSwgJ0hpZ2hfUmVzb2x1dGlvbicpLm9uQ2hhbmdlKCh2YWwpID0+IHtcclxuICAgICAgICBoaWdoUmVzb2x1dGlvbk9mZnNldCA9IChoaWdoUmVzb2x1dGlvbk9mZnNldCArIDIpJTRcclxuICAgIH0pO1xyXG4gICAgVGVGb2xkZXIuYWRkKFVJLCAnVXNlX0FPJykub25DaGFuZ2UoKHZhbCkgPT4ge1xyXG4gICAgICAgIGdsLnVzZVByb2dyYW0oZ2xvYmFsLnByb2dyYW0pO1xyXG4gICAgICAgIGdsLnVuaWZvcm0xaSh1bmlmb3JtLnVzZUFPLCB2YWwpO1xyXG4gICAgfSk7XHJcbiAgICBUZUZvbGRlci5vcGVuKCk7XHJcbiAgICBsZXQgU2hhZG93Rm9sZGVyID0gZ3VpLmFkZEZvbGRlcihcIlNoYWRvd1wiKTtcclxuICAgIFNoYWRvd0ZvbGRlci5hZGQoc2hhZG93TWFwLCBcImNvbG9yXCIpLm9uQ2hhbmdlKCh2YWwpID0+IHtcclxuICAgICAgICBnbC51c2VQcm9ncmFtKGdsb2JhbC5wcm9ncmFtKTtcclxuICAgICAgICBnbC51bmlmb3JtMWkodW5pZm9ybS5zaGFkb3dDb2xvciwgdmFsKTtcclxuICAgIH0pO1xyXG4gICAgU2hhZG93Rm9sZGVyLm9wZW4oKTtcclxuICAgIGxldCBGWEFBRm9sZGVyID0gZ3VpLmFkZEZvbGRlcihcIkZYQUFcIik7XHJcbiAgICBGWEFBRm9sZGVyLmFkZChmeGFhLCBcIm9uXCIpLm9uQ2hhbmdlKCh2YWwpID0+IHtcclxuICAgICAgICBnbC51c2VQcm9ncmFtKHBvc3RQcm9jZXNzaW5nLnByb2dyYW0pO1xyXG4gICAgICAgIGdsLnVuaWZvcm0xaShwb3N0UHJvY2Vzc2luZy5meGFhT25Mb2NhdGlvbiwgdmFsKTtcclxuICAgIH0pO1xyXG4gICAgRlhBQUZvbGRlci5vcGVuKCk7XHJcbiAgICBsZXQgVmlnbmV0dGVGb2xkZXIgPSBndWkuYWRkRm9sZGVyKFwiVmlnbmV0dGVcIik7XHJcbiAgICBWaWduZXR0ZUZvbGRlci5hZGQodmlnbmV0dGUsIFwib25cIikub25DaGFuZ2UoKHZhbCkgPT4ge1xyXG4gICAgICAgIGdsLnVzZVByb2dyYW0ocG9zdFByb2Nlc3NpbmcucHJvZ3JhbSk7XHJcbiAgICAgICAgZ2wudW5pZm9ybTFpKHBvc3RQcm9jZXNzaW5nLnZpZ25ldHRlTG9jYXRpb24sIHZhbCk7XHJcbiAgICB9KTtcclxuICAgIFZpZ25ldHRlRm9sZGVyLm9wZW4oKTtcclxuICAgIFxyXG4gICAgbGV0IGNhbWVyYVVJT2JqZWN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5GT1YgPSA3MDtcclxuICAgIH07XHJcblxyXG4gICAgbGV0IGNhbWVyYVVJID0gbmV3IGNhbWVyYVVJT2JqZWN0KCk7XHJcbiAgICBsZXQgY2FGb2xkZXIgPSBndWkuYWRkRm9sZGVyKCdDYW1lcmEnKTtcclxuICAgIGxldCB0ZXN0O1xyXG4gICAgY2FGb2xkZXIuYWRkKGNhbWVyYVVJLCAnRk9WJywgMC4wMSwgMTc5Ljk5KS5vbkNoYW5nZSgodmFsKSA9PiB7XHJcbiAgICAgICAgZ2xtLm1hdDQucGVyc3BlY3RpdmUobWF0cml4LnAsIE1hdGguUEkgKiB2YWwgLyAxODAuMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCwgY2FtZXJhLm5lYXIsIGNhbWVyYS5mYXIpO1xyXG4gICAgICAgIGNhbWVyYS5GT1YgPSB2YWw7XHJcbiAgICB9KTtcclxuICAgIGNhRm9sZGVyLmFkZChjYW1lcmEsIFwiZmx5XCIpO1xyXG4gICAgY2FGb2xkZXIub3BlbigpO1xyXG5cclxuXHJcblxyXG4gICAgLy8gbWF0cml4XHJcbiAgICBtYXRyaXgubSA9IGdsbS5tYXQ0LmNyZWF0ZSgpO1xyXG4gICAgbWF0cml4LnYgPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxuICAgIG1hdHJpeC5wID0gZ2xtLm1hdDQuY3JlYXRlKCk7XHJcblxyXG4gICAgXHJcblxyXG4gICAgY2FtZXJhSW5pdChtYXRyaXgudiwgNzApO1xyXG4gICAgXHJcbiAgICBjcmVhdGVTaGFkZXIoKTtcclxuXHJcbiAgICBza3lsaWdodEluaXQoZ2wsIGd1aSwgZ2xvYmFsKTtcclxuXHJcbiAgICBzaGFkb3dQcm9ncmFtU2V0dXAoKTtcclxuICAgIHNoYWRvd0ZyYW1lQnVmZmVyU2V0dXAoKTtcclxuICAgIHdhdGVyUHJvZ3JhbVNldHVwKCk7XHJcblxyXG4gICAgcG9zdFByb2Nlc3NpbmdTZXR1cCgpO1xyXG5cclxuICAgIC8vIGdsbS5tYXQ0LnBlcnNwZWN0aXZlKG1hdHJpeC5wLCBNYXRoLlBJICogMC41LCBnbC5kcmF3aW5nQnVmZmVyV2lkdGggLyBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0LCAwLjEsIDIwMDAwLjApO1xyXG4gICAgZ2xtLm1hdDQucGVyc3BlY3RpdmUobWF0cml4LnAsIE1hdGguUEkgKiBjYW1lcmEuRk9WIC8gMTgwLjAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCAvIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQsIGNhbWVyYS5uZWFyLCBjYW1lcmEuZmFyKTtcclxuXHJcbiAgICBpZiAoIVN0cmluZy5wcm90b3R5cGUuZ2V0RmlsZU5hbWUpIHtcclxuICAgICAgICBTdHJpbmcucHJvdG90eXBlLmdldEZpbGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBsZXQgZWxlbWVudCA9IHRoaXMuc3BsaXQoJy8nKTtcclxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRbZWxlbWVudC5sZW5ndGggLSAxXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHNreWJveEluaXQoZ2wpO1xyXG5cclxuICAgIC8vIGNvbnRyb2xcclxuICAgIGNvbnRyb2xJbml0KCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjc20oKSB7XHJcbiAgICB2YXIgdmlld19tYXRyaXhfaW52ID0gZ2xtLm1hdDQuY3JlYXRlKCk7XHJcbiAgICB2YXIgdmlld19tYXRyaXhfbGlnaHQgPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxuICAgIGdsbS5tYXQ0LmludmVydCh2aWV3X21hdHJpeF9pbnYsIG1hdHJpeC52KTtcclxuICAgIGdsbS5tYXQ0Lmxvb2tBdCh2aWV3X21hdHJpeF9saWdodCwgZ2xtLnZlYzMuc2NhbGUoc2t5bGlnaHQuZXllLCBza3lsaWdodC5leWUsIDEuMCksIHNreWxpZ2h0LnBvaW50TG9va2F0LCBza3lsaWdodC51cCk7XHJcbiAgICB2YXIgYXNwZWN0X3JhdGlvID0gZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gZ2wuZHJhd2luZ0J1ZmZlckhlaWdodDtcclxuICAgIHZhciB0YW5faGFsZl9oZm92ID0gTWF0aC50YW4oY2FtZXJhLkZPViAqIDAuNSAqIE1hdGguUEkgLyAxODAuMCAqIGFzcGVjdF9yYXRpbyk7XHJcbiAgICB2YXIgdGFuX2hhbGZfdmZvdiA9IE1hdGgudGFuKGNhbWVyYS5GT1YgKiAwLjUgKiBNYXRoLlBJIC8gMTgwLjApO1xyXG5cclxuICAgIGNzbV9yYW5nZVswXSA9IC1jYW1lcmEubmVhcjtcclxuICAgIGNzbV9yYW5nZVsxXSA9IC01MC4wO1xyXG4gICAgY3NtX3JhbmdlWzJdID0gLTIwMC4wO1xyXG4gICAgY3NtX3JhbmdlWzNdID0gLTIwMDAuMDtcclxuXHJcbiAgICB2YXIgdmlldyA9IGdsbS52ZWM0LmNyZWF0ZSgpO1xyXG4gICAgdmFyIGNsaXAgPSBnbG0udmVjNC5jcmVhdGUoKTtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtX2NzbTsgaSsrKSB7XHJcbiAgICAgICAgdmlldyA9IGdsbS52ZWM0LmZyb21WYWx1ZXMoMCwgMCwgY3NtX3JhbmdlW2krMV0sIDEpO1xyXG4gICAgICAgIGdsbS52ZWM0LnRyYW5zZm9ybU1hdDQoY2xpcCwgdmlldywgbWF0cml4LnApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNzbV9yYW5nZV9jW2ldID0gY2xpcFsyXSAvIGNhbWVyYS5mYXI7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHhuLCB4ZiwgeW4sIHlmO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1fY3NtOyBpKyspIHtcclxuICAgICAgICB4biA9IGNzbV9yYW5nZVtpXSAqIHRhbl9oYWxmX2hmb3Y7XHJcbiAgICAgICAgeGYgPSBjc21fcmFuZ2VbaSsxXSAqIHRhbl9oYWxmX2hmb3Y7XHJcbiAgICAgICAgeW4gPSBjc21fcmFuZ2VbaV0gKiB0YW5faGFsZl92Zm92O1xyXG4gICAgICAgIHlmID0gY3NtX3JhbmdlW2krMV0gKiB0YW5faGFsZl92Zm92O1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBmcnVzdHVtX2Nvcm5lcnMgPSBbXTtcclxuICAgICAgICBmcnVzdHVtX2Nvcm5lcnMubGVuZ3RoID0gODtcclxuXHJcbiAgICAgICAgZnJ1c3R1bV9jb3JuZXJzWzBdID0gZ2xtLnZlYzQuZnJvbVZhbHVlcyh4biwgeW4sIGNzbV9yYW5nZVtpXSwgMSk7XHJcbiAgICAgICAgZnJ1c3R1bV9jb3JuZXJzWzFdID0gZ2xtLnZlYzQuZnJvbVZhbHVlcygteG4sIHluLCBjc21fcmFuZ2VbaV0sIDEpO1xyXG4gICAgICAgIGZydXN0dW1fY29ybmVyc1syXSA9IGdsbS52ZWM0LmZyb21WYWx1ZXMoeG4sIC15biwgY3NtX3JhbmdlW2ldLCAxKTtcclxuICAgICAgICBmcnVzdHVtX2Nvcm5lcnNbM10gPSBnbG0udmVjNC5mcm9tVmFsdWVzKC14biwgLXluLCBjc21fcmFuZ2VbaV0sIDEpO1xyXG4gICAgICAgIGZydXN0dW1fY29ybmVyc1s0XSA9IGdsbS52ZWM0LmZyb21WYWx1ZXMoeGYsIHlmLCBjc21fcmFuZ2VbaSsxXSwgMSk7XHJcbiAgICAgICAgZnJ1c3R1bV9jb3JuZXJzWzVdID0gZ2xtLnZlYzQuZnJvbVZhbHVlcygteGYsIHlmLCBjc21fcmFuZ2VbaSsxXSwgMSk7XHJcbiAgICAgICAgZnJ1c3R1bV9jb3JuZXJzWzZdID0gZ2xtLnZlYzQuZnJvbVZhbHVlcyh4ZiwgLXlmLCBjc21fcmFuZ2VbaSsxXSwgMSk7XHJcbiAgICAgICAgZnJ1c3R1bV9jb3JuZXJzWzddID0gZ2xtLnZlYzQuZnJvbVZhbHVlcygteGYsIC15ZiwgY3NtX3JhbmdlW2krMV0sIDEpO1xyXG5cclxuICAgICAgICB2YXIgZnJ1c3R1bV9jb3JuZXJzX0wgPSBbXTtcclxuICAgICAgICBmcnVzdHVtX2Nvcm5lcnNfTC5sZW5ndGggPSA4O1xyXG5cclxuICAgICAgICB2YXIgbWluX3ggPSBOdW1iZXIuTUFYX1ZBTFVFO1xyXG4gICAgICAgIHZhciBtaW5feSA9IE51bWJlci5NQVhfVkFMVUU7XHJcbiAgICAgICAgdmFyIG1pbl96ID0gTnVtYmVyLk1BWF9WQUxVRTtcclxuICAgICAgICB2YXIgbWF4X3ggPSBOdW1iZXIuTUlOX1ZBTFVFO1xyXG4gICAgICAgIHZhciBtYXhfeSA9IE51bWJlci5NSU5fVkFMVUU7XHJcbiAgICAgICAgdmFyIG1heF96ID0gTnVtYmVyLk1JTl9WQUxVRTtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHtcclxuICAgICAgICAgICAgZnJ1c3R1bV9jb3JuZXJzX0xbal0gPSBnbG0udmVjNC5jcmVhdGUoKTtcclxuICAgICAgICAgICAgZ2xtLnZlYzQudHJhbnNmb3JtTWF0NCh2aWV3LCBmcnVzdHVtX2Nvcm5lcnNbal0sIHZpZXdfbWF0cml4X2ludik7XHJcbiAgICAgICAgICAgIGdsbS52ZWM0LnRyYW5zZm9ybU1hdDQoZnJ1c3R1bV9jb3JuZXJzX0xbal0sIHZpZXcsIHZpZXdfbWF0cml4X2xpZ2h0KTtcclxuXHJcbiAgICAgICAgICAgIG1pbl94ID0gTWF0aC5taW4obWluX3gsIGZydXN0dW1fY29ybmVyc19MW2pdWzBdKTtcclxuICAgICAgICAgICAgbWF4X3ggPSBNYXRoLm1heChtYXhfeCwgZnJ1c3R1bV9jb3JuZXJzX0xbal1bMF0pO1xyXG5cclxuICAgICAgICAgICAgbWluX3kgPSBNYXRoLm1pbihtaW5feSwgZnJ1c3R1bV9jb3JuZXJzX0xbal1bMV0pO1xyXG4gICAgICAgICAgICBtYXhfeSA9IE1hdGgubWF4KG1heF95LCBmcnVzdHVtX2Nvcm5lcnNfTFtqXVsxXSk7XHJcblxyXG4gICAgICAgICAgICBtaW5feiA9IE1hdGgubWluKG1pbl96LCBmcnVzdHVtX2Nvcm5lcnNfTFtqXVsyXSk7XHJcbiAgICAgICAgICAgIG1heF96ID0gTWF0aC5tYXgobWF4X3osIGZydXN0dW1fY29ybmVyc19MW2pdWzJdKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxpZ2h0X21hdHJpY2VzW2ldID0gZ2xtLm1hdDQuY3JlYXRlKCk7XHJcbiAgICAgICAgZ2xtLm1hdDQub3J0aG8obGlnaHRfbWF0cmljZXNbaV0sIG1pbl94LCBtYXhfeCwgbWluX3ksIG1heF95LCAtbWF4X3osIC1taW5feik7XHJcbiAgICAgICAgZ2xtLm1hdDQubXVsdGlwbHkobGlnaHRfbWF0cmljZXNbaV0sIGxpZ2h0X21hdHJpY2VzW2ldLCB2aWV3X21hdHJpeF9saWdodCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNoYWRvd1Byb2dyYW1TZXR1cCgpIHtcclxuXHJcbiAgICBzaGFkb3dNYXAucHJvZ3JhbSA9IHNoYWRlcklkVG9Qcm9ncmFtKFwiZGVwdGgtdnNcIiwgXCJkZXB0aC1mc1wiKTtcclxuXHJcbiAgICAvLyB1bmlmb3JtIGxvY2F0aW9uXHJcbiAgICBzaGFkb3dNYXAubXZwTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oc2hhZG93TWFwLnByb2dyYW0sICdtdnAnKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2hhZG93RnJhbWVCdWZmZXJTZXR1cCgpIHtcclxuICAgIHNoYWRvd01hcC5zaXplID0gODE5NjtcclxuXHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDM7IGkrKykge1xyXG4gICAgICAgIHZhciBmcmFtZSA9IHtcclxuICAgICAgICAgICAgZmJvOiBudWxsLFxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihmcmFtZXNbaV0gPT0gbnVsbCl7XHJcbiAgICAgICAgICAgIGZyYW1lLmZibyA9IGdsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7XHJcbiAgICAgICAgICAgIGZyYW1lcy5wdXNoKGZyYW1lKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgZnJhbWUgPSBmcmFtZXNbaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZnJhbWUuZmJvKTtcclxuXHJcbiAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7XHJcblxyXG4gICAgICAgIHNoYWRvd01hcC5kZXB0aFRleFtpXSA9IGdsLmNyZWF0ZVRleHR1cmUoKTtcclxuICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBzaGFkb3dNYXAuZGVwdGhUZXhbaV0pO1xyXG4gICAgICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuREVQVEhfQ09NUE9ORU5UMzJGLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGggKiA0LCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0ICogNCwgMCwgZ2wuREVQVEhfQ09NUE9ORU5ULCBnbC5GTE9BVCwgbnVsbCk7XHJcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLkxJTkVBUik7XHJcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLkxJTkVBUik7XHJcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVBfVE9fRURHRSk7XHJcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQ0xBTVBfVE9fRURHRSk7XHJcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX0NPTVBBUkVfTU9ERSwgZ2wuQ09NUEFSRV9SRUZfVE9fVEVYVFVSRSk7XHJcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX0NPTVBBUkVfRlVOQywgZ2wuTEVRVUFMKTtcclxuICAgICAgICBnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZFUiwgZ2wuREVQVEhfQVRUQUNITUVOVCwgZ2wuVEVYVFVSRV8yRCwgc2hhZG93TWFwLmRlcHRoVGV4W2ldLCAwKTtcclxuXHJcbiAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBudWxsKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gd2F0ZXJQcm9ncmFtU2V0dXAoKSB7XHJcbiAgICB3YXRlci5wcm9ncmFtID0gc2hhZGVySWRUb1Byb2dyYW0oXCJ3YXRlcl92c1wiLCBcIndhdGVyX2ZzXCIpO1xyXG4gICAgXHJcbiAgICAvLyB1bmlmb3JtIGxvY2F0aW9uXHJcbiAgICB3YXRlci5tdnAgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24od2F0ZXIucHJvZ3JhbSwgJ3VNVlAnKTtcclxuICAgIHdhdGVyLmNvID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHdhdGVyLnByb2dyYW0sICd1Q08nKTtcclxuICAgIHdhdGVyLm5tID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHdhdGVyLnByb2dyYW0sICd1Tk0nKTtcclxuICAgIHdhdGVyLm0gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24od2F0ZXIucHJvZ3JhbSwgJ3VNJyk7XHJcbiAgICB3YXRlci5leWUgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24od2F0ZXIucHJvZ3JhbSwgJ3VFeWUnKTtcclxuICAgIHdhdGVyLmxpZ2h0ID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHdhdGVyLnByb2dyYW0sICd1TGlnaHQnKTtcclxuICAgIHdhdGVyLnRleE9mZnNldCA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbih3YXRlci5wcm9ncmFtLCAnb2Zmc2V0Jyk7XHJcbiAgICBcclxuICAgIGdsLnVzZVByb2dyYW0od2F0ZXIucHJvZ3JhbSk7XHJcbiAgICBnbC51bmlmb3JtMWkod2F0ZXIuY28sIDApO1xyXG4gICAgZ2wudW5pZm9ybTFpKHdhdGVyLm5tLCAxKTtcclxuICAgIGdsLnVuaWZvcm0xZih3YXRlci50ZXhPZmZzZXQsIDApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwb3N0UHJvY2Vzc2luZ1NldHVwKCkge1xyXG4gICAgLy9wcm9ncmFtXHJcbiAgICBwb3N0UHJvY2Vzc2luZy5wcm9ncmFtID0gc2hhZGVySWRUb1Byb2dyYW0oXCJwb3N0UHJvY2Vzc2luZy12c1wiLCBcInBvc3RQcm9jZXNzaW5nLWZzXCIpO1xyXG5cclxuICAgIGxldCB2ID0gW1xyXG4gICAgICAgIDEuMCwgLTEuMCwgMC4wLFxyXG4gICAgICAgIC0xLjAsIC0xLjAsIDAuMCxcclxuICAgICAgICAtMS4wLCAxLjAsIDAuMCxcclxuICAgICAgICAxLjAsIC0xLjAsIDAuMCxcclxuICAgICAgICAtMS4wLCAxLjAsIDAuMCxcclxuICAgICAgICAxLjAsIDEuMCwgMC4wXHJcbiAgICBdXHJcbiAgICBsZXQgdnQgPSBbXHJcbiAgICAgICAgMS4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAxLjAsXHJcbiAgICAgICAgMS4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCAxLjAsXHJcbiAgICAgICAgMS4wLCAxLjBcclxuICAgIF1cclxuICAgIGxldCBpZHggPSBbXHJcbiAgICAgICAgMCwgMSwgMiwgMywgNCwgNVxyXG4gICAgXVxyXG4gICAgbGV0IHdpbmRvd19wb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KHYpO1xyXG4gICAgbGV0IHRleHR1cmVfY29vcmQgPSBuZXcgRmxvYXQzMkFycmF5KHZ0KTtcclxuXHJcbiAgICBwb3N0UHJvY2Vzc2luZy52YW8gPSBnbC5jcmVhdGVWZXJ0ZXhBcnJheSgpO1xyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KHBvc3RQcm9jZXNzaW5nLnZhbyk7XHJcblxyXG4gICAgbGV0IHdpbmRvd19idWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB3aW5kb3dfYnVmZmVyKTtcclxuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB3aW5kb3dfcG9zaXRpb25zLmJ5dGVMZW5ndGggKyB0ZXh0dXJlX2Nvb3JkLmJ5dGVMZW5ndGgsIGdsLlNUQVRJQ19EUkFXKTtcclxuICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuQVJSQVlfQlVGRkVSLCAwLCB3aW5kb3dfcG9zaXRpb25zKTtcclxuICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB3aW5kb3dfcG9zaXRpb25zLmJ5dGVMZW5ndGgsIHRleHR1cmVfY29vcmQpO1xyXG5cclxuICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoMCwgMywgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcclxuICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KDApO1xyXG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcigxLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDAsIHdpbmRvd19wb3NpdGlvbnMuYnl0ZUxlbmd0aCk7XHJcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSgxKTtcclxuXHJcbiAgICBsZXQgaW5kaWNlcyA9IG5ldyBVaW50MzJBcnJheShpZHgpO1xyXG4gICAgbGV0IGVibyA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgZWJvKTtcclxuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGluZGljZXMsIGdsLlNUQVRJQ19EUkFXKTtcclxuXHJcbiAgICB2Lmxlbmd0aCA9IDA7XHJcbiAgICBpZHgubGVuZ3RoID0gMDtcclxuXHJcbiAgICBwb3N0UHJvY2Vzc2luZy5tYWluVGV4TG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocG9zdFByb2Nlc3NpbmcucHJvZ3JhbSwgXCJ1Q29sb3JCdWZmZXJcIik7XHJcbiAgICBwb3N0UHJvY2Vzc2luZy5kZXB0aFRleExvY2F0aW9uID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHBvc3RQcm9jZXNzaW5nLnByb2dyYW0sIFwidURlcHRoQnVmZmVyXCIpO1xyXG4gICAgcG9zdFByb2Nlc3NpbmcuZnhhYU9uTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocG9zdFByb2Nlc3NpbmcucHJvZ3JhbSwgXCJmeGFhT25cIik7XHJcbiAgICBwb3N0UHJvY2Vzc2luZy52aWduZXR0ZUxvY2F0aW9uID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHBvc3RQcm9jZXNzaW5nLnByb2dyYW0sIFwidmlnbmV0dGVPblwiKTtcclxuICAgIHBvc3RQcm9jZXNzaW5nLnJlc29sdXRpb25Mb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwb3N0UHJvY2Vzc2luZy5wcm9ncmFtLCBcInJlc29sdXRpb25cIik7XHJcbiAgICBcclxuICAgIGdsLnVzZVByb2dyYW0ocG9zdFByb2Nlc3NpbmcucHJvZ3JhbSk7XHJcbiAgICBnbC51bmlmb3JtMWkocG9zdFByb2Nlc3NpbmcudmlnbmV0dGVMb2NhdGlvbiwgMSk7XHJcblxyXG4gICAgLy9mYm9cclxuICAgIHBvc3RQcm9jZXNzaW5nLmZibyA9IGdsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7XHJcbiAgICBcclxuICAgIGluaXRQb3N0UHJvY2Vzc2luZ1RleHR1cmUoKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNoYWRlcigpIHtcclxuXHJcbiAgICBnbG9iYWwucHJvZ3JhbSA9IHNoYWRlcklkVG9Qcm9ncmFtKCd2ZXJ0ZXgnLCAnZnJhZ21lbnQnKTtcclxuXHJcbiAgICAvLyB1bmlmb3JtIGxvY2F0aW9uXHJcbiAgICB1bmlmb3JtLm12cCA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihnbG9iYWwucHJvZ3JhbSwgJ3VNVlAnKTtcclxuICAgIHVuaWZvcm0uY28gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sICd1Q08nKTtcclxuICAgIHVuaWZvcm0ubm0gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sICd1Tk0nKTtcclxuICAgIHVuaWZvcm0ubSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihnbG9iYWwucHJvZ3JhbSwgJ3VNJyk7XHJcbiAgICB1bmlmb3JtLmV5ZSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihnbG9iYWwucHJvZ3JhbSwgJ3VFeWUnKTtcclxuICAgIHVuaWZvcm0ubGlnaHQgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sICd1TGlnaHQnKTtcclxuICAgIHVuaWZvcm0udXNlID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsb2JhbC5wcm9ncmFtLCAndVVzZScpO1xyXG4gICAgdW5pZm9ybS51c2VBTyA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihnbG9iYWwucHJvZ3JhbSwgJ3VVc2VBTycpO1xyXG4gICAgdW5pZm9ybS51c2VTaGFkb3cgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sICd1VXNlU2hhZG93Jyk7XHJcbiAgICB1bmlmb3JtLnNoYWRvd0NvbG9yID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsb2JhbC5wcm9ncmFtLCBcInNoYWRvd0NvbG9yXCIpO1xyXG5cclxuICAgIHVuaWZvcm0uZGVwdGhCdWZmZXJMb2NhdGlvblswXSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihnbG9iYWwucHJvZ3JhbSwgXCJ1RGVwdGhCdWZmZXJbMF1cIik7XHJcbiAgICB1bmlmb3JtLmRlcHRoQnVmZmVyTG9jYXRpb25bMV0gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sIFwidURlcHRoQnVmZmVyWzFdXCIpO1xyXG4gICAgdW5pZm9ybS5kZXB0aEJ1ZmZlckxvY2F0aW9uWzJdID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsb2JhbC5wcm9ncmFtLCBcInVEZXB0aEJ1ZmZlclsyXVwiKTtcclxuXHJcbiAgICB1bmlmb3JtLnVMWzBdID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsb2JhbC5wcm9ncmFtLCBcInVMWzBdXCIpO1xyXG4gICAgdW5pZm9ybS51TFsxXSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihnbG9iYWwucHJvZ3JhbSwgXCJ1TFsxXVwiKTtcclxuICAgIHVuaWZvcm0udUxbMl0gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sIFwidUxbMl1cIik7XHJcblxyXG4gICAgdW5pZm9ybS5zaGFkb3dNVlBMb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihnbG9iYWwucHJvZ3JhbSwgXCJ1U2hhZG93TVZQXCIpO1xyXG4gICAgdW5pZm9ybS5iaWFzTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sICdiaWFzJyk7XHJcblxyXG4gICAgdW5pZm9ybS5jc21SYW5nZVswXSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihnbG9iYWwucHJvZ3JhbSwgXCJ1Q3NtUmFuZ2VbMF1cIik7XHJcbiAgICB1bmlmb3JtLmNzbVJhbmdlWzFdID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsb2JhbC5wcm9ncmFtLCBcInVDc21SYW5nZVsxXVwiKTtcclxuICAgIHVuaWZvcm0uY3NtUmFuZ2VbMl0gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oZ2xvYmFsLnByb2dyYW0sIFwidUNzbVJhbmdlWzJdXCIpO1xyXG5cclxuXHJcbiAgICBnbC51c2VQcm9ncmFtKGdsb2JhbC5wcm9ncmFtKTtcclxuICAgIGdsLnVuaWZvcm0xaSh1bmlmb3JtLmNvLCAwKTtcclxuICAgIGdsLnVuaWZvcm0xaSh1bmlmb3JtLm5tLCAxKTtcclxuICAgIGdsLnVuaWZvcm0zZnYodW5pZm9ybS5leWUsIGNhbWVyYS5leWUpO1xyXG4gICAgZ2wudW5pZm9ybTFpKHVuaWZvcm0udXNlLCBVSS5Ob3JtYWxfTWFwcGluZyk7XHJcbiAgICBnbC51bmlmb3JtMWkodW5pZm9ybS51c2VBTywgVUkuVXNlX0FPKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNoYWRlcklkVG9Qcm9ncmFtKHZzSWQsIGZzSWQpIHtcclxuICAgIC8vIGdldCBzaGFkZXIgc3RyaW5nXHJcbiAgICBsZXQgdnNTcmMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh2c0lkKS5pbm5lclRleHQudHJpbSgpO1xyXG4gICAgbGV0IGZzU3JjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZnNJZCkuaW5uZXJUZXh0LnRyaW0oKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgdmVydGV4IHNoYWRlclxyXG4gICAgbGV0IHZzID0gZ2wuY3JlYXRlU2hhZGVyKGdsLlZFUlRFWF9TSEFERVIpO1xyXG4gICAgZ2wuc2hhZGVyU291cmNlKHZzLCB2c1NyYyk7XHJcbiAgICBnbC5jb21waWxlU2hhZGVyKHZzKTtcclxuXHJcbiAgICBpZiAoIWdsLmdldFNoYWRlclBhcmFtZXRlcih2cywgZ2wuQ09NUElMRV9TVEFUVVMpKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihnbC5nZXRTaGFkZXJJbmZvTG9nKHZzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gY3JlYXRlIGZyYWdtZW50IHNoYWRlclxyXG4gICAgbGV0IGZzID0gZ2wuY3JlYXRlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUik7XHJcbiAgICBnbC5zaGFkZXJTb3VyY2UoZnMsIGZzU3JjKTtcclxuICAgIGdsLmNvbXBpbGVTaGFkZXIoZnMpO1xyXG5cclxuICAgIGlmICghZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKGZzLCBnbC5DT01QSUxFX1NUQVRVUykpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGdsLmdldFNoYWRlckluZm9Mb2coZnMpKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBjcmVhdGUgc2hhZGVyIHByb2dyYW1cclxuICAgIGxldCByZXRQcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpO1xyXG4gICAgZ2wuYXR0YWNoU2hhZGVyKHJldFByb2dyYW0sIHZzKTtcclxuICAgIGdsLmF0dGFjaFNoYWRlcihyZXRQcm9ncmFtLCBmcyk7XHJcbiAgICBnbC5saW5rUHJvZ3JhbShyZXRQcm9ncmFtKTtcclxuXHJcbiAgICBpZiAoIWdsLmdldFByb2dyYW1QYXJhbWV0ZXIocmV0UHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMpKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihnbC5nZXRQcm9ncmFtSW5mb0xvZyhyZXRQcm9ncmFtKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJldFByb2dyYW07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9sb2FkRmlsZSh1cmwpIHtcclxuICAgIGxldCBmciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGxldCByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgICAgICByZXEub3BlbignR0VUJywgdXJsLCB0cnVlKTtcclxuICAgICAgICByZXEucmVzcG9uc2VUeXBlID0gJ2Jsb2InO1xyXG4gICAgICAgIHJlcS5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGZyLnJlYWRBc1RleHQocmVxLnJlc3BvbnNlKTtcclxuICAgICAgICAgICAgZnIub25sb2FkID0gKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBmID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgbGV0IGxzID0gZi5zcGxpdCgvXFxyP1xcbi8pO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShscyk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlcS5vbmVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBmaWxlJ3MgdXJsOiAke3VybH1gKSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXEuc2VuZCgpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGxvYWRPYmoodXJsKSB7XHJcbiAgICAvLyByZWFkIGZpbGVcclxuICAgIGxldCBsaW5lcyA9IGF3YWl0IF9sb2FkRmlsZSh1cmwpO1xyXG5cclxuICAgIC8vIHBhcnNlIG9iaiBmb3JtYXRcclxuICAgIGxldCB2ID0gW107XHJcbiAgICBsZXQgdnQgPSBbXTtcclxuICAgIGxldCB2biA9IFtdO1xyXG4gICAgbGV0IGlkeCA9IFtdO1xyXG5cclxuICAgIGZvciAobGV0IGxpbmUgb2YgbGluZXMpIHtcclxuICAgICAgICBsaW5lID0gbGluZS5zcGxpdCgnICcpO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGxpbmUpO1xyXG4gICAgICAgIGlmIChsaW5lWzBdID09ICd2Jykge1xyXG4gICAgICAgICAgICB2LnB1c2gocGFyc2VGbG9hdChsaW5lWzFdKSk7XHJcbiAgICAgICAgICAgIHYucHVzaChwYXJzZUZsb2F0KGxpbmVbMl0pKTtcclxuICAgICAgICAgICAgdi5wdXNoKHBhcnNlRmxvYXQobGluZVszXSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChsaW5lWzBdID09ICd2bicpIHtcclxuICAgICAgICAgICAgdm4ucHVzaChwYXJzZUZsb2F0KGxpbmVbMV0pKTtcclxuICAgICAgICAgICAgdm4ucHVzaChwYXJzZUZsb2F0KGxpbmVbMl0pKTtcclxuICAgICAgICAgICAgdm4ucHVzaChwYXJzZUZsb2F0KGxpbmVbM10pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAobGluZVswXSA9PSAndnQnKSB7XHJcbiAgICAgICAgICAgIHZ0LnB1c2gocGFyc2VGbG9hdChsaW5lWzFdKSk7XHJcbiAgICAgICAgICAgIC8vIGZsaXAgdmVydGljYWxseVxyXG4gICAgICAgICAgICB2dC5wdXNoKDEuMCAtIHBhcnNlRmxvYXQobGluZVsyXSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChsaW5lWzBdID09ICdmJykge1xyXG4gICAgICAgICAgICAvLyBzdGFydCBmcm9tIHplcm9cclxuICAgICAgICAgICAgaWR4LnB1c2gocGFyc2VJbnQobGluZVsxXS5zcGxpdCgnLycpWzBdKSAtIDEpO1xyXG4gICAgICAgICAgICBpZHgucHVzaChwYXJzZUludChsaW5lWzJdLnNwbGl0KCcvJylbMF0pIC0gMSk7XHJcbiAgICAgICAgICAgIGlkeC5wdXNoKHBhcnNlSW50KGxpbmVbM10uc3BsaXQoJy8nKVswXSkgLSAxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gY29tcHV0ZSB0YW5nZW50XHJcbiAgICBsZXQgdG4gPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWR4Lmxlbmd0aDsgaSArPSAzKSB7XHJcbiAgICAgICAgbGV0IGlkeDEgPSBpZHhbaV07XHJcbiAgICAgICAgbGV0IGlkeDIgPSBpZHhbaSArIDFdO1xyXG4gICAgICAgIGxldCBpZHgzID0gaWR4W2kgKyAyXTtcclxuXHJcbiAgICAgICAgbGV0IHAxID0gZ2xtLnZlYzMuZnJvbVZhbHVlcyh2W2lkeDEgKiAzICsgMF0sIHZbaWR4MSAqIDMgKyAxXSwgdltpZHgxICogMyArIDJdKTtcclxuICAgICAgICBsZXQgcDIgPSBnbG0udmVjMy5mcm9tVmFsdWVzKHZbaWR4MiAqIDMgKyAwXSwgdltpZHgyICogMyArIDFdLCB2W2lkeDIgKiAzICsgMl0pO1xyXG4gICAgICAgIGxldCBwMyA9IGdsbS52ZWMzLmZyb21WYWx1ZXModltpZHgzICogMyArIDBdLCB2W2lkeDMgKiAzICsgMV0sIHZbaWR4MyAqIDMgKyAyXSk7XHJcblxyXG4gICAgICAgIGxldCBuMSA9IGdsbS52ZWMzLmZyb21WYWx1ZXModm5baWR4MSAqIDMgKyAwXSwgdm5baWR4MSAqIDMgKyAxXSwgdm5baWR4MSAqIDMgKyAyXSk7XHJcbiAgICAgICAgbGV0IG4yID0gZ2xtLnZlYzMuZnJvbVZhbHVlcyh2bltpZHgyICogMyArIDBdLCB2bltpZHgyICogMyArIDFdLCB2bltpZHgyICogMyArIDJdKTtcclxuICAgICAgICBsZXQgbjMgPSBnbG0udmVjMy5mcm9tVmFsdWVzKHZuW2lkeDMgKiAzICsgMF0sIHZuW2lkeDMgKiAzICsgMV0sIHZuW2lkeDMgKiAzICsgMl0pO1xyXG5cclxuICAgICAgICBsZXQgdXYxID0gZ2xtLnZlYzIuZnJvbVZhbHVlcyh2dFtpZHgxICogMiArIDBdLCB2dFtpZHgxICogMiArIDFdKTtcclxuICAgICAgICBsZXQgdXYyID0gZ2xtLnZlYzIuZnJvbVZhbHVlcyh2dFtpZHgyICogMiArIDBdLCB2dFtpZHgyICogMiArIDFdKTtcclxuICAgICAgICBsZXQgdXYzID0gZ2xtLnZlYzIuZnJvbVZhbHVlcyh2dFtpZHgzICogMiArIDBdLCB2dFtpZHgzICogMiArIDFdKTtcclxuXHJcbiAgICAgICAgbGV0IGRwMSA9IGdsbS52ZWMzLmNyZWF0ZSgpOyBnbG0udmVjMy5zdWIoZHAxLCBwMiwgcDEpO1xyXG4gICAgICAgIGxldCBkcDIgPSBnbG0udmVjMy5jcmVhdGUoKTsgZ2xtLnZlYzMuc3ViKGRwMiwgcDMsIHAxKTtcclxuXHJcbiAgICAgICAgbGV0IGR1djEgPSBnbG0udmVjMi5jcmVhdGUoKTsgZ2xtLnZlYzIuc3ViKGR1djEsIHV2MiwgdXYxKTtcclxuICAgICAgICBsZXQgZHV2MiA9IGdsbS52ZWMyLmNyZWF0ZSgpOyBnbG0udmVjMi5zdWIoZHV2MiwgdXYzLCB1djEpO1xyXG5cclxuICAgICAgICBsZXQgciA9IDEuMCAvIChkdXYxWzBdICogZHV2MlsxXSAtIGR1djFbMV0gKiBkdXYyWzBdKTtcclxuXHJcbiAgICAgICAgbGV0IHQgPSBnbG0udmVjMy5mcm9tVmFsdWVzKFxyXG4gICAgICAgICAgICAoZHAxWzBdICogZHV2MlsxXSAtIGRwMlswXSAqIGR1djFbMV0pICogcixcclxuICAgICAgICAgICAgKGRwMVsxXSAqIGR1djJbMV0gLSBkcDJbMV0gKiBkdXYxWzFdKSAqIHIsXHJcbiAgICAgICAgICAgIChkcDFbMl0gKiBkdXYyWzFdIC0gZHAyWzJdICogZHV2MVsxXSkgKiByXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgbGV0IHQxID0gZ2xtLnZlYzMuY3JlYXRlKCk7IGdsbS52ZWMzLmNyb3NzKHQxLCBuMSwgdCk7XHJcbiAgICAgICAgbGV0IHQyID0gZ2xtLnZlYzMuY3JlYXRlKCk7IGdsbS52ZWMzLmNyb3NzKHQyLCBuMiwgdCk7XHJcbiAgICAgICAgbGV0IHQzID0gZ2xtLnZlYzMuY3JlYXRlKCk7IGdsbS52ZWMzLmNyb3NzKHQzLCBuMywgdCk7XHJcblxyXG4gICAgICAgIHRuW2lkeDEgKiAzICsgMF0gPSB0MVswXTtcclxuICAgICAgICB0bltpZHgxICogMyArIDFdID0gdDFbMV07XHJcbiAgICAgICAgdG5baWR4MSAqIDMgKyAyXSA9IHQxWzJdO1xyXG5cclxuICAgICAgICB0bltpZHgyICogMyArIDBdID0gdDJbMF07XHJcbiAgICAgICAgdG5baWR4MiAqIDMgKyAxXSA9IHQyWzFdO1xyXG4gICAgICAgIHRuW2lkeDIgKiAzICsgMl0gPSB0MlsyXTtcclxuXHJcbiAgICAgICAgdG5baWR4MyAqIDMgKyAwXSA9IHQzWzBdO1xyXG4gICAgICAgIHRuW2lkeDMgKiAzICsgMV0gPSB0M1sxXTtcclxuICAgICAgICB0bltpZHgzICogMyArIDJdID0gdDNbMl07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gc3RhdHNcclxuICAgIGNvbnNvbGUubG9nKGBMb2FkICR7dXJsfTogJHt2Lmxlbmd0aH0gdmVydGljZXMsICR7dnQubGVuZ3RofSB0ZXhjb29yZHMsICR7dm4ubGVuZ3RofSBub3JtYWxzIGAgK1xyXG4gICAgICAgIGAke3RuLmxlbmd0aH0gdGFuZ2VudHMgJHtpZHgubGVuZ3RoIC8gM30gZmFjZXNgKTtcclxuXHJcbiAgICAvLyB2YW9cclxuICAgIG1vZGVsLnZhbyA9IGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7XHJcbiAgICBnbC5iaW5kVmVydGV4QXJyYXkobW9kZWwudmFvKTtcclxuXHJcbiAgICAvLyB2Ym9cclxuICAgIGxldCBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KHYpO1xyXG4gICAgbGV0IG5vcm1hbHMgPSBuZXcgRmxvYXQzMkFycmF5KHZuKTtcclxuICAgIGxldCB0ZXhjb29yZHMgPSBuZXcgRmxvYXQzMkFycmF5KHZ0KTtcclxuICAgIGxldCB0YW5nZW50cyA9IG5ldyBGbG9hdDMyQXJyYXkodG4pO1xyXG5cclxuICAgIGxldCB2Ym8gPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2Ym8pO1xyXG4gICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIHBvc2l0aW9ucy5ieXRlTGVuZ3RoICsgbm9ybWFscy5ieXRlTGVuZ3RoICsgdGV4Y29vcmRzLmJ5dGVMZW5ndGggKyB0YW5nZW50cy5ieXRlTGVuZ3RoLCBnbC5TVEFUSUNfRFJBVyk7XHJcbiAgICBnbC5idWZmZXJTdWJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgMCwgcG9zaXRpb25zKTtcclxuICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBwb3NpdGlvbnMuYnl0ZUxlbmd0aCwgbm9ybWFscyk7XHJcbiAgICBnbC5idWZmZXJTdWJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgcG9zaXRpb25zLmJ5dGVMZW5ndGggKyBub3JtYWxzLmJ5dGVMZW5ndGgsIHRleGNvb3Jkcyk7XHJcbiAgICBnbC5idWZmZXJTdWJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgcG9zaXRpb25zLmJ5dGVMZW5ndGggKyBub3JtYWxzLmJ5dGVMZW5ndGggKyB0ZXhjb29yZHMuYnl0ZUxlbmd0aCwgdGFuZ2VudHMpO1xyXG5cclxuICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoMCwgMywgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcclxuICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KDApO1xyXG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcigxLCAzLCBnbC5GTE9BVCwgZmFsc2UsIDAsIHBvc2l0aW9ucy5ieXRlTGVuZ3RoKTtcclxuICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KDEpO1xyXG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcigyLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDAsIHBvc2l0aW9ucy5ieXRlTGVuZ3RoICsgbm9ybWFscy5ieXRlTGVuZ3RoKTtcclxuICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KDIpO1xyXG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcigzLCAzLCBnbC5GTE9BVCwgZmFsc2UsIDAsIHBvc2l0aW9ucy5ieXRlTGVuZ3RoICsgbm9ybWFscy5ieXRlTGVuZ3RoICsgdGV4Y29vcmRzLmJ5dGVMZW5ndGgpO1xyXG4gICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoMyk7XHJcblxyXG4gICAgLy8gZWJvXHJcbiAgICBsZXQgaW5kaWNlcyA9IG5ldyBVaW50MzJBcnJheShpZHgpO1xyXG4gICAgbGV0IGVibyA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgZWJvKTtcclxuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGluZGljZXMsIGdsLlNUQVRJQ19EUkFXKTtcclxuICAgIG1vZGVsLmN0ciA9IGlkeC5sZW5ndGg7XHJcblxyXG4gICAgLy8gZnJlZSBhcnJheVxyXG4gICAgdi5sZW5ndGggPSAwO1xyXG4gICAgdnQubGVuZ3RoID0gMDtcclxuICAgIHZuLmxlbmd0aCA9IDA7XHJcbiAgICBpZHgubGVuZ3RoID0gMDtcclxuICAgIHRuLmxlbmd0aCA9IDA7XHJcblxyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KG51bGwpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxvYWRJbWFnZSh1cmwpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaW1nKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGltZy5vbmVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZSdzIHVybDogJHt1cmx9YCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbWcuc3JjID0gdXJsO1xyXG4gICAgICAgIGltZy5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGxvYWRUZXJyYWluKCkge1xyXG4gICAgdGVycmFpbi52YW8gPSBnbC5jcmVhdGVWZXJ0ZXhBcnJheSgpO1xyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KHRlcnJhaW4udmFvKTtcclxuICAgIGdlbmVyYXRlVGVycmFpbigpO1xyXG5cclxuICAgIGxldCB2ID0gdGVycmFpbk9iai52O1xyXG4gICAgbGV0IHZuID0gdGVycmFpbk9iai52bjtcclxuICAgIGxldCB2dCA9IHRlcnJhaW5PYmoudnQ7XHJcbiAgICBsZXQgaWR4ID0gdGVycmFpbk9iai5pZHg7XHJcbiAgICBsZXQgdmMgPSB0ZXJyYWluT2JqLnZjO1xyXG5cclxuICAgIC8vIGNvbXB1dGUgdGFuZ2VudFxyXG4gICAgbGV0IHRuID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlkeC5sZW5ndGg7IGkgKz0gMykge1xyXG4gICAgICAgIGxldCBpZHgxID0gaWR4W2ldO1xyXG4gICAgICAgIGxldCBpZHgyID0gaWR4W2kgKyAxXTtcclxuICAgICAgICBsZXQgaWR4MyA9IGlkeFtpICsgMl07XHJcblxyXG4gICAgICAgIGxldCBwMSA9IGdsbS52ZWMzLmZyb21WYWx1ZXModltpZHgxICogMyArIDBdLCB2W2lkeDEgKiAzICsgMV0sIHZbaWR4MSAqIDMgKyAyXSk7XHJcbiAgICAgICAgbGV0IHAyID0gZ2xtLnZlYzMuZnJvbVZhbHVlcyh2W2lkeDIgKiAzICsgMF0sIHZbaWR4MiAqIDMgKyAxXSwgdltpZHgyICogMyArIDJdKTtcclxuICAgICAgICBsZXQgcDMgPSBnbG0udmVjMy5mcm9tVmFsdWVzKHZbaWR4MyAqIDMgKyAwXSwgdltpZHgzICogMyArIDFdLCB2W2lkeDMgKiAzICsgMl0pO1xyXG5cclxuICAgICAgICBsZXQgbjEgPSBnbG0udmVjMy5mcm9tVmFsdWVzKHZuW2lkeDEgKiAzICsgMF0sIHZuW2lkeDEgKiAzICsgMV0sIHZuW2lkeDEgKiAzICsgMl0pO1xyXG4gICAgICAgIGxldCBuMiA9IGdsbS52ZWMzLmZyb21WYWx1ZXModm5baWR4MiAqIDMgKyAwXSwgdm5baWR4MiAqIDMgKyAxXSwgdm5baWR4MiAqIDMgKyAyXSk7XHJcbiAgICAgICAgbGV0IG4zID0gZ2xtLnZlYzMuZnJvbVZhbHVlcyh2bltpZHgzICogMyArIDBdLCB2bltpZHgzICogMyArIDFdLCB2bltpZHgzICogMyArIDJdKTtcclxuXHJcbiAgICAgICAgbGV0IHV2MSA9IGdsbS52ZWMyLmZyb21WYWx1ZXModnRbaWR4MSAqIDIgKyAwXSwgdnRbaWR4MSAqIDIgKyAxXSk7XHJcbiAgICAgICAgbGV0IHV2MiA9IGdsbS52ZWMyLmZyb21WYWx1ZXModnRbaWR4MiAqIDIgKyAwXSwgdnRbaWR4MiAqIDIgKyAxXSk7XHJcbiAgICAgICAgbGV0IHV2MyA9IGdsbS52ZWMyLmZyb21WYWx1ZXModnRbaWR4MyAqIDIgKyAwXSwgdnRbaWR4MyAqIDIgKyAxXSk7XHJcblxyXG4gICAgICAgIGxldCBkcDEgPSBnbG0udmVjMy5jcmVhdGUoKTsgZ2xtLnZlYzMuc3ViKGRwMSwgcDIsIHAxKTtcclxuICAgICAgICBsZXQgZHAyID0gZ2xtLnZlYzMuY3JlYXRlKCk7IGdsbS52ZWMzLnN1YihkcDIsIHAzLCBwMSk7XHJcblxyXG4gICAgICAgIGxldCBkdXYxID0gZ2xtLnZlYzIuY3JlYXRlKCk7IGdsbS52ZWMyLnN1YihkdXYxLCB1djIsIHV2MSk7XHJcbiAgICAgICAgbGV0IGR1djIgPSBnbG0udmVjMi5jcmVhdGUoKTsgZ2xtLnZlYzIuc3ViKGR1djIsIHV2MywgdXYxKTtcclxuXHJcbiAgICAgICAgbGV0IHIgPSAxLjAgLyAoZHV2MVswXSAqIGR1djJbMV0gLSBkdXYxWzFdICogZHV2MlswXSk7XHJcblxyXG4gICAgICAgIGxldCB0ID0gZ2xtLnZlYzMuZnJvbVZhbHVlcyhcclxuICAgICAgICAgICAgKGRwMVswXSAqIGR1djJbMV0gLSBkcDJbMF0gKiBkdXYxWzFdKSAqIHIsXHJcbiAgICAgICAgICAgIChkcDFbMV0gKiBkdXYyWzFdIC0gZHAyWzFdICogZHV2MVsxXSkgKiByLFxyXG4gICAgICAgICAgICAoZHAxWzJdICogZHV2MlsxXSAtIGRwMlsyXSAqIGR1djFbMV0pICogclxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGxldCB0MSA9IGdsbS52ZWMzLmNyZWF0ZSgpOyBnbG0udmVjMy5jcm9zcyh0MSwgbjEsIHQpO1xyXG4gICAgICAgIGxldCB0MiA9IGdsbS52ZWMzLmNyZWF0ZSgpOyBnbG0udmVjMy5jcm9zcyh0MiwgbjIsIHQpO1xyXG4gICAgICAgIGxldCB0MyA9IGdsbS52ZWMzLmNyZWF0ZSgpOyBnbG0udmVjMy5jcm9zcyh0MywgbjMsIHQpO1xyXG5cclxuICAgICAgICB0bltpZHgxICogMyArIDBdID0gdDFbMF07XHJcbiAgICAgICAgdG5baWR4MSAqIDMgKyAxXSA9IHQxWzFdO1xyXG4gICAgICAgIHRuW2lkeDEgKiAzICsgMl0gPSB0MVsyXTtcclxuXHJcbiAgICAgICAgdG5baWR4MiAqIDMgKyAwXSA9IHQyWzBdO1xyXG4gICAgICAgIHRuW2lkeDIgKiAzICsgMV0gPSB0MlsxXTtcclxuICAgICAgICB0bltpZHgyICogMyArIDJdID0gdDJbMl07XHJcblxyXG4gICAgICAgIHRuW2lkeDMgKiAzICsgMF0gPSB0M1swXTtcclxuICAgICAgICB0bltpZHgzICogMyArIDFdID0gdDNbMV07XHJcbiAgICAgICAgdG5baWR4MyAqIDMgKyAyXSA9IHQzWzJdO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KHYpO1xyXG4gICAgbGV0IG5vcm1hbHMgPSBuZXcgRmxvYXQzMkFycmF5KHZuKTtcclxuICAgIGxldCB0ZXhjb29yZHMgPSBuZXcgRmxvYXQzMkFycmF5KHZ0KTtcclxuICAgIGxldCB0YW5nZW50cyA9IG5ldyBGbG9hdDMyQXJyYXkodG4pO1xyXG4gICAgbGV0IHZlcnRleENvbG9ycyA9IG5ldyBGbG9hdDMyQXJyYXkodmMpO1xyXG5cclxuICAgIGxldCB2Ym8gPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2Ym8pO1xyXG4gICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIHBvc2l0aW9ucy5ieXRlTGVuZ3RoICsgbm9ybWFscy5ieXRlTGVuZ3RoICsgdGV4Y29vcmRzLmJ5dGVMZW5ndGggKyB0YW5nZW50cy5ieXRlTGVuZ3RoICsgdmVydGV4Q29sb3JzLmJ5dGVMZW5ndGgsIGdsLlNUQVRJQ19EUkFXKTtcclxuICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuQVJSQVlfQlVGRkVSLCAwLCBwb3NpdGlvbnMpO1xyXG4gICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5BUlJBWV9CVUZGRVIsIHBvc2l0aW9ucy5ieXRlTGVuZ3RoLCBub3JtYWxzKTtcclxuICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBwb3NpdGlvbnMuYnl0ZUxlbmd0aCArIG5vcm1hbHMuYnl0ZUxlbmd0aCwgdGV4Y29vcmRzKTtcclxuICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBwb3NpdGlvbnMuYnl0ZUxlbmd0aCArIG5vcm1hbHMuYnl0ZUxlbmd0aCArIHRleGNvb3Jkcy5ieXRlTGVuZ3RoLCB0YW5nZW50cyk7XHJcbiAgICBnbC5idWZmZXJTdWJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgcG9zaXRpb25zLmJ5dGVMZW5ndGggKyBub3JtYWxzLmJ5dGVMZW5ndGggKyB0ZXhjb29yZHMuYnl0ZUxlbmd0aCArIHRhbmdlbnRzLmJ5dGVMZW5ndGgsIHZlcnRleENvbG9ycyk7XHJcblxyXG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcigwLCAzLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDApO1xyXG4gICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoMCk7XHJcbiAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKDEsIDMsIGdsLkZMT0FULCBmYWxzZSwgMCwgcG9zaXRpb25zLmJ5dGVMZW5ndGgpO1xyXG4gICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoMSk7XHJcbiAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKDIsIDIsIGdsLkZMT0FULCBmYWxzZSwgMCwgcG9zaXRpb25zLmJ5dGVMZW5ndGggKyBub3JtYWxzLmJ5dGVMZW5ndGgpO1xyXG4gICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoMik7XHJcbiAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKDMsIDMsIGdsLkZMT0FULCBmYWxzZSwgMCwgcG9zaXRpb25zLmJ5dGVMZW5ndGggKyBub3JtYWxzLmJ5dGVMZW5ndGggKyB0ZXhjb29yZHMuYnl0ZUxlbmd0aCk7XHJcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSgzKTtcclxuICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoNCwgMSwgZ2wuRkxPQVQsIGZhbHNlLCAwLCBwb3NpdGlvbnMuYnl0ZUxlbmd0aCArIG5vcm1hbHMuYnl0ZUxlbmd0aCArIHRleGNvb3Jkcy5ieXRlTGVuZ3RoICsgdGFuZ2VudHMuYnl0ZUxlbmd0aCk7XHJcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSg0KTtcclxuXHJcbiAgICAvLyBlYm9cclxuICAgIGxldCBpbmRpY2VzID0gbmV3IFVpbnQzMkFycmF5KGlkeCk7XHJcbiAgICBsZXQgZWJvID0gZ2wuY3JlYXRlQnVmZmVyKCk7XHJcbiAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBlYm8pO1xyXG4gICAgZ2wuYnVmZmVyRGF0YShnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaW5kaWNlcywgZ2wuU1RBVElDX0RSQVcpO1xyXG4gICAgdGVycmFpbi5jdHIgPSBpZHgubGVuZ3RoO1xyXG5cclxuICAgIC8vIHdhdGVyXHJcbiAgICB3YXRlci52YW8gPSBnbC5jcmVhdGVWZXJ0ZXhBcnJheSgpO1xyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KHdhdGVyLnZhbyk7XHJcblxyXG4gICAgdiA9IHdhdGVyT2JqLnY7XHJcbiAgICB2biA9IHdhdGVyT2JqLnZuO1xyXG4gICAgdnQgPSB3YXRlck9iai52dDtcclxuICAgIGlkeCA9IHdhdGVyT2JqLmlkeDtcclxuXHJcbiAgICBsZXQgcG9zaXRpb25zMiA9IG5ldyBGbG9hdDMyQXJyYXkodik7XHJcbiAgICBsZXQgbm9ybWFsczIgPSBuZXcgRmxvYXQzMkFycmF5KHZuKTtcclxuICAgIGxldCB0ZXhjb29yZHMyID0gbmV3IEZsb2F0MzJBcnJheSh2dCk7XHJcblxyXG4gICAgbGV0IHZibzIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2Ym8yKTtcclxuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBwb3NpdGlvbnMyLmJ5dGVMZW5ndGggKyBub3JtYWxzMi5ieXRlTGVuZ3RoICsgdGV4Y29vcmRzMi5ieXRlTGVuZ3RoLCBnbC5TVEFUSUNfRFJBVyk7XHJcbiAgICBnbC5idWZmZXJTdWJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgMCwgcG9zaXRpb25zMik7XHJcbiAgICBnbC5idWZmZXJTdWJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgcG9zaXRpb25zMi5ieXRlTGVuZ3RoLCBub3JtYWxzMik7XHJcbiAgICBnbC5idWZmZXJTdWJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgcG9zaXRpb25zMi5ieXRlTGVuZ3RoICsgbm9ybWFsczIuYnl0ZUxlbmd0aCwgdGV4Y29vcmRzMik7XHJcblxyXG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcigwLCAzLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDApO1xyXG4gICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoMCk7XHJcbiAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKDEsIDMsIGdsLkZMT0FULCBmYWxzZSwgMCwgcG9zaXRpb25zMi5ieXRlTGVuZ3RoKTtcclxuICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KDEpO1xyXG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcigyLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDAsIHBvc2l0aW9uczIuYnl0ZUxlbmd0aCArIG5vcm1hbHMyLmJ5dGVMZW5ndGgpO1xyXG4gICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoMik7XHJcblxyXG4gICAgbGV0IGluZGljZXMyID0gbmV3IFVpbnQzMkFycmF5KGlkeCk7XHJcbiAgICBsZXQgZWJvMiA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgZWJvMik7XHJcbiAgICBnbC5idWZmZXJEYXRhKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBpbmRpY2VzMiwgZ2wuU1RBVElDX0RSQVcpO1xyXG4gICAgd2F0ZXIuY3RyID0gaWR4Lmxlbmd0aDtcclxuXHJcbiAgICAvLyBmcmVlIGFycmF5XHJcbiAgICB2Lmxlbmd0aCA9IDA7XHJcbiAgICB2bi5sZW5ndGggPSAwO1xyXG4gICAgdnQubGVuZ3RoID0gMDtcclxuICAgIGlkeC5sZW5ndGggPSAwO1xyXG4gICAgdG4ubGVuZ3RoID0gMDtcclxuICAgIHZjLmxlbmd0aCA9IDA7XHJcblxyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KG51bGwpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkQXNzZXQoKSB7XHJcbiAgICAvLyBvYmpcclxuICAgIGxldCByZXRUZXJyYWluID0gYXdhaXQgbG9hZFRlcnJhaW4oKTtcclxuXHJcbiAgICAvLyB0ZXh0dXJlXHJcbiAgICBsZXQgcHJvbWlzZXMgPSBbXTtcclxuICAgIHNreWJveC50ZXhfY3ViZW1hcF9wYXRoLmZvckVhY2gocGF0aCA9PiB7ICAgLy8gMH41XHJcbiAgICAgICAgcHJvbWlzZXMucHVzaChsb2FkSW1hZ2UocGF0aCkpO1xyXG4gICAgfSk7XHJcbiAgICBwcm9taXNlcy5wdXNoKGxvYWRJbWFnZSgnLi9hc3NldC9hdGxhczIucG5nJykpOyAvLyA2XHJcbiAgICBwcm9taXNlcy5wdXNoKGxvYWRJbWFnZSgnLi9hc3NldC9hdGxhczJfbi5wbmcnKSk7ICAvLyA3XHJcbiAgICBwcm9taXNlcy5wdXNoKGxvYWRJbWFnZSgnLi9hc3NldC9hdGxhczMucG5nJykpOyAvLyA4XHJcbiAgICBwcm9taXNlcy5wdXNoKGxvYWRJbWFnZSgnLi9hc3NldC9hdGxhczNfbi5wbmcnKSk7ICAvLyA5XHJcbiAgICBwcm9taXNlcy5wdXNoKGxvYWRJbWFnZSgnLi9hc3NldC93YXRlcl9zdGlsbC5wbmcnKSk7ICAvLyAxMFxyXG4gICAgcHJvbWlzZXMucHVzaChsb2FkSW1hZ2UoJy4vYXNzZXQvbm9pc3ktdGV4dHVyZS5wbmcnKSk7ICAvLyAxMVxyXG4gICAgbGV0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XHJcblxyXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7XHJcblxyXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IDQ7IGkrKyl7XHJcbiAgICAgICAgdGVycmFpbi50ZXhbaV0gPSBnbC5jcmVhdGVUZXh0dXJlKCk7XHJcbiAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGVycmFpbi50ZXhbaV0pO1xyXG4gICAgICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCQSwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgcmVzdWx0c1s2ICsgaV0pO1xyXG4gICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLlJFUEVBVCk7XHJcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuUkVQRUFUKTtcclxuICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgZ2wuTkVBUkVTVCk7XHJcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLk5FQVJFU1QpO1xyXG4gICAgfVxyXG5cclxuICAgIHdhdGVyLnRleFswXSA9IGdsLmNyZWF0ZVRleHR1cmUoKTtcclxuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHdhdGVyLnRleFswXSk7XHJcbiAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGdsLlJHQkEsIGdsLlJHQkEsIGdsLlVOU0lHTkVEX0JZVEUsIHJlc3VsdHNbMTBdKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLlJFUEVBVCk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5SRVBFQVQpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLk5FQVJFU1QpO1xyXG5cclxuXHJcbiAgICBza3lsaWdodC50ZXhfbm9pc2UgPSBnbC5jcmVhdGVUZXh0dXJlKCk7XHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBza3lsaWdodC50ZXhfbm9pc2UpO1xyXG4gICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBnbC5SR0JBLCBnbC5SR0JBLCBnbC5VTlNJR05FRF9CWVRFLCByZXN1bHRzWzExXSk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5SRVBFQVQpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuUkVQRUFUKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5MSU5FQVIpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLkxJTkVBUik7XHJcblxyXG5cclxuXHJcblxyXG4gICAgY3JlYXRlU2t5Ym94VGV4dHVyZShnbCwgcmVzdWx0cyk7XHJcblxyXG5cclxuICAgIHJlc3VsdHMubGVuZ3RoID0gMDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlcih0aW1lKSB7XHJcbiAgICAvLyB1cGRhdGUgdGltZVxyXG4gICAgaWYgKCFnbG9iYWwuc3RhcnQpIHtcclxuICAgICAgICBnbG9iYWwuc3RhcnQgPSB0aW1lO1xyXG4gICAgfVxyXG4gICAgLy8gaW4gbWlsbGlzZWNvbmRzXHJcbiAgICBsZXQgZGVsdGEgPSB0aW1lIC0gZ2xvYmFsLnN0YXJ0O1xyXG4gICAgZ2xvYmFsLnN0YXJ0ID0gdGltZTtcclxuXHJcbiAgICBcclxuICAgIGlmKCFza3lsaWdodC50aW1lX3BhdXNlKXtcclxuICAgICAgICBhZGRTa3lsaWdodFRpbWUoZGVsdGEgLyAxMDAuMCk7XHJcbiAgICB9XHJcbiAgICBcclxuXHJcbiAgICBzdGF0cy51cGRhdGUoKTtcclxuXHJcbiAgICBjYW1lcmFNb3ZlKCk7XHJcbiAgICByZWNhbGN1bGF0ZVZpZXdNYXRyaXgobWF0cml4LnYpO1xyXG5cclxuICAgIGxldCBtdnAgPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxuICAgIGxldCBzbXZwID0gZ2xtLm1hdDQuY3JlYXRlKCk7XHJcblxyXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT1zaGFkb3cgcGFzcz09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHtcclxuICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGZyYW1lc1tpXS5mYm8pO1xyXG5cclxuICAgICAgICBnbC52aWV3cG9ydCgwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGggKiA0LCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0ICogNCk7XHJcbiAgICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpO1xyXG5cclxuICAgICAgICBnbC51c2VQcm9ncmFtKHNoYWRvd01hcC5wcm9ncmFtKTtcclxuXHJcbiAgICAgICAgZ2wuZW5hYmxlKGdsLlBPTFlHT05fT0ZGU0VUX0ZJTEwpO1xyXG4gICAgICAgIGdsLnBvbHlnb25PZmZzZXQoNC4wLCA0LjApO1xyXG5cclxuICAgICAgICBnbG0ubWF0NC5tdWx0aXBseShzbXZwLCBsaWdodF9tYXRyaWNlc1tpXSwgbWF0cml4Lm0pO1xyXG4gICAgICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYoc2hhZG93TWFwLm12cExvY2F0aW9uLCBmYWxzZSwgc212cCk7XHJcblxyXG4gICAgICAgIGdsLmJpbmRWZXJ0ZXhBcnJheSh0ZXJyYWluLnZhbyk7XHJcbiAgICAgICAgZ2wuZHJhd0VsZW1lbnRzKGdsLlRSSUFOR0xFUywgdGVycmFpbi5jdHIsIGdsLlVOU0lHTkVEX0lOVCwgMCk7XHJcblxyXG4gICAgICAgIGdsLmRpc2FibGUoZ2wuUE9MWUdPTl9PRkZTRVRfRklMTCk7XHJcbiAgICB9XHJcbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09IHNoYWRvdyBwYXNzID09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT0gbWFpbiBwYXNzID09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBwb3N0UHJvY2Vzc2luZy5mYm8pO1xyXG4gICAgZ2wudmlld3BvcnQoMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTtcclxuICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQgfCBnbC5ERVBUSF9CVUZGRVJfQklUKTtcclxuICAgIFxyXG4gICAgLy8gZHJhd0F0bW9zcGhlcmUoZ2wsIG1hdHJpeCwgZ2xvYmFsLnByb2dyYW0pO1xyXG4gICAgXHJcbiAgICBnbC51c2VQcm9ncmFtKGdsb2JhbC5wcm9ncmFtKTtcclxuXHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcclxuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRlcnJhaW4udGV4WzAgKyBoaWdoUmVzb2x1dGlvbk9mZnNldF0pO1xyXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMSk7XHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXJyYWluLnRleFsxICsgaGlnaFJlc29sdXRpb25PZmZzZXRdKTtcclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTMpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgc2hhZG93TWFwLmRlcHRoVGV4WzBdKTtcclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTQpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgc2hhZG93TWFwLmRlcHRoVGV4WzFdKTtcclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTUpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgc2hhZG93TWFwLmRlcHRoVGV4WzJdKTtcclxuXHJcblxyXG4gICAgZ2xtLm1hdDQubXVsdGlwbHkobXZwLCBtYXRyaXgucCwgbWF0cml4LnYpO1xyXG4gICAgZ2xtLm1hdDQubXVsdGlwbHkobXZwLCBtdnAsIG1hdHJpeC5tKTtcclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodW5pZm9ybS5tdnAsIGZhbHNlLCBtdnApO1xyXG4gICAgZ2wudW5pZm9ybU1hdHJpeDRmdih1bmlmb3JtLm0sIGZhbHNlLCBtYXRyaXgubSk7XHJcbiAgICBnbC51bmlmb3JtM2Z2KHVuaWZvcm0uZXllLCBjYW1lcmEuZXllKTtcclxuICAgIGdsLnVuaWZvcm0zZnYodW5pZm9ybS5saWdodCwgc2t5bGlnaHQuZXllKTtcclxuICAgIGdsLnVuaWZvcm0xaSh1bmlmb3JtLnVzZVNoYWRvdywgMSk7XHJcbiAgICBcclxuICAgIGdsLnVuaWZvcm0zZnYoZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsb2JhbC5wcm9ncmFtLCAnbGlnaHRfY29sb3InKSwgc2t5bGlnaHQuY29sb3IpO1xyXG4gICAgZ2wudW5pZm9ybTFpKGdsLmdldFVuaWZvcm1Mb2NhdGlvbihnbG9iYWwucHJvZ3JhbSwgXCJ1c2VQcmVDYWxTdW5Db2xvclwiKSwgc2t5bGlnaHQudXNlUHJlQ2FsU3VuQ29sb3IpO1xyXG5cclxuXHJcblxyXG4gICAgLy8gY3NtIHJhbmdlXHJcbiAgICBnbC51bmlmb3JtMWYodW5pZm9ybS5jc21SYW5nZVswXSwgY3NtX3JhbmdlX2NbMF0pO1xyXG4gICAgZ2wudW5pZm9ybTFmKHVuaWZvcm0uY3NtUmFuZ2VbMV0sIGNzbV9yYW5nZV9jWzFdKTtcclxuICAgIGdsLnVuaWZvcm0xZih1bmlmb3JtLmNzbVJhbmdlWzJdLCBjc21fcmFuZ2VfY1syXSk7XHJcblxyXG4gICAgZ2wudW5pZm9ybTFpKHVuaWZvcm0uZGVwdGhCdWZmZXJMb2NhdGlvblswXSwgMyk7XHJcbiAgICBnbC51bmlmb3JtMWkodW5pZm9ybS5kZXB0aEJ1ZmZlckxvY2F0aW9uWzFdLCA0KTtcclxuICAgIGdsLnVuaWZvcm0xaSh1bmlmb3JtLmRlcHRoQnVmZmVyTG9jYXRpb25bMl0sIDUpO1xyXG5cclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodW5pZm9ybS51TFswXSwgZmFsc2UsIGxpZ2h0X21hdHJpY2VzWzBdKTtcclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodW5pZm9ybS51TFsxXSwgZmFsc2UsIGxpZ2h0X21hdHJpY2VzWzFdKTtcclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodW5pZm9ybS51TFsyXSwgZmFsc2UsIGxpZ2h0X21hdHJpY2VzWzJdKTtcclxuXHJcbiAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHVuaWZvcm0uc2hhZG93TVZQTG9jYXRpb24sIGZhbHNlLCBzbXZwKTtcclxuICAgIGdsLnVuaWZvcm0xZih1bmlmb3JtLmJpYXNMb2NhdGlvbiwgc2t5bGlnaHQuYmlhcyk7XHJcblxyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KHRlcnJhaW4udmFvKTtcclxuICAgIGdsLmRyYXdFbGVtZW50cyhnbC5UUklBTkdMRVMsIHRlcnJhaW4uY3RyLCBnbC5VTlNJR05FRF9JTlQsIDApO1xyXG5cclxuICAgIC8vIGRyYXdTa3lib3goZ2wsIG1hdHJpeCwgZ2xvYmFsLnByb2dyYW0pO1xyXG4gICAgZHJhd0F0bW9zcGhlcmUoZ2wsIG1hdHJpeCwgZ2xvYmFsLnByb2dyYW0pO1xyXG4gICAgXHJcbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PSBtYWluIHBhc3MgPT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PSB3YXRlciBwYXNzID09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgZ2wuZW5hYmxlKGdsLkJMRU5EKTtcclxuICAgIGdsLmJsZW5kRnVuY1NlcGFyYXRlKGdsLlNSQ19BTFBIQSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSwgZ2wuWkVSTywgZ2wuT05FKTtcclxuICAgIGdsLnVzZVByb2dyYW0od2F0ZXIucHJvZ3JhbSk7XHJcblxyXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7XHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB3YXRlci50ZXhbMF0pO1xyXG5cclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYod2F0ZXIubXZwLCBmYWxzZSwgbXZwKTtcclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYod2F0ZXIubSwgZmFsc2UsIG1hdHJpeC5tKTtcclxuICAgIGdsLnVuaWZvcm0zZnYod2F0ZXIubGlnaHQsIHNreWxpZ2h0LmV5ZSk7XHJcbiAgICBnbC51bmlmb3JtM2Z2KHdhdGVyLmV5ZSwgY2FtZXJhLmV5ZSk7XHJcbiAgICBnbC51bmlmb3JtMWYod2F0ZXIudGV4T2Zmc2V0LCBNYXRoLmZsb29yKHRpbWUgLyA2NCkgJSAzMik7XHJcblxyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KHdhdGVyLnZhbyk7XHJcbiAgICBnbC5kcmF3RWxlbWVudHMoZ2wuVFJJQU5HTEVTLCB3YXRlci5jdHIsIGdsLlVOU0lHTkVEX0lOVCwgMCk7XHJcblxyXG4gICAgZ2wuZGlzYWJsZShnbC5CTEVORCk7XHJcbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09IHdhdGVyIHBhc3MgPT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5cclxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09IHBvc3QgcHJvY2Vzc2luZyA9PT09PT09PT09PT09PT09PT09PT1cclxuICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCk7XHJcbiAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUIHwgZ2wuREVQVEhfQlVGRkVSX0JJVCk7XHJcbiAgICBnbC51c2VQcm9ncmFtKHBvc3RQcm9jZXNzaW5nLnByb2dyYW0pO1xyXG5cclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgcG9zdFByb2Nlc3NpbmcubWFpblRleHR1cmUpO1xyXG4gICAgZ2wudW5pZm9ybTFpKHBvc3RQcm9jZXNzaW5nLm1haW5UZXhMb2NhdGlvbiwgMCk7XHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUxKTtcclxuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHBvc3RQcm9jZXNzaW5nLmRlcHRoVGV4dHVyZSk7XHJcbiAgICBnbC51bmlmb3JtMWkocG9zdFByb2Nlc3NpbmcuZGVwdGhUZXhMb2NhdGlvbiwgMSk7XHJcblxyXG4gICAgZ2wudW5pZm9ybTJmdihwb3N0UHJvY2Vzc2luZy5yZXNvbHV0aW9uTG9jYXRpb24sIGdsbS52ZWMyLmZyb21WYWx1ZXMoZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KSk7XHJcblxyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KHBvc3RQcm9jZXNzaW5nLnZhbyk7XHJcblxyXG4gICAgZ2wuZHJhd0VsZW1lbnRzKGdsLlRSSUFOR0xFUywgNiwgZ2wuVU5TSUdORURfSU5ULCAwKTtcclxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09IHBvc3QgcHJvY2Vzc2luZyA9PT09PT09PT09PT09PT09PT09PT1cclxufVxyXG5cclxuZnVuY3Rpb24gaW5pdFBvc3RQcm9jZXNzaW5nVGV4dHVyZSgpIHtcclxuICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgcG9zdFByb2Nlc3NpbmcuZmJvKTtcclxuXHJcbiAgICBnbC5kZWxldGVUZXh0dXJlKHBvc3RQcm9jZXNzaW5nLm1haW5UZXh0dXJlKTtcclxuICAgIGdsLmRlbGV0ZVRleHR1cmUocG9zdFByb2Nlc3NpbmcuZGVwdGhUZXh0dXJlKTtcclxuICAgIGdsLmRlbGV0ZVJlbmRlcmJ1ZmZlcihwb3N0UHJvY2Vzc2luZy5kZXB0aEJ1ZmZlcik7XHJcblxyXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7XHJcblxyXG4gICAgcG9zdFByb2Nlc3NpbmcubWFpblRleHR1cmUgPSBnbC5jcmVhdGVUZXh0dXJlKCk7XHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBwb3N0UHJvY2Vzc2luZy5tYWluVGV4dHVyZSlcclxuICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIGZhbHNlKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5ORUFSRVNUKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLk1JUlJPUkVEX1JFUEVBVCk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5NSVJST1JFRF9SRVBFQVQpO1xyXG4gICAgZ2wudGV4U3RvcmFnZTJEKGdsLlRFWFRVUkVfMkQsIDEsIGdsLlJHQkEzMkYsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7XHJcbiAgICBnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZFUiwgZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsLlRFWFRVUkVfMkQsIHBvc3RQcm9jZXNzaW5nLm1haW5UZXh0dXJlLCAwKTtcclxuXHJcbiAgICBwb3N0UHJvY2Vzc2luZy5kZXB0aFRleHR1cmUgPSBnbC5jcmVhdGVUZXh0dXJlKCk7XHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBwb3N0UHJvY2Vzc2luZy5kZXB0aFRleHR1cmUpXHJcbiAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBmYWxzZSk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTkVBUkVTVCk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgZ2wuTkVBUkVTVCk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5NSVJST1JFRF9SRVBFQVQpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuTUlSUk9SRURfUkVQRUFUKTtcclxuICAgIGdsLnRleFN0b3JhZ2UyRChnbC5URVhUVVJFXzJELCAxLCBnbC5SR0JBMzJGLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpO1xyXG4gICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkNPTE9SX0FUVEFDSE1FTlQxLCBnbC5URVhUVVJFXzJELCBwb3N0UHJvY2Vzc2luZy5kZXB0aFRleHR1cmUsIDApO1xyXG5cclxuICAgIHBvc3RQcm9jZXNzaW5nLmRlcHRoQnVmZmVyID0gZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7XHJcbiAgICBnbC5iaW5kUmVuZGVyYnVmZmVyKGdsLlJFTkRFUkJVRkZFUiwgcG9zdFByb2Nlc3NpbmcuZGVwdGhCdWZmZXIpO1xyXG4gICAgZ2wucmVuZGVyYnVmZmVyU3RvcmFnZShnbC5SRU5ERVJCVUZGRVIsIGdsLkRFUFRIX0NPTVBPTkVOVDMyRiwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTtcclxuICAgIGdsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBnbC5ERVBUSF9BVFRBQ0hNRU5ULCBnbC5SRU5ERVJCVUZGRVIsIHBvc3RQcm9jZXNzaW5nLmRlcHRoQnVmZmVyKTtcclxuXHJcbiAgICAvLyBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGdsLkRFUFRIX0NPTVBPTkVOVDMyRiwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0LCAwLCBnbC5ERVBUSF9DT01QT05FTlQsIGdsLkZMT0FULCBudWxsKTtcclxuICAgIC8vIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5MSU5FQVIpO1xyXG4gICAgLy8gZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLkxJTkVBUik7XHJcbiAgICAvLyBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKTtcclxuICAgIC8vIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1QsIGdsLkNMQU1QX1RPX0VER0UpO1xyXG4gICAgLy8gZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkRFUFRIX0FUVEFDSE1FTlQsIGdsLlRFWFRVUkVfMkQsIGRlcHRoQnVmZmVyLCAwKTtcclxuXHJcbiAgICBnbC5kcmF3QnVmZmVycyhbZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsLkNPTE9SX0FUVEFDSE1FTlQxXSk7XHJcblxyXG4gICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBudWxsKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlc2l6ZSgpIHtcclxuICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKTtcclxuXHJcbiAgICBpZiAoZ2wgJiYgY2FudmFzKSB7XHJcbiAgICAgICAgY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuICAgICAgICAvLyBnbG0ubWF0NC5wZXJzcGVjdGl2ZShtYXRyaXgucCwgTWF0aC5QSSAqIDAuNywgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCwgMC4xLCAyMDAwMC4wKTtcclxuICAgICAgICBnbG0ubWF0NC5wZXJzcGVjdGl2ZShtYXRyaXgucCwgTWF0aC5QSSAqIGNhbWVyYS5GT1YgLyAxODAuMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCwgY2FtZXJhLm5lYXIsIGNhbWVyYS5mYXIpO1xyXG4gICAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7XHJcblxyXG4gICAgICAgIGluaXRQb3N0UHJvY2Vzc2luZ1RleHR1cmUoKTtcclxuICAgICAgICBzaGFkb3dGcmFtZUJ1ZmZlclNldHVwKCk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBcclxuICAgIGluaXRXZWJHTCxcclxuICAgIGNyZWF0ZVNoYWRlcixcclxuICAgIGxvYWRBc3NldCxcclxuICAgIHJlbmRlcixcclxuICAgIHJlc2l6ZVxyXG59IGZyb20gJy4vcmVuZGVyJztcclxuXHJcblxyXG5mdW5jdGlvbiBhbmltYXRlKHRpbWUpIHtcclxuXHJcbiAgICByZW5kZXIodGltZSk7XHJcblxyXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcclxufVxyXG5cclxud2luZG93Lm9ucmVzaXplID0gKCkgPT4ge1xyXG4gICAgcmVzaXplKCk7XHJcbn1cclxuXHJcbndpbmRvdy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICBpbml0V2ViR0woKTtcclxuICAgIC8vY3JlYXRlU2hhZGVyKCk7XHJcbiAgICBsb2FkQXNzZXQoKS50aGVuKCgpID0+IHtcclxuICAgICAgICAvLyByZW5kZXJpbmcgbG9vcFxyXG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzllQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeFlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25pQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///4\n')}]);